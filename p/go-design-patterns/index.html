<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Goè¯­è¨€ä¸­è®¾è®¡æ¨¡å¼çš„å®ç°ç»†èŠ‚."><title>GO DESIGN PATTERNS</title><link rel=canonical href=https://ilolicon.github.io/p/go-design-patterns/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="GO DESIGN PATTERNS"><meta property="og:description" content="Goè¯­è¨€ä¸­è®¾è®¡æ¨¡å¼çš„å®ç°ç»†èŠ‚."><meta property="og:url" content="https://ilolicon.github.io/p/go-design-patterns/"><meta property="og:site_name" content="ilolicon's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Goç¼–ç¨‹æ¨¡å¼"><meta property="article:tag" content="Golang"><meta property="article:tag" content="è®¾è®¡æ¨¡å¼"><meta property="article:published_time" content="2023-04-21T11:43:42+08:00"><meta property="article:modified_time" content="2023-04-21T11:43:42+08:00"><meta name=twitter:title content="GO DESIGN PATTERNS"><meta name=twitter:description content="Goè¯­è¨€ä¸­è®¾è®¡æ¨¡å¼çš„å®ç°ç»†èŠ‚."><link rel="shortcut icon" href=/img/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu96a5ab8e0364e843af4687201b687892_162934_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>ilolicon's Blog</a></h1><h2 class=site-description>Keep Calm and Carry On.</h2></div></header><ol class=social-menu><li><a href=https://github.com/ilolicon target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#åˆ›å»ºå‹æ¨¡å¼>åˆ›å»ºå‹æ¨¡å¼</a><ol><li><a href=#å•ä¾‹æ¨¡å¼singleton->å•ä¾‹æ¨¡å¼(Singleton) âœ”</a><ol><li><a href=#é€‚ç”¨åœºæ™¯>é€‚ç”¨åœºæ™¯</a></li><li><a href=#å®ç°æ–¹å¼åŠè§£æ>å®ç°æ–¹å¼åŠè§£æ</a></li></ol></li><li><a href=#ç®€å•å·¥å‚æ¨¡å¼simple-factory->ç®€å•å·¥å‚æ¨¡å¼(Simple Factory) âœ”</a><ol><li><a href=#ç‰¹ç‚¹>ç‰¹ç‚¹</a></li><li><a href=#é€‚ç”¨åœºæ™¯-1>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ä¼˜ç‚¹>ä¼˜ç‚¹</a></li><li><a href=#ç¼ºç‚¹>ç¼ºç‚¹</a></li><li><a href=#ç¤ºä¾‹>ç¤ºä¾‹</a></li></ol></li><li><a href=#å·¥å‚æ–¹æ³•æ¨¡å¼factory-method->å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method) âœ”</a><ol><li><a href=#ç‰¹ç‚¹-1>ç‰¹ç‚¹</a></li><li><a href=#é€‚ç”¨åœºæ™¯-2>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ä¼˜ç‚¹-1>ä¼˜ç‚¹</a></li><li><a href=#ç¼ºç‚¹-1>ç¼ºç‚¹</a></li><li><a href=#ç¤ºä¾‹-1>ç¤ºä¾‹</a></li></ol></li><li><a href=#æŠ½è±¡å·¥å‚æ¨¡å¼abstract-factory->æŠ½è±¡å·¥å‚æ¨¡å¼(Abstract Factory) âœ˜</a><ol><li><a href=#ç‰¹ç‚¹-2>ç‰¹ç‚¹</a></li><li><a href=#é€‚ç”¨åœºæ™¯-3>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ä¼˜ç‚¹-2>ä¼˜ç‚¹</a></li><li><a href=#ç¼ºç‚¹-2>ç¼ºç‚¹</a></li><li><a href=#ç¤ºä¾‹-2>ç¤ºä¾‹</a></li></ol></li><li><a href=#å»ºé€ è€…æ¨¡å¼builder->å»ºé€ è€…æ¨¡å¼(Builder) âœ”</a><ol><li><a href=#ç¤ºä¾‹-3>ç¤ºä¾‹</a></li></ol></li><li><a href=#åŸå‹æ¨¡å¼prototype->åŸå‹æ¨¡å¼(Prototype) âœ˜</a><ol><li><a href=#ç¤ºä¾‹-4>ç¤ºä¾‹</a></li><li><a href=#æ³¨æ„äº‹é¡¹>æ³¨æ„äº‹é¡¹</a></li></ol></li></ol></li><li><a href=#ç»“æ„å‹æ¨¡å¼>ç»“æ„å‹æ¨¡å¼</a><ol><li><a href=#å¤–è§‚æ¨¡å¼facade->å¤–è§‚æ¨¡å¼(Facade) âœ”</a><ol><li><a href=#é€‚ç”¨åœºæ™¯-4>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ä¼˜ç‚¹-3>ä¼˜ç‚¹</a></li><li><a href=#ç¼ºç‚¹-3>ç¼ºç‚¹</a></li><li><a href=#ç¤ºä¾‹-5>ç¤ºä¾‹</a></li></ol></li><li><a href=#é€‚é…å™¨æ¨¡å¼adapter->é€‚é…å™¨æ¨¡å¼(Adapter) âœ”</a><ol><li><a href=#ä¼˜ç‚¹-4>ä¼˜ç‚¹</a></li><li><a href=#ç¼ºç‚¹-4>ç¼ºç‚¹</a></li><li><a href=#ç¤ºä¾‹-6>ç¤ºä¾‹</a></li></ol></li><li><a href=#ä»£ç†æ¨¡å¼proxy->ä»£ç†æ¨¡å¼(Proxy) âœ”</a><ol><li><a href=#é€‚ç”¨åœºæ™¯-5>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ç¤ºä¾‹-7>ç¤ºä¾‹</a></li></ol></li><li><a href=#ç»„åˆæ¨¡å¼composite->ç»„åˆæ¨¡å¼(Composite) âœ˜</a><ol><li><a href=#é€‚ç”¨åœºæ™¯-6>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ä¼˜ç‚¹-5>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-8>ç¤ºä¾‹</a></li></ol></li><li><a href=#äº«å…ƒæ¨¡å¼flyweight->äº«å…ƒæ¨¡å¼(Flyweight) âœ˜</a><ol><li><a href=#ç¤ºä¾‹-9>ç¤ºä¾‹</a></li></ol></li><li><a href=#è£…é¥°æ¨¡å¼decorator->è£…é¥°æ¨¡å¼(Decorator) âœ”</a><ol><li><a href=#ä¼˜ç‚¹-6>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-10>ç¤ºä¾‹</a></li></ol></li><li><a href=#æ¡¥æ¨¡å¼bridge->æ¡¥æ¨¡å¼(Bridge) âœ˜</a><ol><li><a href=#ç¤ºä¾‹-11>ç¤ºä¾‹</a></li><li><a href=#ä¼˜ç‚¹-7>ä¼˜ç‚¹</a></li></ol></li></ol></li><li><a href=#è¡Œä¸ºå‹æ¨¡å¼>è¡Œä¸ºå‹æ¨¡å¼</a><ol><li><a href=#ä¸­ä»‹è€…æ¨¡å¼mediator>ä¸­ä»‹è€…æ¨¡å¼(Mediator)</a><ol><li><a href=#ä¼˜ç‚¹-8>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-12>ç¤ºä¾‹</a></li></ol></li><li><a href=#è§‚å¯Ÿè€…æ¨¡å¼observer->è§‚å¯Ÿè€…æ¨¡å¼(Observer) âœ”</a><ol><li><a href=#ä¼˜ç‚¹-9>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-13>ç¤ºä¾‹</a></li></ol></li><li><a href=#å‘½ä»¤æ¨¡å¼command->å‘½ä»¤æ¨¡å¼(Command) âœ”</a><ol><li><a href=#æ ¸å¿ƒæ€æƒ³>æ ¸å¿ƒæ€æƒ³</a></li><li><a href=#ç¤ºä¾‹-14>ç¤ºä¾‹</a></li></ol></li><li><a href=#è¿­ä»£å™¨æ¨¡å¼iterator>è¿­ä»£å™¨æ¨¡å¼(Iterator)</a><ol><li><a href=#é€‚ç”¨åœºæ™¯-7>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ç¤ºä¾‹-15>ç¤ºä¾‹</a></li></ol></li><li><a href=#æ¨¡æ¿æ–¹æ³•æ¨¡å¼template-method->æ¨¡æ¿æ–¹æ³•æ¨¡å¼(Template Method) âœ”</a><ol><li><a href=#é€‚ç”¨åœºæ™¯-8>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ä¼˜ç‚¹-10>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-16>ç¤ºä¾‹</a></li></ol></li><li><a href=#ç­–ç•¥æ¨¡å¼strategy->ç­–ç•¥æ¨¡å¼(Strategy) âœ”</a><ol><li><a href=#é€‚ç”¨åœºæ™¯-9>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ä¼˜ç‚¹-11>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-17>ç¤ºä¾‹</a></li></ol></li><li><a href=#çŠ¶æ€æ¨¡å¼state>çŠ¶æ€æ¨¡å¼(State)</a><ol><li><a href=#ä¼˜ç‚¹-12>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-18>ç¤ºä¾‹</a></li></ol></li><li><a href=#å¤‡å¿˜å½•æ¨¡å¼memento>å¤‡å¿˜å½•æ¨¡å¼(Memento)</a><ol><li><a href=#ä¼˜ç‚¹-13>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-19>ç¤ºä¾‹</a></li></ol></li><li><a href=#è§£é‡Šå™¨æ¨¡å¼interpreter>è§£é‡Šå™¨æ¨¡å¼(Interpreter)</a><ol><li><a href=#æŠ½è±¡è¯­æ³•æ ‘>æŠ½è±¡è¯­æ³•æ ‘</a></li><li><a href=#é€‚ç”¨åœºæ™¯-10>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ç¤ºä¾‹-20>ç¤ºä¾‹</a></li></ol></li><li><a href=#èŒè´£é“¾æ¨¡å¼chain-of-responsibility>èŒè´£é“¾æ¨¡å¼(Chain of Responsibility)</a><ol><li><a href=#æ ¸å¿ƒæ€æƒ³-1>æ ¸å¿ƒæ€æƒ³</a></li><li><a href=#é€‚ç”¨åœºæ™¯-11>é€‚ç”¨åœºæ™¯</a></li><li><a href=#ç¤ºä¾‹-21>ç¤ºä¾‹</a></li></ol></li><li><a href=#è®¿é—®è€…æ¨¡å¼visitor>è®¿é—®è€…æ¨¡å¼(Visitor)</a><ol><li><a href=#ä¼˜ç‚¹-14>ä¼˜ç‚¹</a></li><li><a href=#ç¤ºä¾‹-22>ç¤ºä¾‹</a></li></ol></li></ol></li><li><a href=#å…¶ä½™å¸¸ç”¨æ¨¡å¼>å…¶ä½™å¸¸ç”¨æ¨¡å¼</a><ol><li><a href=#å¯¹è±¡æ± æ¨¡å¼object-pool-pattern->å¯¹è±¡æ± æ¨¡å¼(Object Pool Pattern) âœ”</a><ol><li><a href=#å®ç°>å®ç°</a></li><li><a href=#ç”¨æ³•>ç”¨æ³•</a></li><li><a href=#ç»éªŒæ³•åˆ™>ç»éªŒæ³•åˆ™</a></li></ol></li><li><a href=#æ€§èƒ½åˆ†ææ¨¡å¼profiling-patterns>æ€§èƒ½åˆ†ææ¨¡å¼(Profiling Patterns)</a><ol><li><a href=#timing-functions>Timing Functions</a></li><li><a href=#ç”¨æ³•-1>ç”¨æ³•</a></li></ol></li><li><a href=#function-options>Function Options</a></li><li><a href=#circuit-breaker>Circuit-Breaker</a></li></ol></li><li><a href=#å‚è€ƒæ–‡æ¡£>å‚è€ƒæ–‡æ¡£</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/golang/ style=background-color:#38a8d2;color:#fff>Golang</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/go-design-patterns/>GO DESIGN PATTERNS</a></h2><h3 class=article-subtitle>Goè¯­è¨€ä¸­è®¾è®¡æ¨¡å¼çš„å®ç°ç»†èŠ‚.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Apr 21, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 35 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><ul><li><code>è®¾è®¡æ¨¡å¼</code>æ˜¯è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„å…¸å‹è§£å†³æ–¹æ¡ˆ æ¯ä¸ªæ¨¡å¼å°±åƒä¸€å¼ è“å›¾ ä½ å¯ä»¥é€šè¿‡å¯¹å…¶è¿›è¡Œå®šåˆ¶æ¥è§£å†³ä»£ç ä¸­çš„ç‰¹å®šè®¾è®¡é—®é¢˜</li><li>æ¨¡å¼æ˜¯é’ˆå¯¹è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå·¥å…·ç®± å®ƒä»¬å®šä¹‰äº†ä¸€ç§è®©ä½ çš„å›¢é˜Ÿèƒ½æ›´é«˜æ•ˆæ²Ÿé€šçš„é€šç”¨è¯­è¨€</li><li>ä¸åŒè®¾è®¡æ¨¡å¼åœ¨å…¶å¤æ‚ç¨‹åº¦ã€ç»†èŠ‚å±‚æ¬¡ä»¥åŠåº”ç”¨èŒƒå›´ç­‰æ–¹é¢å„ä¸ç›¸åŒ æ­¤å¤– æˆ‘ä»¬å¯ä»¥æ ¹æ®æ¨¡å¼çš„ç›®çš„æ¥å°†å®ƒä»¬åˆ’åˆ†ä¸ºä¸‰ä¸ªä¸åŒçš„ç»„åˆ«<ul><li><code>åˆ›å»ºå‹æ¨¡å¼</code> æä¾›å¯¹è±¡çš„åˆ›å»ºæœºåˆ¶ å¢åŠ å·²æœ‰ä»£ç çš„çµæ´»æ€§å’Œå¤ç”¨æ€§</li><li><code>ç»“æ„å‹æ¨¡å¼</code> ä»‹ç»å¦‚ä½•å°†å¯¹è±¡å’Œç±»ç»„è£…æˆè¾ƒå¤§çš„ç»“æ„ å¹¶åŒæ—¶ä¿æŒç»“æ„çš„çµæ´»å’Œé«˜æ•ˆ</li><li><code>è¡Œä¸ºå‹æ¨¡å¼</code> è´Ÿè´£å¯¹è±¡é—´çš„é«˜æ•ˆæ²Ÿé€šå’ŒèŒè´£å§”æ´¾</li></ul></li></ul><h2 id=åˆ›å»ºå‹æ¨¡å¼>åˆ›å»ºå‹æ¨¡å¼</h2><ul><li>åœ¨Goè¯­è¨€ä¸­ åˆ›å»ºå‹æ¨¡å¼(Creational Patterns)æ˜¯ä¸€ç±»ç”¨äºå¤„ç†å¯¹è±¡åˆ›å»ºçš„è®¾è®¡æ¨¡å¼</li><li>å®ƒä»¬çš„ä¸»è¦ç›®æ ‡æ˜¯æä¾›ä¸€ç§çµæ´»çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ åŒæ—¶éšè—å¯¹è±¡åˆ›å»ºçš„å…·ä½“ç»†èŠ‚ ä»è€Œé™ä½ä»£ç çš„è€¦åˆåº¦ å¹¶æé«˜ä»£ç çš„å¯å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§</li><li>æ¯”å¦‚æ ‡å‡†åº“: <code>http.NewRequest()</code> <code>bytes.NewReader()</code> <code>md5.New()</code> ç­‰ç­‰ &mldr;</li><li>åˆ›å»ºå‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦» ä½¿å¾—ç³»ç»Ÿä¸ä¾èµ–äºå…·ä½“çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ è€Œæ˜¯ä¾èµ–äºæŠ½è±¡</li></ul><h3 id=å•ä¾‹æ¨¡å¼singleton->å•ä¾‹æ¨¡å¼(Singleton) âœ”</h3><ul><li>å•ä¾‹æ¨¡å¼(singleton) ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ å¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹</li><li>é€šå¸¸è®©ä¸€ä¸ªå…¨å±€å˜é‡æˆä¸ºä¸€ä¸ªå¯¹è±¡è¢«è®¿é—® ä½†ä¸èƒ½é˜²æ­¢å®ä¾‹åŒ–å¤šä¸ªå¯¹è±¡</li><li>å¸¸è§åšæ³•ï¼šè®©ç±»è‡ªèº«è´Ÿè´£ä¿è¯å®ƒçš„å”¯ä¸€å®ä¾‹ è¿™ä¸ªç±»å¯ä»¥ä¿è¯æ²¡æœ‰å…¶ä»–å®ä¾‹å¯ä»¥è¢«åˆ›å»º å¹¶ä¸”å¯ä»¥æä¾›ä¸€ä¸ªè®¿é—®è¯¥å®ä¾‹çš„æ–¹æ³•</li></ul><h4 id=é€‚ç”¨åœºæ™¯>é€‚ç”¨åœºæ™¯</h4><ul><li>å½“æŸä¸ªå¯¹è±¡åªèƒ½å­˜åœ¨ä¸€ä¸ªå®ä¾‹çš„æƒ…å†µä¸‹ä½¿ç”¨å•ä¾‹æ¨¡å¼ æ¯”å¦‚ï¼š<ul><li>å…¨å±€Configé…ç½®å¯¹è±¡</li><li>å…¨å±€Loggeræ—¥å¿—å¯¹è±¡</li><li>&mldr;</li></ul></li><li>ä¼˜ç‚¹ï¼š<ul><li>æä¾›äº†å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—®</li><li>ç”±äºåœ¨ç³»ç»Ÿå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ å› æ­¤å¯ä»¥èŠ‚çº¦ç³»ç»Ÿèµ„æº å¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½</li></ul></li></ul><h4 id=å®ç°æ–¹å¼åŠè§£æ>å®ç°æ–¹å¼åŠè§£æ</h4><h5 id=é¥¿æ±‰æ¨¡å¼>é¥¿æ±‰æ¨¡å¼</h5><ul><li>åœ¨ç¨‹åºåŠ è½½æ—¶å°±åˆ›å»ºå¯¹è±¡å®ä¾‹</li><li>Goè¯­è¨€ä¸­æˆ‘ä»¬å¯ä»¥æ”¾åˆ°<code>init</code>å‡½æ•°ä¸­ ä¿è¯çº¿ç¨‹å®‰å…¨<ul><li>ä¼šå‡æ…¢ç¨‹åºå¯åŠ¨é€Ÿåº¦(<code>init</code>å¯åŠ¨æ—¶ä¼šå…ˆåŠ è½½)</li><li>å¦‚æœå®ä¾‹ä¸è¢«è°ƒç”¨ åˆ™ä¼šæµªè´¹ä¸€æ®µå†…å­˜ç©ºé—´ ç‰¹åˆ«æ˜¯è¯¥å¯¹è±¡æ¯”è¾ƒå¤§çš„æ—¶å€™</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=æ‡’æ±‰æ¨¡å¼>æ‡’æ±‰æ¨¡å¼</h5><ul><li>åœ¨è·å–å¯¹è±¡å®ä¾‹æ—¶ å¦‚æœå®ä¾‹ä¸ºç©ºåˆ™åˆ›å»º</li><li>é¿å…é¥¿æ±‰æ¨¡å¼çš„å†…å­˜ç©ºé—´æµªè´¹</li><li>åœ¨Goä¸­å¹¶å‘éå¸¸å®¹æ˜“ å®¹æ˜“è¢«ä¸æ­£ç¡®ä½¿ç”¨ å¯¼è‡´å¿½ç•¥å¹¶å‘å®‰å…¨</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>åœ¨ä¸Šè¿°æƒ…å†µä¸‹ å¤šä¸ªgoroutineéƒ½å¯ä»¥æ‰§è¡Œç¬¬ä¸€ä¸ªæ£€æŸ¥</li><li>å¹¶ä¸”å®ƒä»¬éƒ½å°†åˆ›å»ºè¯¥singletonç±»å‹çš„å®ä¾‹å¹¶ç›¸äº’è¦†ç›– æ— æ³•ä¿è¯å®ƒå°†åœ¨æ­¤å¤„è¿”å›å“ªä¸ªå®ä¾‹ å¹¶ä¸”å¯¹è¯¥å®ä¾‹çš„å…¶ä»–è¿›ä¸€æ­¥æ“ä½œå¯èƒ½ä¸å¼€å‘äººå‘˜çš„æœŸæœ›ä¸ä¸€è‡´</li><li>å¦‚æœæœ‰ä»£ç ä¿ç•™äº†å¯¹è¯¥å•ä¾‹å®ä¾‹çš„å¼•ç”¨ åˆ™å¯èƒ½å­˜åœ¨å…·æœ‰ä¸åŒçŠ¶æ€çš„è¯¥ç±»å‹çš„å¤šä¸ªå®ä¾‹ ä»è€Œäº§ç”Ÿæ½œåœ¨çš„ä¸åŒä»£ç è¡Œä¸º è¿™ä¹Ÿæˆä¸ºè°ƒè¯•è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå™©æ¢¦ å¹¶ä¸”å¾ˆéš¾å‘ç°è¯¥é”™è¯¯</li><li>å› ä¸ºåœ¨è°ƒè¯•æ—¶ ç”±äºè¿è¡Œæ—¶æš‚åœè€Œæ²¡æœ‰å‡ºç°ä»»ä½•é”™è¯¯ è¿™ä½¿éå¹¶å‘å®‰å…¨æ‰§è¡Œçš„å¯èƒ½æ€§é™åˆ°äº†æœ€ä½ å¹¶ä¸”å¾ˆå®¹æ˜“éšè—å¼€å‘äººå‘˜çš„é—®é¢˜</li></ul><h5 id=åŒé‡æ£€æŸ¥æ¨¡å¼æ¿€è¿›åŠ é”>åŒé‡æ£€æŸ¥æ¨¡å¼(æ¿€è¿›åŠ é”)</h5><ul><li>è§£å†³æ‡’æ±‰æ¨¡å¼çš„éçº¿ç¨‹å®‰å…¨ é¿å…èµ„æºç«äº‰å¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li><li>æ½œåœ¨é—®é¢˜ï¼š<ul><li>å¦‚æœå®ä¾‹å­˜åœ¨ æ²¡æœ‰å¿…è¦åŠ é”</li><li>æ¯æ¬¡è¯·æ±‚éƒ½åŠ é”(æ‰§è¡Œè¿‡å¤šçš„é”å®š) é™ä½æ€§èƒ½/å¢åŠ ç“¶é¢ˆ</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>    <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span> <span class=c1>// å¦‚æœå®ä¾‹å­˜åœ¨æ²¡æœ‰å¿…è¦åŠ é”
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>defer</span> <span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ä¼˜åŒ–ï¼šæ£€æŸ¥å¯¹åº”æ˜¯å¦ä¸ºç©ºä¹‹åå†åŠ é”</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>    <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span> <span class=c1>// // ä¸å¤ªå®Œç¾ å› ä¸ºè¿™é‡Œä¸æ˜¯å®Œå…¨åŸå­çš„
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>defer</span> <span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ä¸Šé¢çš„æ–¹å¼ä»ç„¶ä¸å¤ªå®Œç¾ å› ä¸ºåˆ¤æ–­å®ä¾‹æ˜¯å¦ä¸ºç©ºçš„è¿‡ç¨‹ä»ç„¶ä¸æ˜¯å®Œå…¨åŸå­çš„</li><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sync/atomic</code>åŒ… åŸå­åŒ–åŠ è½½å¹¶è®¾ç½®ä¸€ä¸ªæ ‡å¿— è¯¥æ ‡å¿—è¡¨æ˜æˆ‘ä»¬æ˜¯å¦å·²åˆå§‹åŒ–å®ä¾‹</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync/atomic&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>initialized</span> <span class=kt>uint32</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>    <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>atomic</span><span class=p>.</span><span class=nf>LoadUInt32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>initialized</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>{</span>  <span class=c1>// åŸå­æ“ä½œ 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>mu</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>initialized</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>         <span class=nx>atomic</span><span class=p>.</span><span class=nf>StoreUint32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>initialized</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=synconce>Sync.Once</h5><ul><li>Goè¯­è¨€å•ä¾‹æƒ¯ç”¨å®ç°è§£æ</li><li>ä¸Šé¢å®ç°åŸå­æ“ä½œçš„å†™æ³•ç¨æ˜¾ç¹ç</li><li>Goæ ‡å‡†åº“<code>sync</code>ä¸­çš„<code>Once</code>ç±»å‹ å®ƒèƒ½ä¿è¯æŸä¸ªæ“ä½œä»…ä¸”åªæ‰§è¡Œä¸€æ¬¡</li><li><code>sync.Once</code>æºç </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Copyright 2009 The Go Authors. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=c1>// Use of this source code is governed by a BSD-style
</span></span></span><span class=line><span class=cl><span class=c1>// license that can be found in the LICENSE file.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>sync</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync/atomic&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// Once is an object that will perform exactly one action.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// A Once must not be copied after first use.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Once</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// done indicates whether the action has been performed.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// It is first in the struct because it is used in the hot path.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// The hot path is inlined at every call site.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// Placing done first allows more compact instructions on some architectures (amd64/386),
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// and fewer instructions (to calculate offset) on other architectures.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>done</span> <span class=kt>uint32</span>
</span></span><span class=line><span class=cl>    <span class=nx>m</span>    <span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do calls the function f if and only if Do is being called for the
</span></span></span><span class=line><span class=cl><span class=c1>// first time for this instance of Once. In other words, given
</span></span></span><span class=line><span class=cl><span class=c1>//  var once Once
</span></span></span><span class=line><span class=cl><span class=c1>// if once.Do(f) is called multiple times, only the first call will invoke f,
</span></span></span><span class=line><span class=cl><span class=c1>// even if f has a different value in each invocation. A new instance of
</span></span></span><span class=line><span class=cl><span class=c1>// Once is required for each function to execute.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Do is intended for initialization that must be run exactly once. Since f
</span></span></span><span class=line><span class=cl><span class=c1>// is niladic, it may be necessary to use a function literal to capture the
</span></span></span><span class=line><span class=cl><span class=c1>// arguments to a function to be invoked by Do:
</span></span></span><span class=line><span class=cl><span class=c1>//  config.once.Do(func() { config.init(filename) })
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Because no call to Do returns until the one call to f returns, if f causes
</span></span></span><span class=line><span class=cl><span class=c1>// Do to be called, it will deadlock.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// If f panics, Do considers it to have returned; future calls of Do return
</span></span></span><span class=line><span class=cl><span class=c1>// without calling f.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Once</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>f</span> <span class=kd>func</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Note: Here is an incorrect implementation of Do:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// if atomic.CompareAndSwapUint32(&amp;o.done, 0, 1) {
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//      f()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//  }
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// Do guarantees that when it returns, f has finished.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// This implementation would not implement that guarantee:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// given two simultaneous calls, the winner of the cas would
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// call f, and the second would return immediately, without
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// waiting for the first&#39;s call to f to complete.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// This is why the slow path falls back to a mutex, and why
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// the atomic.StoreUint32 must be delayed until after f returns.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>atomic</span><span class=p>.</span><span class=nf>LoadUint32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>o</span><span class=p>.</span><span class=nx>done</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Outlined slow-path to allow inlining of the fast-path.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>o</span><span class=p>.</span><span class=nf>doSlow</span><span class=p>(</span><span class=nx>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Once</span><span class=p>)</span> <span class=nf>doSlow</span><span class=p>(</span><span class=nx>f</span> <span class=kd>func</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>o</span><span class=p>.</span><span class=nx>m</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>o</span><span class=p>.</span><span class=nx>m</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>o</span><span class=p>.</span><span class=nx>done</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>defer</span> <span class=nx>atomic</span><span class=p>.</span><span class=nf>StoreUint32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>o</span><span class=p>.</span><span class=nx>done</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>f</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>é€šè¿‡ä¸Šé¢æºç å‘ç° æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™ä¸ªå®ç°åªæ‰§è¡Œä¸€æ¬¡æŸä¸ªå‡½æ•°/æ–¹æ³•</li><li>once.Do()çš„ç”¨æ³•å¦‚ä¸‹</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>once</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>Once</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>once</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åœ¨è¿™é‡Œæ‰§è¡Œå®‰å…¨çš„åˆå§‹åŒ–
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=å®Œæ•´ç¤ºä¾‹>å®Œæ•´ç¤ºä¾‹</h5><ul><li>ä½¿ç”¨sync.OnceåŒ…æ˜¯å®‰å…¨åœ°å®ç°æ­¤ç›®æ ‡çš„é¦–é€‰æ–¹å¼</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>once</span>     <span class=nx>sync</span><span class=p>.</span><span class=nx>Once</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>once</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç®€å•å·¥å‚æ¨¡å¼simple-factory->ç®€å•å·¥å‚æ¨¡å¼(Simple Factory) âœ”</h3><ul><li>ç®€å•å·¥å‚å¹¶ä¸æ˜¯ä¸€ä¸ªæ­£å¼çš„è®¾è®¡æ¨¡å¼ è€Œæ˜¯ä¸€ç§ç¼–ç¨‹ä¹ æƒ¯ å®ƒé€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥å°è£…å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ å®¢æˆ·ç«¯åªéœ€è¦ä¼ é€’å‚æ•°ç»™å·¥å‚ç±» ç”±å·¥å‚ç±»å†³å®šåˆ›å»ºå“ªç§å¯¹è±¡</li></ul><h4 id=ç‰¹ç‚¹>ç‰¹ç‚¹</h4><ul><li>åªæœ‰ä¸€ä¸ªå·¥å‚ç±» è´Ÿè´£åˆ›å»ºæ‰€æœ‰äº§å“</li><li>é€šé“æ¡ä»¶åˆ¤æ–­(å¦‚<code>switch</code>æˆ–<code>if-else</code>)æ¥å†³å®šåˆ›å»ºå“ªç§äº§å“</li></ul><h4 id=é€‚ç”¨åœºæ™¯-1>é€‚ç”¨åœºæ™¯</h4><ul><li>äº§å“ç§ç±»å°‘ ä¸”åˆ›å»ºé€»è¾‘ç®€å•çš„åœºæ™¯</li></ul><h4 id=ä¼˜ç‚¹>ä¼˜ç‚¹</h4><ul><li>ç®€å•æ˜“ç”¨ é€‚åˆå°å‹é¡¹ç›®</li></ul><h4 id=ç¼ºç‚¹>ç¼ºç‚¹</h4><ul><li>ä¸ç¬¦åˆå¼€é—­åŸåˆ™(OCP) æ–°å¢äº§å“æ—¶éœ€è¦ä¿®æ”¹å·¥å‚ç±»</li></ul><blockquote><p><a class=link href=https://zh.wikipedia.org/wiki/%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99 target=_blank rel=noopener>å¼€é—­åŸåˆ™</a>: å½“éœ€æ±‚å‘ç”Ÿå˜åŒ–æ—¶ å¯ä»¥é€šè¿‡å¢åŠ æ–°çš„ä»£ç æ¥æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ è€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„ä»£ç </p></blockquote><h4 id=ç¤ºä¾‹>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Product</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Use</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ProductA</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ProductA</span><span class=p>)</span> <span class=nf>Use</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Using Product A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ProductB</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ProductB</span><span class=p>)</span> <span class=nf>Use</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Using Product B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>CreateProduct</span><span class=p>(</span><span class=nx>productType</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>Product</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=nx>productType</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;A&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ProductA</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;B&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ProductB</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>productA</span> <span class=o>:=</span> <span class=nf>CreateProduct</span><span class=p>(</span><span class=s>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>productA</span><span class=p>.</span><span class=nf>Use</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>productB</span> <span class=o>:=</span> <span class=nf>CreateProduct</span><span class=p>(</span><span class=s>&#34;B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>productB</span><span class=p>.</span><span class=nf>Use</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å·¥å‚æ–¹æ³•æ¨¡å¼factory-method->å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method) âœ”</h3><ul><li>ä¸Šé¢çš„ç®€å•å·¥å‚æ¨¡å¼ ä¸€ä¸ªå·¥å‚å°±è´Ÿè´£äº†å¤šä¸ªäº§å“çš„ç”Ÿäº§</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼åˆ™æ˜¯å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ ä½†å°†å…·ä½“çš„åˆ›å»ºé€»è¾‘å»¶è¿Ÿåˆ°å­ç±»ä¸­ æ¯ä¸ªå­ç±»è´Ÿè´£åˆ›å»ºä¸€ç§å…·ä½“çš„äº§å“</li></ul><h4 id=ç‰¹ç‚¹-1>ç‰¹ç‚¹</h4><ul><li>æ¯ä¸ªäº§å“å¯¹åº”ä¸€ä¸ªå·¥å‚ç±»</li><li>ç¬¦åˆ<code>å¼€é—­åŸåˆ™</code> æ–°å¢äº§å“æ—¶åªéœ€å¢åŠ æ–°çš„å·¥å‚ç±» æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç </li><li>å°†å¯¹è±¡çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°ç”¨äºåˆ›å»ºå®ä¾‹çš„ä¸“ç”¨å‡½æ•°</li></ul><h4 id=é€‚ç”¨åœºæ™¯-2>é€‚ç”¨åœºæ™¯</h4><ul><li>äº§å“ç§ç±»å¤š ä¸”åˆ›å»ºé€»è¾‘å¤æ‚çš„åœºæ™¯</li></ul><h4 id=ä¼˜ç‚¹-1>ä¼˜ç‚¹</h4><ul><li>ç¬¦åˆå¼€é—­åŸåˆ™ æ‰©å±•æ€§å¼º</li><li>æ¯ä¸ªå·¥å‚åªè´Ÿè´£ä¸€ç§äº§å“çš„åˆ›å»º èŒè´£å•ä¸€</li></ul><h4 id=ç¼ºç‚¹-1>ç¼ºç‚¹</h4><ul><li>ç±»çš„æ•°é‡ä¼šå¢åŠ  ç³»ç»Ÿå¤æ‚åº¦æé«˜</li></ul><h4 id=ç¤ºä¾‹-1>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Database</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>MySQL</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>MySQL</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to MySQL&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>PostgreSQL</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=nx>PostgreSQL</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to PostgreSQL&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// DatabaseFactoryå·¥å‚æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DatabaseFactory</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateDatabase</span><span class=p>()</span> <span class=nx>Database</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>MySQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>MySQLFactory</span><span class=p>)</span> <span class=nf>CreateDatabase</span><span class=p>()</span> <span class=nx>Database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>MySQL</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>PostgreSQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=nx>PostgreSQLFactory</span><span class=p>)</span> <span class=nf>CreateDatabase</span><span class=p>()</span> <span class=nx>Database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>PostgreSQL</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UseDatabaseFactory</span><span class=p>(</span><span class=nx>factory</span> <span class=nx>DatabaseFactory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span> <span class=o>:=</span> <span class=nx>factory</span><span class=p>.</span><span class=nf>CreateDatabase</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>db</span><span class=p>.</span><span class=nf>Connect</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabaseFactory</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>MySQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabaseFactory</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PostgreSQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æŠ½è±¡å·¥å‚æ¨¡å¼abstract-factory->æŠ½è±¡å·¥å‚æ¨¡å¼(Abstract Factory) âœ˜</h3><ul><li>æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ è€Œæ— éœ€æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±» å®ƒé€‚ç”¨äºéœ€è¦åˆ›å»ºä¸€ç»„ç›¸å…³äº§å“çš„åœºæ™¯</li></ul><h4 id=ç‰¹ç‚¹-2>ç‰¹ç‚¹</h4><ul><li>æ¯ä¸ªå·¥å‚ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªç›¸å…³äº§å“</li><li>å¼ºè°ƒ<strong>äº§å“æ—</strong>çš„æ¦‚å¿µ ä¾‹å¦‚GUIåº“ä¸­çš„ä¸åŒé£æ ¼ç»„ä»¶(Windowsé£æ ¼ã€Macé£æ ¼)</li></ul><h4 id=é€‚ç”¨åœºæ™¯-3>é€‚ç”¨åœºæ™¯</h4><ul><li>éœ€è¦åˆ›å»ºä¸€ç»„ç›¸å…³å¯¹è±¡çš„åœºæ™¯</li></ul><h4 id=ä¼˜ç‚¹-2>ä¼˜ç‚¹</h4><ul><li>å¯ä»¥åˆ›å»ºä¸€ç»„ç›¸å…³å¯¹è±¡ ä¿è¯å¯¹è±¡ä¹‹é—´çš„å…¼å®¹æ€§</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ æ‰©å±•æ€§å¼º</li></ul><h4 id=ç¼ºç‚¹-2>ç¼ºç‚¹</h4><ul><li>ç±»çš„æ•°é‡ä¼šå¢åŠ  ç³»ç»Ÿå¤æ‚åº¦æé«˜</li><li>æ–°å¢äº§å“æ—æˆ–äº§å“ç­‰çº§ç»“æ„æ—¶ éœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚æ¥å£åŠå…¶æ‰€æœ‰å®ç°ç±»</li></ul><h4 id=ç¤ºä¾‹-2>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æŠ½è±¡å±‚ï¼šæ•°æ®åº“è¿æ¥æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBConnention</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æŠ½è±¡å±‚ï¼šæ•°æ®åº“å‘½ä»¤æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBCommand</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“äº§å“ï¼šMySQLè¿æ¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MySQLConnection</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLConnection</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to MySQL&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“äº§å“ï¼šMySQLå‘½ä»¤
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MySQLCommand</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Executed MySQL query: %s&#34;</span><span class=p>,</span> <span class=nx>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“äº§å“ï¼šPostgresè¿æ¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PostgresSQLConnection</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLConnection</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to Postgres&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“äº§å“ï¼šPostgresSQLå‘½ä»¤
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PostgresSQLCommand</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Executed PostgresSQL query: %s&#34;</span><span class=p>,</span> <span class=nx>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æŠ½è±¡å·¥å‚æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBFactory</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateConnection</span><span class=p>()</span> <span class=nx>DBConnention</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateCommand</span><span class=p>()</span> <span class=nx>DBCommand</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“çš„MySQLå·¥å‚
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MySQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLFactory</span><span class=p>)</span> <span class=nf>CreateConnection</span><span class=p>()</span> <span class=nx>DBConnention</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>MySQLConnection</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLFactory</span><span class=p>)</span> <span class=nf>CreateCommand</span><span class=p>()</span> <span class=nx>DBCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>MySQLCommand</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“çš„PostgresSQLå·¥å‚
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PostgresSQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLFactory</span><span class=p>)</span> <span class=nf>CreateConnection</span><span class=p>()</span> <span class=nx>DBConnention</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>PostgresSQLConnection</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLFactory</span><span class=p>)</span> <span class=nf>CreateCommand</span><span class=p>()</span> <span class=nx>DBCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>PostgresSQLCommand</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UseDatabase</span><span class=p>(</span><span class=nx>factory</span> <span class=nx>DBFactory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>connection</span> <span class=o>:=</span> <span class=nx>factory</span><span class=p>.</span><span class=nf>CreateConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>command</span> <span class=o>:=</span> <span class=nx>factory</span><span class=p>.</span><span class=nf>CreateCommand</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>connection</span><span class=p>.</span><span class=nf>Connect</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=s>&#34;SELECT * FROM table&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¸šåŠ¡é€»è¾‘
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabase</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>MySQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabase</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PostgresSQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å»ºé€ è€…æ¨¡å¼builder->å»ºé€ è€…æ¨¡å¼(Builder) âœ”</h3><ul><li>ç”¨äºåˆ†æ­¥æ„å»ºå¤æ‚å¯¹è±¡</li><li>å»ºé€ è€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ä¸å…¶è¡¨ç¤ºåˆ†ç¦» ä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤º</li><li>å»ºé€ è€…æ¨¡å¼ç‰¹åˆ«é€‚ç”¨äºä»¥ä¸‹åœºæ™¯<ul><li>å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹éå¸¸å¤æ‚ åŒ…å«å¤šä¸ªæ­¥éª¤</li><li>å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹éœ€è¦æ”¯æŒä¸åŒçš„é…ç½®æˆ–è¡¨ç¤º</li></ul></li></ul><h4 id=ç¤ºä¾‹-3>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>House</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Walls</span>   <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Roof</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Windows</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Doors</span>   <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>House</span><span class=p>)</span> <span class=nf>Show</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;House with %s walls, %s roof, %s windows, and %s doors\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>.</span><span class=nx>Walls</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Roof</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Windows</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Doors</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å»ºé€ è€…æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HouseBuilder</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildWalls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildRoof</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildWindows</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildDoors</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>GetHouse</span><span class=p>()</span> <span class=o>*</span><span class=nx>House</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“å»ºé€ è€…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConcreateHouseBuilder</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>house</span> <span class=o>*</span><span class=nx>House</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è¿”å›ä¸€ä¸ªç©ºHouse
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewConcreateHouseBuilder</span><span class=p>()</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ConcreateHouseBuilder</span><span class=p>{</span><span class=nx>house</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>House</span><span class=p>{}}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildWalls</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Walls</span> <span class=p>=</span> <span class=s>&#34;concrete&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildRoof</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Roof</span> <span class=p>=</span> <span class=s>&#34;tile&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildWindows</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Windows</span> <span class=p>=</span> <span class=s>&#34;glass&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildDoors</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Doors</span> <span class=p>=</span> <span class=s>&#34;wooden&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>GetHouse</span><span class=p>()</span> <span class=o>*</span><span class=nx>House</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>b</span><span class=p>.</span><span class=nx>house</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æŒ‡æŒ¥è€…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Director</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>builder</span> <span class=nx>HouseBuilder</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewDirector</span><span class=p>(</span><span class=nx>builder</span> <span class=nx>HouseBuilder</span><span class=p>)</span> <span class=o>*</span><span class=nx>Director</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Director</span><span class=p>{</span><span class=nx>builder</span><span class=p>:</span> <span class=nx>builder</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>Director</span><span class=p>)</span> <span class=nf>Construct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildWalls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildRoof</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildWindows</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildDoors</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®¢æˆ·ç«¯ä»£ç 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>builder</span> <span class=o>:=</span> <span class=nf>NewConcreateHouseBuilder</span><span class=p>()</span> <span class=c1>// å¸¸è§å…·ä½“æ„å»ºè€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>director</span> <span class=o>:=</span> <span class=nf>NewDirector</span><span class=p>(</span><span class=nx>builder</span><span class=p>)</span>      <span class=c1>// åˆ›å»ºæŒ‡æŒ¥è€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>director</span><span class=p>.</span><span class=nf>Construct</span><span class=p>()</span>                  <span class=c1>// æŒ‡æŒ¥è€…æ„å»ºäº§å“
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>house</span> <span class=o>:=</span> <span class=nx>builder</span><span class=p>.</span><span class=nf>GetHouse</span><span class=p>()</span> <span class=c1>// è·å–æœ€ç»ˆäº§å“
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>house</span><span class=p>.</span><span class=nf>Show</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åŸå‹æ¨¡å¼prototype->åŸå‹æ¨¡å¼(Prototype) âœ˜</h3><ul><li>å®ƒé€šè¿‡å¤åˆ¶ç°æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡ è€Œä¸æ˜¯é€šè¿‡æ–°å»ºç±»çš„æ–¹å¼</li><li>åŸå‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨å¯¹è±¡çš„å…‹éš†èƒ½åŠ› é¿å…é‡å¤åˆå§‹åŒ– ç‰¹åˆ«é€‚ç”¨äº<strong>åˆ›å»ºæˆæœ¬è¾ƒé«˜</strong>çš„å¯¹è±¡</li></ul><h4 id=ç¤ºä¾‹-4>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åŸå‹æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Prototype</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Clone</span><span class=p>()</span> <span class=nx>Prototype</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“åŸå‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConcretePrototype</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Age</span>  <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConcretePrototype</span><span class=p>)</span> <span class=nf>Clone</span><span class=p>()</span> <span class=nx>Prototype</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ å¹¶å¤åˆ¶å½“å‰å¯¹è±¡çš„å±æ€§
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ConcretePrototype</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span><span class=p>:</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Age</span><span class=p>:</span>  <span class=nx>p</span><span class=p>.</span><span class=nx>Age</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConcretePrototype</span><span class=p>)</span> <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Name: %s, Age: %d&#34;</span><span class=p>,</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Age</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºåŸå‹å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>prototype</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ConcretePrototype</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;Tom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Age</span><span class=p>:</span>  <span class=mi>18</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å…‹éš†åŸå‹å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>clone</span> <span class=o>:=</span> <span class=nx>prototype</span><span class=p>.</span><span class=nf>Clone</span><span class=p>().(</span><span class=o>*</span><span class=nx>ConcretePrototype</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ä¿®æ”¹å…‹éš†å¯¹è±¡å±æ€§
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>clone</span><span class=p>.</span><span class=nx>Name</span> <span class=p>=</span> <span class=s>&#34;Jerry&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>clone</span><span class=p>.</span><span class=nx>Age</span> <span class=p>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è¾“å‡ºåŸå‹å¯¹è±¡å’Œå…‹éš†å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Prototype:&#34;</span><span class=p>,</span> <span class=nx>prototype</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Clone:&#34;</span><span class=p>,</span> <span class=nx>clone</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æ³¨æ„äº‹é¡¹>æ³¨æ„äº‹é¡¹</h4><ul><li>ä½¿ç”¨åŸå‹æ¨¡å¼ å¦‚æœæœ‰<strong>å¼•ç”¨ç±»å‹</strong> åˆ™éœ€è¦è€ƒè™‘æ·±æ‹·è´å’Œæµ…æ‹·è´çš„é—®é¢˜</li><li>æµ…æ‹·è´åªå¤åˆ¶å¯¹è±¡æœ¬èº«è€Œä¸å¤åˆ¶å…¶å¼•ç”¨çš„å¯¹è±¡ æ·±æ‹·è´åˆ™ä¼šé€’å½’åœ°å¤åˆ¶æ•´ä¸ªå¯¹è±¡å›¾</li><li>è¿™éœ€è¦æ ¹æ®éœ€æ±‚é€‰æ‹©é€‚å½“çš„æ‹·è´æ–¹å¼</li></ul><h2 id=ç»“æ„å‹æ¨¡å¼>ç»“æ„å‹æ¨¡å¼</h2><ul><li>ç»“æ„å‹æ¨¡å¼<code>Structural Pattern</code> å®ƒä¸»è¦å…³æ³¨å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡ç»„åˆæˆæ›´å¤§çš„ç»“æ„ ä»¥ä¾¿åœ¨ä¸æ”¹å˜åŸæœ‰ç±»æˆ–å¯¹è±¡çš„æƒ…å†µä¸‹ å®ç°æ–°çš„åŠŸèƒ½æˆ–ä¼˜åŒ–ç³»ç»Ÿç»“æ„</li><li>ç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ç»„åˆ<code>Composition</code>è€Œä¸æ˜¯ç»§æ‰¿<code>Inheritance</code>æ¥å®ç°ä»£ç çš„å¤ç”¨å’Œæ‰©å±•</li><li>å®ƒä»¬å¸®åŠ©å¼€å‘è€…è®¾è®¡å‡ºçµæ´»ã€å¯æ‰©å±•çš„ç³»ç»Ÿç»“æ„ åŒæ—¶é™ä½ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦</li></ul><h3 id=å¤–è§‚æ¨¡å¼facade->å¤–è§‚æ¨¡å¼(Facade) âœ”</h3><ul><li>æ ¹æ®è¿ªç±³ç‰¹æ³•åˆ™ å¦‚æœä¸¤ä¸ªç±»ä¸å¿…å½¼æ­¤ç›´æ¥é€šä¿¡ é‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’ä½œç”¨</li><li>Facadeæ¨¡å¼ä¹Ÿå«å¤–è§‚æ¨¡å¼ æ˜¯ç”±GoFæå‡ºçš„23ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§</li><li>Facadeæ¨¡å¼ä¸ºä¸€ç»„å…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„ç±»ç¾¤ æ¯”å¦‚ç±»åº“/å­ç³»ç»Ÿç­‰ç­‰ æä¾›ä¸€ä¸ªä¸€è‡´çš„ç®€å•çš„ç•Œé¢</li><li>è¿™ä¸ªä¸€è‡´çš„ç®€å•çš„ç•Œé¢è¢«ç§°ä½œfacade</li></ul><h4 id=é€‚ç”¨åœºæ™¯-4>é€‚ç”¨åœºæ™¯</h4><ul><li>å¤æ‚ç³»ç»Ÿéœ€è¦ç®€å•å…¥å£ä½¿ç”¨</li><li>å®¢æˆ·ç«¯ç¨‹åºä¸å¤šä¸ªå­ç³»ç»Ÿä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„ä¾èµ–æ€§</li><li>åœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ å¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰ç³»ç»Ÿä¸­æ¯ä¸€å±‚çš„å…¥å£ å±‚ä¸å±‚ä¹‹é—´ä¸ç›´æ¥äº§ç”Ÿè”ç³» è€Œé€šè¿‡å¤–è§‚ç±»å»ºç«‹è”ç³» é™ä½å±‚ä¹‹é—´çš„è€¦åˆåº¦</li></ul><h4 id=ä¼˜ç‚¹-3>ä¼˜ç‚¹</h4><ul><li>å®ƒå¯¹å®¢æˆ·ç«¯å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ å‡å°‘äº†å®¢æˆ·ç«¯æ‰€éœ€å¤„ç†çš„å¯¹è±¡æ•°ç›® å¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“</li><li>é€šè¿‡å¼•å…¥å¤–è§‚æ¨¡å¼ å®¢æˆ·ç«¯ä»£ç å°†å˜å¾—å¾ˆç®€å• ä¸ä¹‹å…³è”çš„å¯¹è±¡ä¹Ÿå¾ˆå°‘</li><li>å®ƒå®ç°äº†å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯ä¹‹é—´çš„æ¾è€¦åˆå…³ç³» è¿™ä½¿å¾—å­ç³»ç»Ÿçš„å˜åŒ–ä¸ä¼šå½±å“åˆ°è°ƒç”¨å®ƒçš„å®¢æˆ·ç«¯ åªéœ€è¦è°ƒæ•´å¤–è§‚ç±»å³å¯</li><li>ä¸€ä¸ªå­ç³»ç»Ÿçš„ä¿®æ”¹å¯¹å…¶ä»–å­ç³»ç»Ÿæ²¡æœ‰ä»»ä½•å½±å“</li></ul><h4 id=ç¼ºç‚¹-3>ç¼ºç‚¹</h4><ul><li>ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨å­ç³»ç»Ÿç±» å¦‚æœå¯¹å®¢æˆ·ç«¯è®¿é—®å­ç³»ç»Ÿç±»åšå¤ªå¤šçš„é™åˆ¶åˆ™å‡å°‘äº†å¯å˜æ€§å’Œçµæ´»æ€§</li><li>å¦‚æœè®¾è®¡ä¸å½“ å¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»çš„æºä»£ç  è¿èƒŒäº†å¼€é—­åŸåˆ™</li></ul><h4 id=ç¤ºä¾‹-5>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemA</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sa</span> <span class=o>*</span><span class=nx>SubSystemA</span><span class=p>)</span> <span class=nf>MethodA</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å­ç³»ç»Ÿæ–¹æ³•A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemB</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sb</span> <span class=o>*</span><span class=nx>SubSystemB</span><span class=p>)</span> <span class=nf>MethodB</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å­ç³»ç»Ÿæ–¹æ³•B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemC</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sc</span> <span class=o>*</span><span class=nx>SubSystemC</span><span class=p>)</span> <span class=nf>MethodC</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å­ç³»ç»Ÿæ–¹æ³•C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemD</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sd</span> <span class=o>*</span><span class=nx>SubSystemD</span><span class=p>)</span> <span class=nf>MethodD</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å­ç³»ç»Ÿæ–¹æ³•D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å¤–è§‚æ¨¡å¼ æä¾›äº†ä¸€ä¸ªå¤–è§‚ç±» ç®€åŒ–æˆä¸€ä¸ªç®€å•çš„æ¥å£ä¾›ä½¿ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Facade</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>a</span> <span class=o>*</span><span class=nx>SubSystemA</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span> <span class=o>*</span><span class=nx>SubSystemB</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span> <span class=o>*</span><span class=nx>SubSystemC</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span> <span class=o>*</span><span class=nx>SubSystemD</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Facade</span><span class=p>)</span> <span class=nf>MethodOne</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>a</span><span class=p>.</span><span class=nf>MethodA</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>b</span><span class=p>.</span><span class=nf>MethodB</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Facade</span><span class=p>)</span> <span class=nf>MethodTwo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>c</span><span class=p>.</span><span class=nf>MethodC</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>d</span><span class=p>.</span><span class=nf>MethodD</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å¦‚æœä¸ç”¨å¤–è§‚æ¨¡å¼å®ç°MethodA() å’Œ MethodB()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>sa</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemA</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>sa</span><span class=p>.</span><span class=nf>MethodA</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>sb</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>sb</span><span class=p>.</span><span class=nf>MethodB</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;-----------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨å¤–è§‚æ¨¡å¼
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>f</span> <span class=o>:=</span> <span class=nx>Facade</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>a</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemA</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemB</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemC</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>d</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemD</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è°ƒç”¨å¤–è§‚åŒ…è£¹æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>f</span><span class=p>.</span><span class=nf>MethodOne</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ç¤ºä¾‹2</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç”µè§†æœº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TV</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TV</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;æ‰“å¼€ ç”µè§†æœº&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TV</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å…³é—­ ç”µè§†æœº&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// éŸ³ç®±
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>VoiceBox</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>VoiceBox</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;æ‰“å¼€ éŸ³ç®±&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>VoiceBox</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å…³é—­ éŸ³ç®±&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç¯å…‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Light</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>l</span> <span class=o>*</span><span class=nx>Light</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;æ‰“å¼€ ç¯å…‰&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>l</span> <span class=o>*</span><span class=nx>Light</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å…³é—­ ç¯å…‰&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ¸¸æˆæœº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Xbox</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>x</span> <span class=o>*</span><span class=nx>Xbox</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;æ‰“å¼€ æ¸¸æˆæœº&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>x</span> <span class=o>*</span><span class=nx>Xbox</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å…³é—­ æ¸¸æˆæœº&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// éº¦å…‹é£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MicroPhone</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MicroPhone</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;æ‰“å¼€ éº¦å…‹é£&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MicroPhone</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å…³é—­ éº¦å…‹é£&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æŠ•å½±ä»ª
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Projector</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Projector</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;æ‰“å¼€ æŠ•å½±ä»ª&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Projector</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å…³é—­ æŠ•å½±ä»ª&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®¶åº­å½±é™¢(å¤–è§‚)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HomePlayerFacade</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>tv</span> <span class=nx>TV</span>
</span></span><span class=line><span class=cl>    <span class=nx>vb</span> <span class=nx>VoiceBox</span>
</span></span><span class=line><span class=cl>    <span class=nx>light</span> <span class=nx>Light</span>
</span></span><span class=line><span class=cl>    <span class=nx>xbox</span> <span class=nx>Xbox</span>
</span></span><span class=line><span class=cl>    <span class=nx>mp</span> <span class=nx>MicroPhone</span>
</span></span><span class=line><span class=cl>    <span class=nx>pro</span> <span class=nx>Projector</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// KTVæ¨¡å¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>hp</span> <span class=o>*</span><span class=nx>HomePlayerFacade</span><span class=p>)</span> <span class=nf>DoKTV</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å®¶åº­å½±é™¢è¿›å…¥KTVæ¨¡å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>tv</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>pro</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>mp</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>light</span><span class=p>.</span><span class=nf>Off</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>vb</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ¸¸æˆæ¨¡å¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>hp</span> <span class=o>*</span><span class=nx>HomePlayerFacade</span><span class=p>)</span> <span class=nf>DoGame</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;å®¶åº­å½±é™¢è¿›å…¥Gameæ¨¡å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>tv</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>light</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>xbox</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>homePlayer</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>HomePlayerFacade</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>homePlayer</span><span class=p>.</span><span class=nf>DoKTV</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;------------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>homePlayer</span><span class=p>.</span><span class=nf>DoGame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=é€‚é…å™¨æ¨¡å¼adapter->é€‚é…å™¨æ¨¡å¼(Adapter) âœ”</h3><ul><li>å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£</li><li>ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ</li></ul><h4 id=ä¼˜ç‚¹-4>ä¼˜ç‚¹</h4><ul><li>å°†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»è§£è€¦ é€šè¿‡å¼•å…¥ä¸€ä¸ªé€‚é…å™¨ç±»æ¥é‡ç”¨ç°æœ‰çš„é€‚é…è€…ç±» æ— é¡»ä¿®æ”¹åŸæœ‰ç»“æ„</li><li>å¢åŠ äº†ç±»çš„é€æ˜æ€§å’Œå¤ç”¨æ€§ å°†å…·ä½“çš„ä¸šåŠ¡å®ç°è¿‡ç¨‹å°è£…åœ¨é€‚é…è€…ç±»ä¸­ å¯¹äºå®¢æˆ·ç«¯ç±»è€Œè¨€æ˜¯é€æ˜çš„ è€Œä¸”æé«˜äº†é€‚é…è€…çš„å¤ç”¨æ€§ åŒä¸€ä¸ªé€‚é…è€…ç±»å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„ç³»ç»Ÿä¸­å¤ç”¨</li><li>çµæ´»æ€§å’Œæ‰©å±•æ€§éƒ½éå¸¸å¥½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›´æ¢é€‚é…å™¨ ä¹Ÿå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„é€‚é…å™¨ç±» å®Œå…¨ç¬¦åˆ<strong>å¼€é—­åŸåˆ™</strong></li></ul><h4 id=ç¼ºç‚¹-4>ç¼ºç‚¹</h4><ul><li>é€‚é…å™¨ä¸­ç½®æ¢é€‚é…è€…ç±»çš„æŸäº›æ–¹æ³•æ¯”è¾ƒéº»çƒ¦</li></ul><h4 id=ç¤ºä¾‹-6>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// é€‚é…çš„ç›®æ ‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>V5</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Use5V</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¸šåŠ¡ç±» ä¾èµ–V5æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Phone</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>v</span> <span class=nx>V5</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewPhone</span><span class=p>(</span><span class=nx>v</span> <span class=nx>V5</span><span class=p>)</span> <span class=o>*</span><span class=nx>Phone</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Phone</span><span class=p>{</span><span class=nx>v</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Phone</span><span class=p>)</span> <span class=nf>Charge</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Phoneè¿›è¡Œå……ç”µ...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>v</span><span class=p>.</span><span class=nf>Use5V</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è¢«é€‚é…çš„è§’è‰² é€‚é…è€…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>V220</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>V220</span><span class=p>)</span> <span class=nf>Use220V</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;ä½¿ç”¨220Vçš„ç”µå‹&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç”µæºé€‚é…å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Adapter</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>v220</span> <span class=o>*</span><span class=nx>V220</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>Adapter</span><span class=p>)</span> <span class=nf>Use5V</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;ä½¿ç”¨é€‚é…å™¨è¿›è¡Œå……ç”µ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è°ƒç”¨é€‚é…è€…çš„æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>a</span><span class=p>.</span><span class=nx>v220</span><span class=p>.</span><span class=nf>Use220V</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewAdapter</span><span class=p>(</span><span class=nx>v220</span> <span class=o>*</span><span class=nx>V220</span><span class=p>)</span> <span class=o>*</span><span class=nx>Adapter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Adapter</span><span class=p>{</span><span class=nx>v220</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ------- ä¸šåŠ¡é€»è¾‘å±‚ -------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>iphone</span> <span class=o>:=</span> <span class=nf>NewPhone</span><span class=p>(</span><span class=nf>NewAdapter</span><span class=p>(</span><span class=nb>new</span><span class=p>(</span><span class=nx>V220</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>iphone</span><span class=p>.</span><span class=nf>Charge</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ä»£ç†æ¨¡å¼proxy->ä»£ç†æ¨¡å¼(Proxy) âœ”</h3><ul><li>å®ƒé€šè¿‡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥æ§åˆ¶å¯¹å¦ä¸€ä¸ªå¯¹è±¡çš„è®¿é—®</li><li>ä»£ç†æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ä¸æ”¹å˜åŸå§‹å¯¹è±¡çš„æƒ…å†µä¸‹ é€šè¿‡ä»£ç†å¯¹è±¡æ¥å¢å¼ºæˆ–é™åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®</li></ul><h4 id=é€‚ç”¨åœºæ™¯-5>é€‚ç”¨åœºæ™¯</h4><ul><li><code>å»¶è¿Ÿåˆå§‹åŒ–</code> å½“å¯¹è±¡çš„åˆ›å»ºæˆæœ¬è¾ƒé«˜æ—¶ å¯ä»¥é€šè¿‡ä»£ç†å»¶è¿Ÿå¯¹è±¡çš„åˆå§‹åŒ–</li><li><code>è®¿é—®æ§åˆ¶</code> é€šè¿‡ä»£ç†å¯¹è±¡é™åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®æƒé™</li><li><code>æ—¥å¿—è®°å½•</code> é€šè¿‡ä»£ç†å¯¹è±¡è®°å½•å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®æ—¥å¿—</li><li><code>ç¼“å­˜</code> é€šè¿‡ä»£ç†å¯¹è±¡ç¼“å­˜åŸå§‹å¯¹è±¡çš„ç»“æœ é¿å…é‡å¤è®¡ç®—</li></ul><h4 id=ç¤ºä¾‹-7>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¸»é¢˜æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Subject</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Request</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// çœŸå®å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>RealSubject</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>RealSubject</span><span class=p>)</span> <span class=nf>Request</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;RealSubject: Handling Request&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä»£ç†å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Proxy</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>realSubject</span> <span class=o>*</span><span class=nx>RealSubject</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewProxy</span><span class=p>()</span> <span class=o>*</span><span class=nx>Proxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Proxy</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Proxy</span><span class=p>)</span> <span class=nf>Request</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å»¶è¿Ÿåˆå§‹åŒ–çœŸå®å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=nx>p</span><span class=p>.</span><span class=nx>realSubject</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Proxy: Lazy Initialzing RealSubject&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>p</span><span class=p>.</span><span class=nx>realSubject</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>RealSubject</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¿é—®æ§åˆ¶
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Proxy: Checking Access&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span> <span class=c1>//  æ¨¡æ‹Ÿè®¿é—®æ§åˆ¶é€»è¾‘
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>p</span><span class=p>.</span><span class=nx>realSubject</span><span class=p>.</span><span class=nf>Request</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ—¥å¿—è®°å½•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Proxy: Logging Request&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>proxy</span> <span class=o>:=</span> <span class=nf>NewProxy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// é€šè¿‡ä»£ç†å¯¹è±¡è®¿é—®çœŸå®å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>proxy</span><span class=p>.</span><span class=nf>Request</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç»„åˆæ¨¡å¼composite->ç»„åˆæ¨¡å¼(Composite) âœ˜</h3><ul><li>å®ƒå…è®¸ä½ å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„æ¥è¡¨ç¤º<code>éƒ¨åˆ†-æ•´ä½“</code>çš„å±‚æ¬¡å…³ç³»</li><li>ç»„åˆæ¨¡å¼è®©å®¢æˆ·ç«¯å¯ä»¥ç»Ÿä¸€åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œå¯¹è±¡ç»„åˆ</li></ul><h4 id=é€‚ç”¨åœºæ™¯-6>é€‚ç”¨åœºæ™¯</h4><ul><li>æ–‡ä»¶ç³»ç»Ÿï¼šå¦‚ç›®å½•å’Œæ–‡ä»¶çš„ç®¡ç† å¯ä»¥é€šè¿‡ç»„åˆæ¨¡å¼å°†æ–‡ä»¶å¤¹è§†ä¸ºç»„åˆèŠ‚ç‚¹ æ–‡ä»¶è§†ä¸ºå¶å­èŠ‚ç‚¹</li><li>ç»„ç»‡ç»“æ„ï¼šå¦‚å…¬å¸å†…éƒ¨çš„éƒ¨é—¨å’Œå‘˜å·¥å…³ç³» å¯ä»¥é€šè¿‡ç»„åˆæ¨¡å¼å°†éƒ¨é—¨è§†ä¸ºç»„åˆèŠ‚ç‚¹ å‘˜å·¥è§†ä¸ºå¶å­èŠ‚ç‚¹</li></ul><h4 id=ä¼˜ç‚¹-5>ä¼˜ç‚¹</h4><ul><li>ç®€åŒ–å®¢æˆ·ç«¯ä»£ç ï¼šå®¢æˆ·ç«¯å¯ä»¥ä¸€è‡´åœ°å¯¹å¾…å•ä¸ªå¯¹è±¡å’Œå¯¹è±¡ç»„åˆ è€Œä¸éœ€è¦å…³å¿ƒå®ƒä»¬çš„å…·ä½“ç±»å‹</li><li>å¢å¼ºçµæ´»æ€§ï¼šå¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹è½»æ¾æ·»åŠ æ–°çš„ç»„ä»¶æˆ–ä¿®æ”¹ç°æœ‰ç»„ä»¶çš„ç»“æ„</li><li>æé«˜å¯æ‰©å±•æ€§ï¼šæ”¯æŒé€’å½’ç»„åˆ ä½¿å¾—å¤æ‚çš„å±‚æ¬¡ç»“æ„æ˜“äºæ„å»ºå’Œç»´æŠ¤</li></ul><h4 id=ç¤ºä¾‹-8>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç»„ä»¶æ¥å£ï¼šæ–‡ä»¶ç³»ç»ŸèŠ‚ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>FileSystemNode</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å¶å­èŠ‚ç‚¹ï¼šæ–‡ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>File</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>File</span><span class=p>)</span> <span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>indent</span> <span class=o>+</span> <span class=nx>f</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç»„åˆèŠ‚ç‚¹ï¼šæ–‡ä»¶å¤¹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Folder</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>children</span> <span class=p>[]</span><span class=nx>FileSystemNode</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Folder</span><span class=p>)</span> <span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>indent</span> <span class=o>+</span> <span class=nx>f</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>child</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>f</span><span class=p>.</span><span class=nx>children</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>child</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=o>+</span> <span class=s>&#34;  &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Folder</span><span class=p>)</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>child</span> <span class=nx>FileSystemNode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>children</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>f</span><span class=p>.</span><span class=nx>children</span><span class=p>,</span> <span class=nx>child</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®¢æˆ·ç«¯ä»£ç 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºæ–‡ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>file1</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>File</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;file1.txt&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>file2</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>File</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;file2.txt&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>file3</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>File</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;file3.txt&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºæ–‡ä»¶å¤¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>folder1</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Folder</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Folder1&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>folder2</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Folder</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Folder2&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å°†æ–‡ä»¶æ·»åŠ åˆ°æ–‡ä»¶å¤¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>folder1</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>file1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>folder1</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>file2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>folder2</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>file3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å°†æ–‡ä»¶å¤¹æ·»åŠ åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>rootFolder</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Folder</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Root&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>rootFolder</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>folder1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>rootFolder</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>folder2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç»“æ„
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>rootFolder</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>è¾“å‡ºï¼š
</span></span></span><span class=line><span class=cl><span class=cm>Root
</span></span></span><span class=line><span class=cl><span class=cm>  Folder1
</span></span></span><span class=line><span class=cl><span class=cm>    file1.txt
</span></span></span><span class=line><span class=cl><span class=cm>    file2.txt
</span></span></span><span class=line><span class=cl><span class=cm>  Folder2
</span></span></span><span class=line><span class=cl><span class=cm>    file3.txt
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=äº«å…ƒæ¨¡å¼flyweight->äº«å…ƒæ¨¡å¼(Flyweight) âœ˜</h3><ul><li>å®ƒé€šè¿‡å…±äº«å¯¹è±¡æ¥å‡å°‘å†…å­˜ä½¿ç”¨å’Œæé«˜æ€§èƒ½</li><li>äº«å…ƒæ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¯¹è±¡çš„å…±äº«éƒ¨åˆ†(å†…éƒ¨çŠ¶æ€)ä¸ä¸å¯å…±äº«éƒ¨åˆ†(å¤–éƒ¨çŠ¶æ€)åˆ†ç¦» ä»è€Œå‡å°‘é‡å¤å¯¹è±¡çš„åˆ›å»º</li><li>äº«å…ƒæ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³<ul><li><code>å…±äº«å¯¹è±¡</code> äº«å…ƒæ¨¡å¼é€šè¿‡å…±äº«ç›¸åŒçš„å†…åœ¨çŠ¶æ€(å†…éƒ¨çŠ¶æ€)æ¥å‡å°‘å†…å­˜ä½¿ç”¨</li><li><code>åˆ†ç¦»çŠ¶æ€</code> å°†å¯¹è±¡çš„çŠ¶æ€åˆ†ä¸ºå†…éƒ¨çŠ¶æ€(å¯å…±äº«)å’Œå¤–éƒ¨çŠ¶æ€(ä¸å¯å…±äº«)</li><li><code>å·¥å‚ç®¡ç†</code> ä½¿ç”¨å·¥å‚æ¨¡å¼æ¥ç®¡ç†å’Œå¤ç”¨äº«å…ƒå¯¹è±¡</li></ul></li></ul><h4 id=ç¤ºä¾‹-9>ç¤ºä¾‹</h4><ul><li>åœ¨æ•°æ®åº“æ“ä½œä¸­ åˆ›å»ºå’Œé”€æ¯è¿æ¥æ˜¯éå¸¸è€—æ—¶çš„æ“ä½œ</li><li>ä¸ºäº†æé«˜æ€§èƒ½ é€šå¸¸ä¼šä½¿ç”¨è¿æ¥æ± æ¥ç®¡ç†æ•°æ®åº“è¿æ¥ è¿æ¥æ± çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<ul><li>å¤ç”¨è¿æ¥ï¼šä»è¿æ¥æ± ä¸­è·å–è¿æ¥ ä½¿ç”¨å®Œåå°†è¿æ¥é‡Šæ”¾å›è¿æ¥æ±  è€Œä¸æ˜¯é”€æ¯</li><li>å‡å°‘å¼€é”€ï¼šé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥ ä»è€Œæé«˜æ€§èƒ½</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// äº«å…ƒæ¥å£ï¼šæ•°æ®åº“è¿æ¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Connection</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“äº«å…ƒï¼šæ•°æ®åº“è¿æ¥å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConcreteConnection</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>ConcreteConnection</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Connection %d executing query: %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// äº«å…ƒå·¥å‚ï¼šè¿æ¥æ± 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConnectionPool</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>connections</span> <span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=nx>Connection</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>       <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl>    <span class=nx>nextID</span>      <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewConnectionPool</span><span class=p>()</span> <span class=o>*</span><span class=nx>ConnectionPool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ConnectionPool</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>connections</span><span class=p>:</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=nx>Connection</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>nextID</span><span class=p>:</span>      <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è·å–è¿æ¥å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConnectionPool</span><span class=p>)</span> <span class=nf>GetConnection</span><span class=p>()</span> <span class=nx>Connection</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>conn</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nb>delete</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>conn</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºæ–°çš„è¿æ¥å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>conn</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ConcreteConnection</span><span class=p>{</span><span class=nx>id</span><span class=p>:</span> <span class=nx>p</span><span class=p>.</span><span class=nx>nextID</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>nextID</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>conn</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å°†è¿æ¥å¯¹è±¡é‡Šæ”¾å›è¿æ¥æ±  ä»¥ä¾¿å…¶ä»–å®¢æˆ·ç«¯å¯ä»¥å¤ç”¨è¿™ä¸ªè¿æ¥å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConnectionPool</span><span class=p>)</span> <span class=nf>ReleaseConnection</span><span class=p>(</span><span class=nx>conn</span> <span class=nx>Connection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>c</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>conn</span><span class=p>.(</span><span class=o>*</span><span class=nx>ConcreteConnection</span><span class=p>);</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>[</span><span class=nx>c</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span> <span class=p>=</span> <span class=nx>c</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®¢æˆ·ç«¯ä»£ç 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>pool</span> <span class=o>:=</span> <span class=nf>NewConnectionPool</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>conn1</span> <span class=o>:=</span> <span class=nx>pool</span><span class=p>.</span><span class=nf>GetConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn1</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=s>&#34;SELECT * FROM users&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>pool</span><span class=p>.</span><span class=nf>ReleaseConnection</span><span class=p>(</span><span class=nx>conn1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>conn2</span> <span class=o>:=</span> <span class=nx>pool</span><span class=p>.</span><span class=nf>GetConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn2</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=s>&#34;SELECT * FROM orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>pool</span><span class=p>.</span><span class=nf>ReleaseConnection</span><span class=p>(</span><span class=nx>conn2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Connection 1 executing query: SELECT * FROM users
</span></span></span><span class=line><span class=cl><span class=cm>Connection 1 executing query: SELECT * FROM orders
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è£…é¥°æ¨¡å¼decorator->è£…é¥°æ¨¡å¼(Decorator) âœ”</h3><ul><li>å®ƒå…è®¸ä½ åŠ¨æ€åœ°ä¸ºå¯¹è±¡æ·»åŠ è¡Œä¸ºæˆ–èŒè´£ è€Œä¸éœ€è¦ä¿®æ”¹å¯¹è±¡çš„åŸå§‹ç±»</li><li>é€šè¿‡å¼•å…¥è£…é¥°è€…ç±» å¯ä»¥åœ¨è¿è¡Œæ—¶çµæ´»åœ°ç»„åˆä¸åŒçš„åŠŸèƒ½ è€Œä¸éœ€è¦åˆ›å»ºå¤§é‡çš„å­ç±»</li><li>è£…é¥°è€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¯¹è±¡åŒ…è£…åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªè£…é¥°è€…ä¸­ æ¯ä¸ªè£…é¥°è€…éƒ½å¯ä»¥åœ¨è°ƒç”¨è¢«è£…é¥°å¯¹è±¡çš„æ–¹æ³•ä¹‹å‰æˆ–ä¹‹åæ·»åŠ é¢å¤–çš„è¡Œä¸º</li></ul><h4 id=ä¼˜ç‚¹-6>ä¼˜ç‚¹</h4><ul><li>åŠ¨æ€æ‰©å±•åŠŸèƒ½<ul><li>ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶ä¸ºè¯·æ±‚å¤„ç†å™¨æ·»åŠ æ—¥å¿—è®°å½•å’Œæ€§èƒ½ç›‘æ§åŠŸèƒ½ è€Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒè¯·æ±‚å¤„ç†å™¨çš„ä»£ç </li></ul></li><li>å•ä¸€èŒè´£åŸåˆ™<ul><li>æ¯ä¸ªè£…é¥°å™¨åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½(å¦‚æ—¥å¿—è®°å½•æˆ–æ€§èƒ½ç›‘æ§) ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™</li></ul></li><li>çµæ´»æ€§<ul><li>å¯ä»¥è½»æ¾åœ°æ·»åŠ æˆ–ç§»é™¤è£…é¥°å™¨ è€Œä¸ä¼šå½±å“å…¶ä»–éƒ¨åˆ†çš„ä»£ç </li></ul></li></ul><h4 id=ç¤ºä¾‹-10>ç¤ºä¾‹</h4><ul><li>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªWebæœåŠ¡ å…¶ä¸­æœ‰ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½æ˜¯å¤„ç†ç”¨æˆ·è¯·æ±‚</li><li>ç°åœ¨ ä½ éœ€è¦åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒåŠŸèƒ½ä»£ç çš„æƒ…å†µä¸‹ ä¸ºè¯·æ±‚å¤„ç†æ·»åŠ ä»¥ä¸‹åŠŸèƒ½<ul><li>æ—¥å¿—è®°å½•ï¼šè®°å½•æ¯ä¸ªè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯</li><li>æ€§èƒ½ç›‘æ§ï¼šè®°å½•æ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´</li></ul></li><li>ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ ä½ å¯ä»¥è½»æ¾åœ°å®ç°è¿™äº›åŠŸèƒ½ è€Œæ— éœ€ä¿®æ”¹åŸå§‹è¯·æ±‚å¤„ç†é€»è¾‘</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç»„ä»¶æ¥å£ï¼šè¯·æ±‚å¤„ç†å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>RequestHandler</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CoreRequestHandler</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>handler</span> <span class=o>*</span><span class=nx>CoreRequestHandler</span><span class=p>)</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>100</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Response from %s&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è£…é¥°å™¨: æ—¥å¿—è®°å½•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>LoggingDecorator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>handler</span> <span class=nx>RequestHandler</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>l</span> <span class=o>*</span><span class=nx>LoggingDecorator</span><span class=p>)</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;LoggingDecorator: Request to %s\n&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span> <span class=o>:=</span> <span class=nx>l</span><span class=p>.</span><span class=nx>handler</span><span class=p>.</span><span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Logging: Response for %s: %s\n&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è£…é¥°å™¨ï¼šæ€§èƒ½ç›‘æ§
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PerformanceMonitorDecorator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>handler</span> <span class=nx>RequestHandler</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PerformanceMonitorDecorator</span><span class=p>)</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è®°å½•å¼€å§‹æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>start</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è°ƒç”¨åŸå§‹å¤„ç†å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>response</span> <span class=o>:=</span> <span class=nx>p</span><span class=p>.</span><span class=nx>handler</span><span class=p>.</span><span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è®°å½•å¤„ç†æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>duration</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Since</span><span class=p>(</span><span class=nx>start</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Performance: Request for %s took %v\n&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>duration</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºè¯·æ±‚å¤„ç†å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>handler</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>CoreRequestHandler</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ·»åŠ æ—¥å¿—è®°å½•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>loggingHandler</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>LoggingDecorator</span><span class=p>{</span><span class=nx>handler</span><span class=p>:</span> <span class=nx>handler</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ·»åŠ æ€§èƒ½ç›‘æ§
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>monitorHandler</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>PerformanceMonitorDecorator</span><span class=p>{</span><span class=nx>handler</span><span class=p>:</span> <span class=nx>loggingHandler</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å¤„ç†è¯·æ±‚
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>monitorHandler</span><span class=p>.</span><span class=nf>HandleRequest</span><span class=p>(</span><span class=s>&#34;http://www.baidu.com&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ¡¥æ¨¡å¼bridge->æ¡¥æ¨¡å¼(Bridge) âœ˜</h3><ul><li>å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦» ä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–</li><li>é€šè¿‡è¿™ç§æ–¹å¼ æ¡¥æ¥æ¨¡å¼èƒ½å¤Ÿé¿å…ç±»çš„æ•°é‡çˆ†ç‚¸(å³ç±»çš„ç»„åˆå‘ˆæŒ‡æ•°å¢é•¿) åŒæ—¶æé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§</li></ul><h4 id=ç¤ºä¾‹-11>ç¤ºä¾‹</h4><ul><li>å‡è®¾ä½ æœ‰ä¸¤å°ç”µè„‘ï¼šä¸€å° Mac å’Œä¸€å° Windows è¿˜æœ‰ä¸¤å°æ‰“å°æœºï¼šçˆ±æ™®ç”Ÿå’Œæƒ æ™®</li><li>è¿™ä¸¤å°ç”µè„‘å’Œæ‰“å°æœºå¯èƒ½ä¼šä»»æ„ç»„åˆä½¿ç”¨</li><li>åˆšå¼€å§‹åŠŸèƒ½ä¼šè¿™æ ·å†™ windowsç»„åˆçˆ±æ™®ç”Ÿå’Œæƒ æ™® macç»„åˆçˆ±æ™®ç”Ÿå’Œæƒ æ™® æ‰“å°å°±è°ƒç”¨è‡ªå·±çš„printæ–¹æ³•</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Mac + Epson
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MacEpson</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MacEpson</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for mac&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a EPSON Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Mac + HP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MacHp</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MacHp</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for mac&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a HP Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Windows + Epson
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WindowsEpson</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WindowsEpson</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a EPSON Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Windows + HP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WindowsHp</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WindowsHp</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a HP Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>ä½†æ˜¯ å¦‚æœå¼•å…¥æ–°çš„æ‰“å°æœº ä»£ç é‡ä¼šæˆå€å¢é•¿</li><li>æ‰€ä»¥ æˆ‘ä»¬éœ€è¦æŠŠè®¡ç®—æœºå’Œæ‰“å°æœºè§£è€¦ è®¡ç®—æœºçš„printçš„æ–¹æ³• å°±æ¡¥æ¥åˆ°é€‰æ‹©çš„æ‰“å°æœºçš„printæ–¹æ³•ä¸Š</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰Printeræ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Printer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>PrintFile</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰Epsonæ‰“å°æœº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Epson</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Epson</span><span class=p>)</span> <span class=nf>PrintFile</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by Epson printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰æƒ æ™®æ‰“å°æœº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HP</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HP</span><span class=p>)</span> <span class=nf>PrintFile</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by HP printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰Computeræ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Computer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>Printer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰Macè®¡ç®—æœº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Mac</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>printer</span> <span class=nx>Printer</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>Mac</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for Mac&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>m</span><span class=p>.</span><span class=nx>printer</span><span class=p>.</span><span class=nf>PrintFile</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>Mac</span><span class=p>)</span> <span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>p</span> <span class=nx>Printer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>m</span><span class=p>.</span><span class=nx>printer</span> <span class=p>=</span> <span class=nx>p</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰windowsè®¡ç®—æœº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Windows</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>printer</span> <span class=nx>Printer</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>Windows</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for Windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>printer</span><span class=p>.</span><span class=nf>PrintFile</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>Windows</span><span class=p>)</span> <span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>p</span> <span class=nx>Printer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>printer</span> <span class=p>=</span> <span class=nx>p</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºæ‰“å°æœºå®ä¾‹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hpPrinter</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>HP</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>epsonPrinter</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Epson</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºè®¡ç®—æœºå®ä¾‹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>macComputer</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Mac</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>winComputer</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Windows</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Mac ä½¿ç”¨ HP æ‰“å°æœº
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>hpPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Mac ä½¿ç”¨ Epson æ‰“å°æœº
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>epsonPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Windows ä½¿ç”¨ HP æ‰“å°æœº
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>hpPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Windows ä½¿ç”¨ Epson æ‰“å°æœº
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>epsonPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ä¼˜ç‚¹-7>ä¼˜ç‚¹</h4><ul><li>è§£è€¦<ul><li>æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†å¯ä»¥ç‹¬ç«‹å˜åŒ– äº’ä¸å½±å“</li><li>ä¿®æ”¹å®ç°éƒ¨åˆ†ä¸ä¼šå½±å“æŠ½è±¡éƒ¨åˆ†çš„ä»£ç </li></ul></li><li>çµæ´»æ€§<ul><li>å¯ä»¥åŠ¨æ€åœ°åˆ‡æ¢å®ç°éƒ¨åˆ†(ä¾‹å¦‚ è¿è¡Œæ—¶æ›´æ¢å®ç°)</li></ul></li><li>å¯æ‰©å±•æ€§<ul><li>æ–°å¢æŠ½è±¡éƒ¨åˆ†æˆ–å®ç°éƒ¨åˆ†æ—¶ ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç </li></ul></li><li>é¿å…ç±»çˆ†ç‚¸<ul><li>é€šè¿‡ç»„åˆä»£æ›¿ç»§æ‰¿ é¿å…äº†ç±»çš„æ•°é‡å‘ˆæŒ‡æ•°å¢é•¿</li></ul></li></ul><h2 id=è¡Œä¸ºå‹æ¨¡å¼>è¡Œä¸ºå‹æ¨¡å¼</h2><ul><li>è¡Œä¸ºå‹æ¨¡å¼<code>Behavioral pattern</code> å®ƒä¸»è¦å…³æ³¨å¯¹è±¡ä¹‹é—´çš„èŒè´£åˆ†é…å’Œé€šä¿¡æ–¹å¼</li><li>è¡Œä¸ºå‹æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å®šä¹‰å¯¹è±¡ä¹‹é—´çš„äº¤äº’æ–¹å¼ æ¥æ›´å¥½åœ°å®ç°ç³»ç»Ÿçš„åŠŸèƒ½ åŒæ—¶é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦</li></ul><h3 id=ä¸­ä»‹è€…æ¨¡å¼mediator>ä¸­ä»‹è€…æ¨¡å¼(Mediator)</h3><ul><li>å®ƒé€šè¿‡å¼•å…¥ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡æ¥å°è£…ä¸€ç»„å¯¹è±¡ä¹‹é—´çš„äº¤äº’</li><li>ä¸­ä»‹è€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ å°†å¯¹è±¡ä¹‹é—´çš„å¤æ‚äº¤äº’é›†ä¸­åˆ°ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡ä¸­ ä»è€Œå‡å°‘å¯¹è±¡ä¹‹é—´çš„ç›´æ¥è€¦åˆ</li></ul><h4 id=ä¼˜ç‚¹-8>ä¼˜ç‚¹</h4><ul><li>å‡å°‘è€¦åˆï¼šå¯¹è±¡ä¹‹é—´ä¸ç›´æ¥é€šä¿¡ è€Œæ˜¯é€šè¿‡ä¸­ä»‹è€…è¿›è¡Œäº¤äº’ å‡å°‘äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆ</li><li>é›†ä¸­æ§åˆ¶ï¼šå°†å¯¹è±¡ä¹‹é—´çš„äº¤äº’é€»è¾‘é›†ä¸­åˆ°ä¸­ä»‹è€…ä¸­ ä¾¿äºç»´æŠ¤å’Œæ‰©å±•</li><li>ç®€åŒ–å¯¹è±¡èŒè´£ï¼šæ¯ä¸ªå¯¹è±¡åªéœ€è¦å…³æ³¨è‡ªå·±çš„è¡Œä¸º è€Œä¸éœ€è¦çŸ¥é“å…¶ä»–å¯¹è±¡çš„å­˜åœ¨</li></ul><h4 id=ç¤ºä¾‹-12>ç¤ºä¾‹</h4><ul><li>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªèŠå¤©å®¤ç³»ç»Ÿ ç”¨æˆ·(åŒäº‹ç±»)ä¹‹é—´é€šè¿‡èŠå¤©å®¤(ä¸­ä»‹è€…)å‘é€æ¶ˆæ¯</li><li>ç”¨æˆ·ä¹‹é—´ä¸ç›´æ¥é€šä¿¡ è€Œæ˜¯é€šè¿‡èŠå¤©å®¤æ¥è½¬å‘æ¶ˆæ¯</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰ä¸­ä»‹è€…æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Mediator</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>SendMessage</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>sender</span> <span class=nx>Colleague</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“ä¸­ä»‹è€…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ChatRoom</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>users</span> <span class=p>[]</span><span class=nx>Colleague</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>ChatRoom</span><span class=p>)</span> <span class=nf>Register</span><span class=p>(</span><span class=nx>user</span> <span class=nx>Colleague</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>users</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>users</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>ChatRoom</span><span class=p>)</span> <span class=nf>SendMessage</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>sender</span> <span class=nx>Colleague</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>user</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>c</span><span class=p>.</span><span class=nx>users</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>user</span> <span class=o>!=</span> <span class=nx>sender</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>user</span><span class=p>.</span><span class=nf>Receive</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰åŒäº‹ç±»æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Colleague</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Send</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>Receive</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“åŒäº‹ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>mediator</span> <span class=nx>Mediator</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>u</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=nf>Send</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s sends: %s\n&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>u</span><span class=p>.</span><span class=nx>mediator</span><span class=p>.</span><span class=nf>SendMessage</span><span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>u</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=nf>Receive</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s receives: %s\n&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºä¸­ä»‹è€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>chatRoom</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ChatRoom</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºç”¨æˆ·
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>alice</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span> <span class=nx>mediator</span><span class=p>:</span> <span class=nx>chatRoom</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>bob</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Bob&#34;</span><span class=p>,</span> <span class=nx>mediator</span><span class=p>:</span> <span class=nx>chatRoom</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>charlie</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Charlie&#34;</span><span class=p>,</span> <span class=nx>mediator</span><span class=p>:</span> <span class=nx>chatRoom</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ³¨å†Œç”¨æˆ·åˆ°èŠå¤©å®¤
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>chatRoom</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>alice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>chatRoom</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>bob</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>chatRoom</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>charlie</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ç”¨æˆ·å‘é€æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>alice</span><span class=p>.</span><span class=nf>Send</span><span class=p>(</span><span class=s>&#34;Hello, everyone!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>bob</span><span class=p>.</span><span class=nf>Send</span><span class=p>(</span><span class=s>&#34;Hi, Alice!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>charlie</span><span class=p>.</span><span class=nf>Send</span><span class=p>(</span><span class=s>&#34;Hey, Bob!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è§‚å¯Ÿè€…æ¨¡å¼observer->è§‚å¯Ÿè€…æ¨¡å¼(Observer) âœ”</h3><ul><li>å®ƒå®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»</li><li>å½“ä¸€ä¸ªå¯¹è±¡(è¢«è§‚å¯Ÿè€…)çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ æ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡(è§‚å¯Ÿè€…)éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°</li><li>è§‚å¯Ÿè€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ è§£è€¦è¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€… ä½¿å¾—å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–</li></ul><h4 id=ä¼˜ç‚¹-9>ä¼˜ç‚¹</h4><ul><li>è§£è€¦ï¼šè¢«è§‚å¯Ÿè€…å’Œè§‚å¯Ÿè€…ä¹‹é—´æ˜¯æ¾è€¦åˆçš„ å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–</li><li>æ”¯æŒåŠ¨æ€æ³¨å†Œå’Œç§»é™¤è§‚å¯Ÿè€…ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ³¨å†Œå’Œç§»é™¤è§‚å¯Ÿè€…</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ï¼šæ–°å¢è§‚å¯Ÿè€…æ—¶ ä¸éœ€è¦ä¿®æ”¹è¢«è§‚å¯Ÿè€…çš„ä»£ç </li></ul><h4 id=ç¤ºä¾‹-13>ç¤ºä¾‹</h4><ul><li>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤©æ°”ç«™(è¢«è§‚å¯Ÿè€…) å½“å¤©æ°”æ•°æ®æ›´æ–°æ—¶ é€šçŸ¥å¤šä¸ªæ˜¾ç¤ºè®¾å¤‡(è§‚å¯Ÿè€…)æ›´æ–°æ˜¾ç¤ºå†…å®¹</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰è§‚å¯Ÿè€…æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Observer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Update</span><span class=p>(</span><span class=nx>temperature</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>humidity</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>pressure</span> <span class=kt>float64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰è¢«è§‚å¯Ÿè€…æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Subject</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>RemoveObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>NotifyObservers</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“è¢«è§‚å¯Ÿè€…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WeatherData</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>observers</span>   <span class=p>[]</span><span class=nx>Observer</span>
</span></span><span class=line><span class=cl>    <span class=nx>temperature</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl>    <span class=nx>humidity</span>    <span class=kt>float64</span>
</span></span><span class=line><span class=cl>    <span class=nx>pressure</span>    <span class=kt>float64</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>w</span><span class=p>.</span><span class=nx>observers</span><span class=p>,</span> <span class=nx>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>RemoveObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>observer</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>observer</span> <span class=o>==</span> <span class=nx>o</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>w</span><span class=p>.</span><span class=nx>observers</span><span class=p>[:</span><span class=nx>i</span><span class=p>],</span> <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>NotifyObservers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>observer</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>observer</span><span class=p>.</span><span class=nf>Update</span><span class=p>(</span><span class=nx>w</span><span class=p>.</span><span class=nx>temperature</span><span class=p>,</span> <span class=nx>w</span><span class=p>.</span><span class=nx>humidity</span><span class=p>,</span> <span class=nx>w</span><span class=p>.</span><span class=nx>pressure</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>SetMeasurements</span><span class=p>(</span><span class=nx>temperature</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>humidity</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>pressure</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>temperature</span> <span class=p>=</span> <span class=nx>temperature</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>humidity</span> <span class=p>=</span> <span class=nx>humidity</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>pressure</span> <span class=p>=</span> <span class=nx>pressure</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nf>NotifyObservers</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“è§‚å¯Ÿè€…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DisplayDevice</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>DisplayDevice</span><span class=p>)</span> <span class=nf>Update</span><span class=p>(</span><span class=nx>temperature</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>humidity</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>pressure</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s: Temperature=%.2f, Humidity=%.2f, Pressure=%.2f\n&#34;</span><span class=p>,</span> <span class=nx>d</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>temperature</span><span class=p>,</span> <span class=nx>humidity</span><span class=p>,</span> <span class=nx>pressure</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºè¢«è§‚å¯Ÿè€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>WeatherData</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºè§‚å¯Ÿè€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>display1</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>DisplayDevice</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Display 1&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>display2</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>DisplayDevice</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Display 2&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ³¨å†Œè§‚å¯Ÿè€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>display1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>display2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ›´æ–°å¤©æ°”æ•°æ®å¹¶é€šçŸ¥è§‚å¯Ÿè€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>SetMeasurements</span><span class=p>(</span><span class=mf>25.0</span><span class=p>,</span> <span class=mf>65.0</span><span class=p>,</span> <span class=mf>1013.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>SetMeasurements</span><span class=p>(</span><span class=mf>26.5</span><span class=p>,</span> <span class=mf>70.0</span><span class=p>,</span> <span class=mf>1012.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>RemoveObserver</span><span class=p>(</span><span class=nx>display1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å†æ¬¡æ›´æ–°å¤©æ°”æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>SetMeasurements</span><span class=p>(</span><span class=mf>27.0</span><span class=p>,</span> <span class=mf>68.0</span><span class=p>,</span> <span class=mf>1011.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å‘½ä»¤æ¨¡å¼command->å‘½ä»¤æ¨¡å¼(Command) âœ”</h3><ul><li>å®ƒå°†è¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ ä»è€Œä½¿ä½ å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ– å¹¶ä¸”æ”¯æŒè¯·æ±‚çš„æ’é˜Ÿã€è®°å½•æ—¥å¿—ã€æ’¤é”€æ“ä½œç­‰åŠŸèƒ½</li></ul><h4 id=æ ¸å¿ƒæ€æƒ³>æ ¸å¿ƒæ€æƒ³</h4><ul><li>å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ï¼šå°†æ¯ä¸ªè¯·æ±‚(å¦‚æ–¹æ³•è°ƒç”¨)å°è£…ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡</li><li>è§£è€¦è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ï¼šå‘é€è€…ä¸éœ€è¦çŸ¥é“æ¥æ”¶è€…çš„å…·ä½“å®ç° åªéœ€è¦é€šè¿‡å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œè¯·æ±‚</li><li>æ”¯æŒæ‰©å±•ï¼šå¯ä»¥è½»æ¾åœ°æ·»åŠ æ–°çš„å‘½ä»¤ è€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç </li></ul><h4 id=ç¤ºä¾‹-14>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰å‘½ä»¤æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Command</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“å‘½ä»¤ è¡¨ç¤ºæ‰“å°æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PrintCommand</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>PrintCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Executing PrintCommand:&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“å‘½ä»¤ è¡¨ç¤ºå‘é€é‚®ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>EmailCommand</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>to</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>EmailCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Executing EmailCommand: Sending email to %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>to</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Subject: %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>subject</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Body: %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä»»åŠ¡é˜Ÿåˆ— ç”¨äºå­˜å‚¨å’Œæ‰§è¡Œå‘½ä»¤
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TaskQueue</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>commands</span> <span class=p>[]</span><span class=nx>Command</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>tq</span> <span class=o>*</span><span class=nx>TaskQueue</span><span class=p>)</span> <span class=nf>AddCommand</span><span class=p>(</span><span class=nx>cmd</span> <span class=nx>Command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span><span class=p>,</span> <span class=nx>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>tq</span> <span class=o>*</span><span class=nx>TaskQueue</span><span class=p>)</span> <span class=nf>ProcessCommands</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>cmd</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>cmd</span><span class=p>.</span><span class=nf>Execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span> <span class=c1>// æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span> <span class=p>=</span> <span class=kc>nil</span> <span class=c1>// æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºä»»åŠ¡é˜Ÿåˆ—
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>taskQueue</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>TaskQueue</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ·»åŠ ä»»åŠ¡åˆ°é˜Ÿåˆ—
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PrintCommand</span><span class=p>{</span><span class=nx>message</span><span class=p>:</span> <span class=s>&#34;Hello, World!&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>EmailCommand</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>to</span><span class=p>:</span>      <span class=s>&#34;user@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>subject</span><span class=p>:</span> <span class=s>&#34;Welcome&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=p>:</span>    <span class=s>&#34;Thank you for signing up!&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PrintCommand</span><span class=p>{</span><span class=nx>message</span><span class=p>:</span> <span class=s>&#34;Task queue is running...&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å¤„ç†ä»»åŠ¡é˜Ÿåˆ—
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Processing task queue:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>ProcessCommands</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ·»åŠ æ›´å¤šä»»åŠ¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PrintCommand</span><span class=p>{</span><span class=nx>message</span><span class=p>:</span> <span class=s>&#34;Another task&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>EmailCommand</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>to</span><span class=p>:</span>      <span class=s>&#34;admin@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>subject</span><span class=p>:</span> <span class=s>&#34;Report&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=p>:</span>    <span class=s>&#34;Here is the daily report.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å†æ¬¡å¤„ç†ä»»åŠ¡é˜Ÿåˆ—
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;\nProcessing task queue again:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>ProcessCommands</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è¿­ä»£å™¨æ¨¡å¼iterator>è¿­ä»£å™¨æ¨¡å¼(Iterator)</h3><ul><li>å®ƒæä¾›äº†ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´  è€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤º</li><li>è¿­ä»£å™¨æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†éå†é€»è¾‘ä»èšåˆå¯¹è±¡ä¸­åˆ†ç¦»å‡ºæ¥ ä½¿å¾—èšåˆå¯¹è±¡å’Œéå†é€»è¾‘å¯ä»¥ç‹¬ç«‹å˜åŒ–</li></ul><h4 id=é€‚ç”¨åœºæ™¯-7>é€‚ç”¨åœºæ™¯</h4><ul><li>é›†åˆç±»åº“ï¼šå¦‚Goçš„ sliceã€map ç­‰é›†åˆç±»å‹ å¯ä»¥é€šè¿‡è¿­ä»£å™¨æ¨¡å¼æä¾›ç»Ÿä¸€çš„éå†æ¥å£</li><li>æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼šæ•°æ®åº“æŸ¥è¯¢ç»“æœå¯ä»¥å°è£…ä¸ºä¸€ä¸ªèšåˆå¯¹è±¡ å¹¶æä¾›è¿­ä»£å™¨éå†æŸ¥è¯¢ç»“æœ</li><li>æ–‡ä»¶ç³»ç»Ÿéå†ï¼šæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶å¯ä»¥å°è£…ä¸ºä¸€ä¸ªèšåˆå¯¹è±¡ å¹¶æä¾›è¿­ä»£å™¨éå†æ–‡ä»¶ç³»ç»Ÿ</li><li>æ ‘å½¢ç»“æ„éå†ï¼šæ ‘å½¢ç»“æ„(å¦‚äºŒå‰æ ‘ã€å¤šå‰æ ‘)å¯ä»¥æä¾›å¤šç§éå†æ–¹å¼(å¦‚æ·±åº¦ä¼˜å…ˆã€å¹¿åº¦ä¼˜å…ˆ)</li></ul><h4 id=ç¤ºä¾‹-15>ç¤ºä¾‹</h4><ul><li>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé›†åˆç±»BookCollection å®ƒåŒ…å«å¤šæœ¬ä¹¦</li><li>æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè¿­ä»£å™¨ ç”¨äºéå†è¿™ä¸ªé›†åˆ</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰ä¹¦ç±ç»“æ„ä½“
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Book</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Title</span>  <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Author</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰è¿­ä»£å™¨æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Iterator</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>HasNext</span><span class=p>()</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>    <span class=nf>Next</span><span class=p>()</span> <span class=o>*</span><span class=nx>Book</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“è¿­ä»£å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>BookIterator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>books</span>    <span class=p>[]</span><span class=o>*</span><span class=nx>Book</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>BookIterator</span><span class=p>)</span> <span class=nf>HasNext</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>b</span><span class=p>.</span><span class=nx>position</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>books</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>BookIterator</span><span class=p>)</span> <span class=nf>Next</span><span class=p>()</span> <span class=o>*</span><span class=nx>Book</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nf>HasNext</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>book</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>books</span><span class=p>[</span><span class=nx>b</span><span class=p>.</span><span class=nx>position</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nx>position</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>book</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰èšåˆæ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Aggregate</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateIterator</span><span class=p>()</span> <span class=nx>Iterator</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“èšåˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>BookCollection</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>books</span> <span class=p>[]</span><span class=o>*</span><span class=nx>Book</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>BookCollection</span><span class=p>)</span> <span class=nf>CreateIterator</span><span class=p>()</span> <span class=nx>Iterator</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>BookIterator</span><span class=p>{</span><span class=nx>books</span><span class=p>:</span> <span class=nx>b</span><span class=p>.</span><span class=nx>books</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºä¹¦ç±é›†åˆ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>collection</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>BookCollection</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>books</span><span class=p>:</span> <span class=p>[]</span><span class=o>*</span><span class=nx>Book</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>Title</span><span class=p>:</span> <span class=s>&#34;The Go Programming Language&#34;</span><span class=p>,</span> <span class=nx>Author</span><span class=p>:</span> <span class=s>&#34;Alan A. A. Donovan&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>Title</span><span class=p>:</span> <span class=s>&#34;Design Patterns&#34;</span><span class=p>,</span> <span class=nx>Author</span><span class=p>:</span> <span class=s>&#34;Erich Gamma&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>Title</span><span class=p>:</span> <span class=s>&#34;Clean Code&#34;</span><span class=p>,</span> <span class=nx>Author</span><span class=p>:</span> <span class=s>&#34;Robert C. Martin&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºè¿­ä»£å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>iterator</span> <span class=o>:=</span> <span class=nx>collection</span><span class=p>.</span><span class=nf>CreateIterator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// éå†é›†åˆ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=nx>iterator</span><span class=p>.</span><span class=nf>HasNext</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>book</span> <span class=o>:=</span> <span class=nx>iterator</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Title: %s, Author: %s\n&#34;</span><span class=p>,</span> <span class=nx>book</span><span class=p>.</span><span class=nx>Title</span><span class=p>,</span> <span class=nx>book</span><span class=p>.</span><span class=nx>Author</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ¨¡æ¿æ–¹æ³•æ¨¡å¼template-method->æ¨¡æ¿æ–¹æ³•æ¨¡å¼(Template Method) âœ”</h3><ul><li>å®ƒå®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ å¹¶å°†æŸäº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­å®ç°</li><li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ å°†ç®—æ³•çš„é€šç”¨éƒ¨åˆ†æ”¾åœ¨çˆ¶ç±»ä¸­ è€Œå°†å¯å˜éƒ¨åˆ†äº¤ç»™å­ç±»å®ç°</li><li>é€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼ å¯ä»¥é¿å…ä»£ç é‡å¤ å¹¶ç¡®ä¿ç®—æ³•çš„ç»“æ„ä¸å˜</li></ul><h4 id=é€‚ç”¨åœºæ™¯-8>é€‚ç”¨åœºæ™¯</h4><ul><li><code>æ¡†æ¶è®¾è®¡</code> å¦‚Webæ¡†æ¶ä¸­çš„è¯·æ±‚å¤„ç†æµç¨‹(åˆå§‹åŒ–ã€å¤„ç†è¯·æ±‚ã€è¿”å›å“åº”ç­‰)</li><li><code>å·¥ä½œæµå¼•æ“</code> å¦‚è®¢å•å¤„ç†æµç¨‹(åˆ›å»ºè®¢å•ã€æ”¯ä»˜è®¢å•ã€å‘è´§è®¢å•ç­‰)</li><li><code>æµ‹è¯•æ¡†æ¶</code> å¦‚æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œæµç¨‹(åˆå§‹åŒ–ã€æ‰§è¡Œæµ‹è¯•ã€æ¸…ç†èµ„æºç­‰)</li><li><code>æ¸¸æˆå¼€å‘</code> å¦‚æ¸¸æˆè§’è‰²çš„è¡Œä¸ºæµç¨‹(ç§»åŠ¨ã€æ”»å‡»ã€é˜²å¾¡ç­‰)</li></ul><h4 id=ä¼˜ç‚¹-10>ä¼˜ç‚¹</h4><ul><li><code>ä»£ç å¤ç”¨</code> å°†ç®—æ³•çš„é€šç”¨éƒ¨åˆ†æ”¾åœ¨çˆ¶ç±»ä¸­ é¿å…äº†ä»£ç é‡å¤</li><li><code>æ‰©å±•æ€§</code> æ–°å¢å­ç±»æ—¶ åªéœ€è¦å®ç°æŠ½è±¡æ–¹æ³• è€Œä¸éœ€è¦ä¿®æ”¹çˆ¶ç±»çš„ä»£ç </li><li><code>æ§åˆ¶ç®—æ³•ç»“æ„</code> çˆ¶ç±»æ§åˆ¶ç®—æ³•çš„ç»“æ„ ç¡®ä¿ç®—æ³•çš„æ­¥éª¤ä¸ä¼šè¢«å­ç±»æ”¹å˜</li></ul><h4 id=ç¤ºä¾‹-16>ç¤ºä¾‹</h4><ul><li>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé¥®æ–™åˆ¶ä½œç³»ç»Ÿ æ”¯æŒåˆ¶ä½œå’–å•¡å’ŒèŒ¶</li><li>å’–å•¡å’ŒèŒ¶çš„åˆ¶ä½œè¿‡ç¨‹æœ‰ä¸€äº›å…±åŒçš„æ­¥éª¤(å¦‚çƒ§æ°´ã€å€’å…¥æ¯å­) ä¹Ÿæœ‰ä¸€äº›ä¸åŒçš„æ­¥éª¤(å¦‚å†²æ³¡å’–å•¡ã€æ³¡èŒ¶)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æŠ½è±¡ç±»ï¼Œå®šä¹‰é¥®æ–™åˆ¶ä½œçš„æ¨¡æ¿æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Beverage</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>BoilWater</span><span class=p>()</span>           <span class=c1>// çƒ§æ°´
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Brew</span><span class=p>()</span>                <span class=c1>// å†²æ³¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>PourInCup</span><span class=p>()</span>           <span class=c1>// å€’å…¥æ¯å­
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>AddCondiments</span><span class=p>()</span>       <span class=c1>// æ·»åŠ è°ƒæ–™
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>WantCondiments</span><span class=p>()</span> <span class=kt>bool</span> <span class=c1>// æ˜¯å¦æ·»åŠ è°ƒæ–™ï¼ˆé’©å­æ–¹æ³•ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ¨¡æ¿æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>MakeBeverage</span><span class=p>(</span><span class=nx>b</span> <span class=nx>Beverage</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>BoilWater</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>Brew</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>PourInCup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nf>WantCondiments</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>AddCondiments</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“ç±»ï¼šå’–å•¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Coffee</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>BoilWater</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Boiling water&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>Brew</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Brewing coffee&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>PourInCup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Pouring coffee into cup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>AddCondiments</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Adding sugar and milk&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>WantCondiments</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“ç±»ï¼šèŒ¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Tea</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>BoilWater</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Boiling water&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>Brew</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Steeping tea&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>PourInCup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Pouring tea into cup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>AddCondiments</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Adding lemon&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>WantCondiments</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ¶ä½œå’–å•¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Making coffee:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>coffee</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Coffee</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nf>MakeBeverage</span><span class=p>(</span><span class=nx>coffee</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ¶ä½œèŒ¶
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;\nMaking tea:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>tea</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Tea</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nf>MakeBeverage</span><span class=p>(</span><span class=nx>tea</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç­–ç•¥æ¨¡å¼strategy->ç­–ç•¥æ¨¡å¼(Strategy) âœ”</h3><ul><li>å®ƒå®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³• å¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ ä½¿å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢</li><li>ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ç®—æ³•çš„ä½¿ç”¨ä¸ç®—æ³•çš„å®ç°åˆ†ç¦» ä»è€Œä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºå®¢æˆ·ç«¯è€Œå˜åŒ–</li><li>é€šè¿‡ç­–ç•¥æ¨¡å¼ å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°é€‰æ‹©ç®—æ³• è€Œä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç </li></ul><h4 id=é€‚ç”¨åœºæ™¯-9>é€‚ç”¨åœºæ™¯</h4><ul><li>æ”¯ä»˜ç³»ç»Ÿï¼šå¦‚ç¤ºä¾‹æ‰€ç¤º æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼</li><li>æ’åºç®—æ³•ï¼šæ”¯æŒå¤šç§æ’åºç®—æ³•(å¦‚å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºã€å†’æ³¡æ’åºç­‰)</li><li>å‹ç¼©ç®—æ³•ï¼šæ”¯æŒå¤šç§å‹ç¼©ç®—æ³•(å¦‚ZIPã€RARã€7zç­‰)</li><li>è·¯ç”±ç®—æ³•ï¼šæ”¯æŒå¤šç§è·¯ç”±ç®—æ³•(å¦‚æœ€çŸ­è·¯å¾„ã€æœ€å¿«è·¯å¾„ã€æœ€å°‘æ”¶è´¹è·¯å¾„ç­‰)</li></ul><h4 id=ä¼˜ç‚¹-11>ä¼˜ç‚¹</h4><ul><li>è§£è€¦ï¼šå°†ç®—æ³•çš„ä½¿ç”¨ä¸ç®—æ³•çš„å®ç°åˆ†ç¦» ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºå®¢æˆ·ç«¯è€Œå˜åŒ–</li><li>æ˜“äºæ‰©å±•ï¼šæ–°å¢ç®—æ³•æ—¶ åªéœ€è¦æ·»åŠ æ–°çš„ç­–ç•¥ç±» è€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç </li><li>åŠ¨æ€é€‰æ‹©ç®—æ³•ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°é€‰æ‹©ç®—æ³• è€Œä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç </li></ul><h4 id=ç¤ºä¾‹-17>ç¤ºä¾‹</h4><ul><li>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ”¯ä»˜ç³»ç»Ÿ æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼(å¦‚ä¿¡ç”¨å¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€å¾®ä¿¡æ”¯ä»˜ç­‰) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å®ç°æ”¯ä»˜æ–¹å¼çš„é€‰æ‹©</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰ç­–ç•¥æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PaymentStrategy</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“ç­–ç•¥ï¼šä¿¡ç”¨å¡æ”¯ä»˜
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>CreditCardPayment</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CreditCardPayment</span><span class=p>)</span> <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Paying %.2f using Credit Card\n&#34;</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“ç­–ç•¥ï¼šæ”¯ä»˜å®æ”¯ä»˜
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>AlipayPayment</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>AlipayPayment</span><span class=p>)</span> <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Paying %.2f using Alipay\n&#34;</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“ç­–ç•¥ï¼šå¾®ä¿¡æ”¯ä»˜
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WechatPayment</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WechatPayment</span><span class=p>)</span> <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Paying %.2f using Wechat Pay\n&#34;</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¸Šä¸‹æ–‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PaymentContext</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>strategy</span> <span class=nx>PaymentStrategy</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PaymentContext</span><span class=p>)</span> <span class=nf>SetStrategy</span><span class=p>(</span><span class=nx>strategy</span> <span class=nx>PaymentStrategy</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>strategy</span> <span class=p>=</span> <span class=nx>strategy</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PaymentContext</span><span class=p>)</span> <span class=nf>ExecutePayment</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>strategy</span><span class=p>.</span><span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºä¸Šä¸‹æ–‡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>PaymentContext</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetStrategy</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>CreditCardPayment</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>ExecutePayment</span><span class=p>(</span><span class=mf>100.0</span><span class=p>)</span> <span class=c1>// è¾“å‡º: Paying 100.00 using Credit Card
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetStrategy</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>AlipayPayment</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>ExecutePayment</span><span class=p>(</span><span class=mf>200.0</span><span class=p>)</span> <span class=c1>// è¾“å‡º: Paying 200.00 using Alipay
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetStrategy</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>WechatPayment</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>ExecutePayment</span><span class=p>(</span><span class=mf>300.0</span><span class=p>)</span> <span class=c1>// è¾“å‡º: Paying 300.00 using Wechat Pay
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=çŠ¶æ€æ¨¡å¼state>çŠ¶æ€æ¨¡å¼(State)</h3><ul><li>å®ƒå…è®¸å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸º</li><li>çŠ¶æ€æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€å°è£…æˆç‹¬ç«‹çš„ç±» å¹¶å°†å¯¹è±¡çš„è¡Œä¸ºå§”æ‰˜ç»™å½“å‰çŠ¶æ€å¯¹è±¡</li><li>é€šè¿‡çŠ¶æ€æ¨¡å¼ å¯ä»¥å°†å¤æ‚çš„æ¡ä»¶é€»è¾‘åˆ†æ•£åˆ°å¤šä¸ªçŠ¶æ€ç±»ä¸­ ä»è€Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤</li></ul><h4 id=ä¼˜ç‚¹-12>ä¼˜ç‚¹</h4><ul><li>æ¸…æ™°çš„çŠ¶æ€è½¬æ¢é€»è¾‘ï¼šå°†çŠ¶æ€è½¬æ¢é€»è¾‘åˆ†æ•£åˆ°å„ä¸ªçŠ¶æ€ç±»ä¸­ é¿å…äº†å¤æ‚çš„æ¡ä»¶è¯­å¥</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ï¼šæ–°å¢çŠ¶æ€æ—¶ åªéœ€è¦æ·»åŠ æ–°çš„çŠ¶æ€ç±» è€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç </li><li>æ˜“äºæ‰©å±•ï¼šå¯ä»¥è½»æ¾åœ°æ·»åŠ æ–°çš„çŠ¶æ€å’Œè¡Œä¸º</li></ul><h4 id=ç¤ºä¾‹-18>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰çŠ¶æ€æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>State</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>context</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä¸Šä¸‹æ–‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Context</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span> <span class=nx>State</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>SetState</span><span class=p>(</span><span class=nx>state</span> <span class=nx>State</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>state</span> <span class=p>=</span> <span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>PressSwitch</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“çŠ¶æ€ï¼šå¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>OnState</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>OnState</span><span class=p>)</span> <span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>context</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Turning the light off...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>OffState</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“çŠ¶æ€ï¼šå…³
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>OffState</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>OffState</span><span class=p>)</span> <span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>context</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Turning the light on...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>OnState</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºä¸Šä¸‹æ–‡å¹¶è®¾ç½®åˆå§‹çŠ¶æ€
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Context</span><span class=p>{</span><span class=nx>state</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>OffState</span><span class=p>{}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æŒ‰ä¸‹å¼€å…³
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>()</span> <span class=c1>// è¾“å‡º: Turning the light on...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>()</span> <span class=c1>// è¾“å‡º: Turning the light off...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>()</span> <span class=c1>// è¾“å‡º: Turning the light on...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å¤‡å¿˜å½•æ¨¡å¼memento>å¤‡å¿˜å½•æ¨¡å¼(Memento)</h3><ul><li>å®ƒå…è®¸åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ æ•è·å¹¶å¤–éƒ¨åŒ–ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ ä»¥ä¾¿ç¨åå¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€</li><li>å¤‡å¿˜å½•æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ å°†å¯¹è±¡çš„çŠ¶æ€ä¿å­˜åˆ°ä¸€ä¸ªå¤‡å¿˜å½•å¯¹è±¡ä¸­ å¹¶åœ¨éœ€è¦æ—¶ä»å¤‡å¿˜å½•ä¸­æ¢å¤çŠ¶æ€</li></ul><h4 id=ä¼˜ç‚¹-13>ä¼˜ç‚¹</h4><ul><li>è¿™ç§æ–¹å¼éå¸¸é€‚åˆéœ€è¦æ”¯æŒæ’¤é”€æ“ä½œæˆ–çŠ¶æ€ç®¡ç†çš„åœºæ™¯</li><li>æ¯”å¦‚æ–‡æœ¬ç¼–è¾‘å™¨ã€æ¸¸æˆå­˜æ¡£ã€äº‹åŠ¡å›æ»šç­‰</li><li>åœ¨Goè¯­è¨€ä¸­ å¤‡å¿˜å½•æ¨¡å¼å¯ä»¥é€šè¿‡æ¥å£å’Œç»“æ„ä½“çš„ç»„åˆæ¥å®ç° ä»£ç ç®€æ´ä¸”æ˜“äºæ‰©å±•</li></ul><h4 id=ç¤ºä¾‹-19>ç¤ºä¾‹</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰å¤‡å¿˜å½•æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Memento</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>GetState</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“å¤‡å¿˜å½•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TextMemento</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TextMemento</span><span class=p>)</span> <span class=nf>GetState</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>t</span><span class=p>.</span><span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// åŸå‘å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Originator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>SetState</span><span class=p>(</span><span class=nx>state</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>o</span><span class=p>.</span><span class=nx>state</span> <span class=p>=</span> <span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>GetState</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>o</span><span class=p>.</span><span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>CreateMemento</span><span class=p>()</span> <span class=nx>Memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>TextMemento</span><span class=p>{</span><span class=nx>state</span><span class=p>:</span> <span class=nx>o</span><span class=p>.</span><span class=nx>state</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>RestoreMemento</span><span class=p>(</span><span class=nx>m</span> <span class=nx>Memento</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>o</span><span class=p>.</span><span class=nx>state</span> <span class=p>=</span> <span class=nx>m</span><span class=p>.</span><span class=nf>GetState</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç®¡ç†è€…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Caretaker</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mementos</span> <span class=p>[]</span><span class=nx>Memento</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Caretaker</span><span class=p>)</span> <span class=nf>AddMemento</span><span class=p>(</span><span class=nx>m</span> <span class=nx>Memento</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span><span class=p>,</span> <span class=nx>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Caretaker</span><span class=p>)</span> <span class=nf>GetMemento</span><span class=p>(</span><span class=nx>index</span> <span class=kt>int</span><span class=p>)</span> <span class=nx>Memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>index</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºåŸå‘å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>editor</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Originator</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºç®¡ç†è€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>caretaker</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Caretaker</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ç¼–è¾‘æ–‡æœ¬å¹¶ä¿å­˜çŠ¶æ€
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>editor</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=s>&#34;State 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>caretaker</span><span class=p>.</span><span class=nf>AddMemento</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>CreateMemento</span><span class=p>())</span> <span class=c1>// åˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•å¯¹è±¡ï¼Œä¿å­˜å½“å‰çŠ¶æ€ã€‚
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>editor</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=s>&#34;State 2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>caretaker</span><span class=p>.</span><span class=nf>AddMemento</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>CreateMemento</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>editor</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=s>&#34;State 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>caretaker</span><span class=p>.</span><span class=nf>AddMemento</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>CreateMemento</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>GetState</span><span class=p>())</span> <span class=c1>// è¿™ä¸ªæ—¶å€™çš„çŠ¶æ€å·²ç»æ˜¯  State 3
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>editor</span><span class=p>.</span><span class=nf>RestoreMemento</span><span class=p>(</span><span class=nx>caretaker</span><span class=p>.</span><span class=nf>GetMemento</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Restored State:&#34;</span><span class=p>,</span> <span class=nx>editor</span><span class=p>.</span><span class=nf>GetState</span><span class=p>())</span> <span class=c1>// è¾“å‡º: Restored State: State 2
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>editor</span><span class=p>.</span><span class=nf>RestoreMemento</span><span class=p>(</span><span class=nx>caretaker</span><span class=p>.</span><span class=nf>GetMemento</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Restored State:&#34;</span><span class=p>,</span> <span class=nx>editor</span><span class=p>.</span><span class=nf>GetState</span><span class=p>())</span> <span class=c1>// è¾“å‡º: Restored State: State 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è§£é‡Šå™¨æ¨¡å¼interpreter>è§£é‡Šå™¨æ¨¡å¼(Interpreter)</h3><ul><li>å®ƒå®šä¹‰äº†ä¸€ç§è¯­è¨€çš„è¯­æ³•è¡¨ç¤º å¹¶æä¾›äº†ä¸€ä¸ªè§£é‡Šå™¨æ¥è§£é‡Šè¿™ç§è¯­æ³•</li><li>è§£é‡Šå™¨æ¨¡å¼é€šå¸¸ç”¨äºå¤„ç†ç±»ä¼¼ç¼–ç¨‹è¯­è¨€ã€æŸ¥è¯¢è¯­è¨€ã€è§„åˆ™å¼•æ“ç­‰åœºæ™¯</li><li>æ ¸å¿ƒæ€æƒ³<ul><li>å®šä¹‰è¯­æ³•è§„åˆ™ï¼šå°†è¯­è¨€çš„è¯­æ³•è§„åˆ™è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘(AST)</li><li>è§£é‡Šæ‰§è¡Œï¼šé€šè¿‡è§£é‡Šå™¨éå†æŠ½è±¡è¯­æ³•æ ‘ æ‰§è¡Œç›¸åº”çš„æ“ä½œ</li></ul></li></ul><h4 id=æŠ½è±¡è¯­æ³•æ ‘>æŠ½è±¡è¯­æ³•æ ‘</h4><ul><li>æŠ½è±¡è¯­æ³•æ ‘(Abstract Syntax Tree-AST)æ˜¯ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µ</li><li>å®ƒæ˜¯ä¸€ç§æ ‘å½¢æ•°æ®ç»“æ„ ç”¨äºè¡¨ç¤ºæºä»£ç çš„è¯­æ³•ç»“æ„</li><li>AST ä¹‹æ‰€ä»¥è¢«ç§°ä¸º<code>æŠ½è±¡è¯­æ³•æ ‘</code> æ˜¯å› ä¸ºå®ƒæŠ½è±¡æ‰äº†æºä»£ç ä¸­çš„ä¸€äº›å…·ä½“ç»†èŠ‚ åªä¿ç•™äº†ç¨‹åºçš„é€»è¾‘ç»“æ„</li><li>ä¸ºä»€ä¹ˆå« æŠ½è±¡è¯­æ³•æ ‘<ul><li>æŠ½è±¡(Abstract)<ul><li>AST å¹¶ä¸åŒ…å«æºä»£ç ä¸­çš„æ‰€æœ‰ç»†èŠ‚ æ¯”å¦‚æ‹¬å·ã€åˆ†å·ã€ç©ºæ ¼ç­‰ å®ƒåªå…³æ³¨ç¨‹åºçš„é€»è¾‘ç»“æ„</li><li>ä¾‹å¦‚ è¡¨è¾¾å¼ 2 * (3 + 4) çš„<code>AST</code>ä¼šæŠ½è±¡æ‰æ‹¬å· åªä¿ç•™è¿ç®—ç¬¦å’Œæ“ä½œæ•°çš„å±‚æ¬¡å…³ç³»</li></ul></li><li>è¯­æ³•(Syntax)<ul><li>AST è¡¨ç¤ºçš„æ˜¯æºä»£ç çš„è¯­æ³•ç»“æ„ è€Œä¸æ˜¯è¯­ä¹‰(å³ç¨‹åºçš„å«ä¹‰)</li><li>ä¾‹å¦‚ AST å¯ä»¥è¡¨ç¤ºä¸€ä¸ª<code>if</code>è¯­å¥çš„è¯­æ³•ç»“æ„ ä½†ä¸ä¼šè§£é‡Š<code>if</code>è¯­å¥çš„å…·ä½“è¡Œä¸º</li></ul></li><li>æ ‘(Tree)<ul><li>ASTæ˜¯ä¸€ç§æ ‘å½¢æ•°æ®ç»“æ„ æ¯ä¸ªèŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªè¯­æ³•ç»“æ„(å¦‚è¡¨è¾¾å¼ã€è¯­å¥ã€å‡½æ•°ç­‰)</li><li>æ ‘çš„å±‚æ¬¡ç»“æ„åæ˜ äº†æºä»£ç çš„åµŒå¥—å…³ç³»</li></ul></li></ul></li><li>æ¯”å¦‚ï¼š</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=nx>x</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nx>Positive</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nx>Non</span><span class=o>-</span><span class=nx>positive</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>å¯¹åº”çš„ASTå¦‚ä¸‹:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IfStatement
</span></span><span class=line><span class=cl>â”œâ”€â”€ Condition: BinaryExpression
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ Left: Identifier <span class=o>(</span>x<span class=o>)</span>
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ Operator: &gt;
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ Right: Number <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>â”œâ”€â”€ ThenBlock: BlockStatement
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ Expression: CallExpression
</span></span><span class=line><span class=cl>â”‚       â”œâ”€â”€ Function: Identifier <span class=o>(</span>print<span class=o>)</span>
</span></span><span class=line><span class=cl>â”‚       â””â”€â”€ Arguments: StringLiteral <span class=o>(</span><span class=s2>&#34;Positive&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>â””â”€â”€ ElseBlock: BlockStatement
</span></span><span class=line><span class=cl>    â””â”€â”€ Expression: CallExpression
</span></span><span class=line><span class=cl>        â”œâ”€â”€ Function: Identifier <span class=o>(</span>print<span class=o>)</span>
</span></span><span class=line><span class=cl>        â””â”€â”€ Arguments: StringLiteral <span class=o>(</span><span class=s2>&#34;Non-positive&#34;</span><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=é€‚ç”¨åœºæ™¯-10>é€‚ç”¨åœºæ™¯</h4><ul><li>æ•°æ®åº“æŸ¥è¯¢å¼•æ“ï¼šå¦‚ MySQLã€PostgreSQL ç­‰æ•°æ®åº“çš„æŸ¥è¯¢è§£æå’Œæ‰§è¡Œ</li><li>è§„åˆ™å¼•æ“ï¼šå¦‚ä¸šåŠ¡è§„åˆ™å¼•æ“ ç”¨äºè§£æå’Œæ‰§è¡Œè§„åˆ™</li><li>æ¨¡æ¿å¼•æ“ï¼šå¦‚Goçš„<code>text/template</code>ç”¨äºè§£æå’Œæ‰§è¡Œæ¨¡æ¿</li><li>æ•°å­¦è¡¨è¾¾å¼è®¡ç®—ï¼šå¦‚è®¡ç®—å™¨åº”ç”¨ç¨‹åº ç”¨äºè§£æå’Œè®¡ç®—æ•°å­¦è¡¨è¾¾å¼</li></ul><h4 id=ç¤ºä¾‹-20>ç¤ºä¾‹</h4><ul><li>ä»¥Goè¯­è¨€é‡Œé¢çš„æ¨¡æ¿å­—ç¬¦ä¸²ä¸ºä¾‹</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;text/template&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å®šä¹‰æ¨¡æ¿å­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>const</span> <span class=nx>tmpl</span> <span class=p>=</span> <span class=s>`Hello, </span><span class=cp>{{</span><span class=na>.Name</span><span class=cp>}}</span><span class=s>! You are </span><span class=cp>{{</span><span class=na>.Age</span><span class=cp>}}</span><span class=s> years old.`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è§£ææ¨¡æ¿
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>t</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;example&#34;</span><span class=p>).</span><span class=nf>Parse</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å®šä¹‰æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>data</span> <span class=o>:=</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=nx>Age</span>  <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=p>}{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span> <span class=nx>Age</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ‰§è¡Œæ¨¡æ¿å¹¶è¾“å‡ºç»“æœ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>err</span> <span class=p>=</span> <span class=nx>t</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>è¿™ä¸ªæ˜¯è§£é‡Šå™¨æ¨¡å¼çš„åº”ç”¨ æˆ‘ä»¬éœ€è¦äº†è§£å†…éƒ¨çš„åŸç† ç„¶åè‡ªå·±æ‰‹æ“ä¸€ä¸ªè¿™æ ·çš„æ¨¡æ¿å­—ç¬¦ä¸²è§£æå™¨å‡ºæ¥</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰ä¸Šä¸‹æ–‡ å­˜å‚¨æ¨¡æ¿æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Context</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Data</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰æŠ½è±¡è¡¨è¾¾å¼æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Expression</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ˜¯æ–‡æœ¬è¡¨è¾¾å¼ è¡¨ç¤ºæ™®é€šæ–‡æœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TextExpression</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>text</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TextExpression</span><span class=p>)</span> <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>t</span><span class=p>.</span><span class=nx>text</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ˜¯å˜é‡è¡¨è¾¾å¼ è¡¨ç¤ºå˜é‡æ›¿æ¢
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>VariableExpression</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>key</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>VariableExpression</span><span class=p>)</span> <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>value</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>Data</span><span class=p>[</span><span class=nx>v</span><span class=p>.</span><span class=nx>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%v&#34;</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ˜¯æ¨¡æ¿ åŒ…å«å¤šä¸ªè¡¨è¾¾å¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Template</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>expressions</span> <span class=p>[]</span><span class=nx>Expression</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Template</span><span class=p>)</span> <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=nx>strings</span><span class=p>.</span><span class=nx>Builder</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>expr</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>t</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nx>expr</span><span class=p>.</span><span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>result</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è§£ææ¨¡æ¿å­—ç¬¦ä¸²å¹¶æ„å»ºæŠ½è±¡è¯­æ³•æ ‘
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseTemplate</span><span class=p>(</span><span class=nx>tmpl</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>Template</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>template</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Template</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>start</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æŸ¥æ‰¾å˜é‡è¡¨è¾¾å¼çš„èµ·å§‹ä½ç½®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>startVar</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Index</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=p>:],</span> <span class=s>&#34;{{&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>startVar</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å¦‚æœæ²¡æœ‰å˜é‡è¡¨è¾¾å¼ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯æ™®é€šæ–‡æœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>TextExpression</span><span class=p>{</span><span class=nx>text</span><span class=p>:</span> <span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=p>:]})</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ·»åŠ æ™®é€šæ–‡æœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>TextExpression</span><span class=p>{</span><span class=nx>text</span><span class=p>:</span> <span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span> <span class=p>:</span> <span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æŸ¥æ‰¾å˜é‡è¡¨è¾¾å¼çš„ç»“æŸä½ç½®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>endVar</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Index</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=p>:],</span> <span class=s>&#34;}}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>endVar</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// å¦‚æœæ²¡æœ‰ç»“æŸç¬¦ï¼Œç›´æ¥é€€å‡º
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// è§£æå˜é‡è¡¨è¾¾å¼
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>key</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>TrimSpace</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=o>+</span><span class=mi>2</span> <span class=p>:</span> <span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=o>+</span><span class=nx>endVar</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>VariableExpression</span><span class=p>{</span><span class=nx>key</span><span class=p>:</span> <span class=nx>key</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=c1>// æ›´æ–°èµ·å§‹ä½ç½®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>start</span> <span class=p>=</span> <span class=nx>start</span> <span class=o>+</span> <span class=nx>startVar</span> <span class=o>+</span> <span class=nx>endVar</span> <span class=o>+</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>template</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å®šä¹‰æ¨¡æ¿å­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>tmpl</span> <span class=o>:=</span> <span class=s>&#34;Hello, {{Name}}! You are {{Age}} years old.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è§£ææ¨¡æ¿å¹¶æ„å»ºæŠ½è±¡è¯­æ³•æ ‘
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>template</span> <span class=o>:=</span> <span class=nf>ParseTemplate</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å®šä¹‰ä¸Šä¸‹æ–‡æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ctx</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Context</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Data</span><span class=p>:</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Name&#34;</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Age&#34;</span><span class=p>:</span>  <span class=mi>25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// è§£é‡Šæ‰§è¡Œæ¨¡æ¿å¹¶è¾“å‡ºç»“æœ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>result</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>result</span><span class=p>)</span> <span class=c1>// è¾“å‡º: Hello, Alice! You are 25 years old.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=èŒè´£é“¾æ¨¡å¼chain-of-responsibility>èŒè´£é“¾æ¨¡å¼(Chain of Responsibility)</h3><ul><li>æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ å®ƒå…è®¸å¤šä¸ªå¯¹è±¡æœ‰æœºä¼šå¤„ç†è¯·æ±‚ ä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆ</li><li>è´£ä»»é“¾æ¨¡å¼å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ å¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ ç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢</li></ul><h4 id=æ ¸å¿ƒæ€æƒ³-1>æ ¸å¿ƒæ€æƒ³</h4><ul><li>è§£è€¦è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…ï¼šè¯·æ±‚çš„å‘é€è€…ä¸éœ€è¦çŸ¥é“å…·ä½“ç”±å“ªä¸ªå¯¹è±¡å¤„ç†è¯·æ±‚ åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°é“¾ä¸Šå³å¯</li><li>åŠ¨æ€ç»„åˆå¤„ç†é€»è¾‘ï¼šå¯ä»¥åŠ¨æ€åœ°ç»„åˆå¤„ç†è€… çµæ´»åœ°è°ƒæ•´å¤„ç†é¡ºåºæˆ–å¢åŠ æ–°çš„å¤„ç†è€…</li><li>æ¯ä¸ªå¤„ç†è€…åªå…³å¿ƒè‡ªå·±çš„èŒè´£ï¼šæ¯ä¸ªå¤„ç†è€…åªå¤„ç†è‡ªå·±èƒ½å¤„ç†çš„è¯·æ±‚ ä¸èƒ½å¤„ç†çš„è¯·æ±‚ä¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…</li></ul><h4 id=é€‚ç”¨åœºæ™¯-11>é€‚ç”¨åœºæ™¯</h4><ul><li>å½“ä¸€ä¸ªè¯·æ±‚éœ€è¦ç»è¿‡å¤šä¸ªå¯¹è±¡å¤„ç† ä½†å…·ä½“ç”±å“ªä¸ªå¯¹è±¡å¤„ç†ä¸ç¡®å®šæ—¶</li><li>å½“éœ€è¦åŠ¨æ€æŒ‡å®šå¤„ç†è¯·æ±‚çš„å¯¹è±¡æ—¶</li><li>å½“å¸Œæœ›é¿å…è¯·æ±‚å‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„ç´§å¯†è€¦åˆæ—¶</li><li>å®é™…åº”ç”¨åœºæ™¯<ul><li>ä¸­é—´ä»¶</li><li>å®¡æ‰¹æµç¨‹</li></ul></li></ul><h4 id=ç¤ºä¾‹-21>ç¤ºä¾‹</h4><ul><li>å®ç°ä¸€ä¸‹ginçš„ä¸­é—´ä»¶åŠŸèƒ½ ä¸­é—´ä»¶è‡ªå·±å¯ä»¥å¤„ç†è¯·æ±‚ å¯ä»¥æ‹¦æˆª å¯ä»¥æ”¾è¡Œ</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ¨¡æ‹ŸGinçš„ä¸Šä¸‹æ–‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Context</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Request</span>  <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span>
</span></span><span class=line><span class=cl>    <span class=nx>Writer</span>   <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span>
</span></span><span class=line><span class=cl>    <span class=nx>handlers</span> <span class=p>[]</span><span class=nx>HandlerFunc</span> <span class=c1>// è´£ä»»é“¾ä¸­çš„å¤„ç†å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>index</span>    <span class=kt>int</span>           <span class=c1>// å½“å‰æ‰§è¡Œçš„å¤„ç†å‡½æ•°ç´¢å¼•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰å¤„ç†å‡½æ•°ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HandlerFunc</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è°ƒç”¨è´£ä»»é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>Next</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>index</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>c</span><span class=p>.</span><span class=nx>index</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>handlers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>handlers</span><span class=p>[</span><span class=nx>c</span><span class=p>.</span><span class=nx>index</span><span class=p>](</span><span class=nx>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç»ˆæ­¢è´£ä»»é“¾çš„æ‰§è¡Œ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>Abort</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>index</span> <span class=p>=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>handlers</span><span class=p>)</span> <span class=c1>// ç›´æ¥è·³åˆ°æœ«å°¾ ä¸å†æ‰§è¡Œåç»­å¤„ç†å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ¨¡æ‹ŸGinçš„å¼•æ“
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Engine</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>handlers</span> <span class=p>[]</span><span class=nx>HandlerFunc</span> <span class=c1>// å…¨å±€ä¸­é—´ä»¶å’Œè´£ä»»é“¾
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ·»åŠ ä¸­é—´ä»¶åˆ°è´£ä»»é“¾
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>Use</span><span class=p>(</span><span class=nx>middleware</span> <span class=nx>HandlerFunc</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>e</span><span class=p>.</span><span class=nx>handlers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>handlers</span><span class=p>,</span> <span class=nx>middleware</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®ç°http.Handleræ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>ServeHTTP</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Context</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Request</span><span class=p>:</span>  <span class=nx>r</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Writer</span><span class=p>:</span>   <span class=nx>w</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>handlers</span><span class=p>:</span> <span class=nx>e</span><span class=p>.</span><span class=nx>handlers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>index</span><span class=p>:</span>    <span class=o>-</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// å¼€å§‹æ‰§è¡Œè´£ä»»é“¾
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç¤ºä¾‹ä¸­é—´ä»¶ 1ï¼šæ—¥å¿—è®°å½•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>LoggingMiddleware</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Request: %s %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Method</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç¤ºä¾‹ä¸­é—´ä»¶ 2ï¼šè®¤è¯æ£€æŸ¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>AuthMiddleware</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>token</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>token</span> <span class=o>!=</span> <span class=s>&#34;valid-token&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusUnauthorized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Unauthorized&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span> <span class=c1>// ç»ˆæ­¢è´£ä»»é“¾
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç¤ºä¾‹ä¸­é—´ä»¶ 3ï¼šè¯·æ±‚å¤„ç†
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>HelloHandler</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Hello, World!&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºå¼•æ“
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>engine</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Engine</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ·»åŠ ä¸­é—´ä»¶åˆ°è´£ä»»é“¾
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>engine</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>LoggingMiddleware</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>engine</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>AuthMiddleware</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>engine</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>HelloHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å¯åŠ¨ HTTP æœåŠ¡å™¨
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Server is running on :9090&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:9090&#34;</span><span class=p>,</span> <span class=nx>engine</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=è®¿é—®è€…æ¨¡å¼visitor>è®¿é—®è€…æ¨¡å¼(Visitor)</h3><ul><li>å®ƒå…è®¸ä½ å°†ç®—æ³•ä¸å¯¹è±¡ç»“æ„åˆ†ç¦»</li><li>è®¿é—®è€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ å°†æ“ä½œ(ç®—æ³•)ä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ ä½¿å¾—å¯ä»¥åœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹å®šä¹‰æ–°çš„æ“ä½œ</li><li>é€šè¿‡è®¿é—®è€…æ¨¡å¼ å¯ä»¥å°†å¯¹è±¡ç»“æ„çš„å…ƒç´ ä¸ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ“ä½œè§£è€¦ ä»è€Œä½¿å¾—æ“ä½œå¯ä»¥ç‹¬ç«‹å˜åŒ–</li></ul><h4 id=ä¼˜ç‚¹-14>ä¼˜ç‚¹</h4><ul><li>è§£è€¦ï¼šå°†æ“ä½œä¸å¯¹è±¡ç»“æ„åˆ†ç¦» ä½¿å¾—æ“ä½œå¯ä»¥ç‹¬ç«‹å˜åŒ–</li><li>æ‰©å±•æ€§ï¼šæ–°å¢æ“ä½œæ—¶ åªéœ€è¦æ·»åŠ æ–°çš„è®¿é—®è€… è€Œä¸éœ€è¦ä¿®æ”¹å¯¹è±¡ç»“æ„ã€‚</li><li>ç¬¦åˆå¼€é—­åŸåˆ™ï¼šå¯¹è±¡ç»“æ„å¯¹æ‰©å±•å¼€æ”¾ å¯¹ä¿®æ”¹å…³é—­</li></ul><h4 id=ç¤ºä¾‹-22>ç¤ºä¾‹</h4><ul><li>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOM) åŒ…å«å¤šç§å…ƒç´ (å¦‚æ–‡æœ¬ã€å›¾ç‰‡ã€è¡¨æ ¼ç­‰) æˆ‘ä»¬éœ€è¦å¯¹è¿™äº›å…ƒç´ è¿›è¡Œä¸åŒçš„æ“ä½œ(å¦‚å¯¼å‡ºä¸ºPDFã€å¯¼å‡ºä¸ºHTMLç­‰)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰è®¿é—®è€…æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Visitor</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>VisitText</span><span class=p>(</span><span class=nx>text</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>VisitImage</span><span class=p>(</span><span class=nx>image</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>VisitTable</span><span class=p>(</span><span class=nx>table</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰å…ƒç´ æ¥å£
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Element</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“å…ƒç´ ï¼šæ–‡æœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Text</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>visitor</span><span class=p>.</span><span class=nf>VisitText</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“å…ƒç´ ï¼šå›¾ç‰‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Image</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>src</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>i</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>visitor</span><span class=p>.</span><span class=nf>VisitImage</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“å…ƒç´ ï¼šè¡¨æ ¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Table</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>rows</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>cols</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>visitor</span><span class=p>.</span><span class=nf>VisitTable</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“è®¿é—®è€…ï¼šå¯¼å‡ºä¸º PDF
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PDFExportVisitor</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PDFExportVisitor</span><span class=p>)</span> <span class=nf>VisitText</span><span class=p>(</span><span class=nx>text</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting text to PDF: %s\n&#34;</span><span class=p>,</span> <span class=nx>text</span><span class=p>.</span><span class=nx>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PDFExportVisitor</span><span class=p>)</span> <span class=nf>VisitImage</span><span class=p>(</span><span class=nx>image</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting image to PDF: %s\n&#34;</span><span class=p>,</span> <span class=nx>image</span><span class=p>.</span><span class=nx>src</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PDFExportVisitor</span><span class=p>)</span> <span class=nf>VisitTable</span><span class=p>(</span><span class=nx>table</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting table to PDF: %d rows, %d cols\n&#34;</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>rows</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>cols</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å…·ä½“è®¿é—®è€…ï¼šå¯¼å‡ºä¸º HTML
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HTMLExportVisitor</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HTMLExportVisitor</span><span class=p>)</span> <span class=nf>VisitText</span><span class=p>(</span><span class=nx>text</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting text to HTML: %s\n&#34;</span><span class=p>,</span> <span class=nx>text</span><span class=p>.</span><span class=nx>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HTMLExportVisitor</span><span class=p>)</span> <span class=nf>VisitImage</span><span class=p>(</span><span class=nx>image</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting image to HTML: %s\n&#34;</span><span class=p>,</span> <span class=nx>image</span><span class=p>.</span><span class=nx>src</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HTMLExportVisitor</span><span class=p>)</span> <span class=nf>VisitTable</span><span class=p>(</span><span class=nx>table</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting table to HTML: %d rows, %d cols\n&#34;</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>rows</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>cols</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ˜¯å¯¹è±¡ç»“æ„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Document</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>elements</span> <span class=p>[]</span><span class=nx>Element</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>Document</span><span class=p>)</span> <span class=nf>AddElement</span><span class=p>(</span><span class=nx>element</span> <span class=nx>Element</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>elements</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>elements</span><span class=p>,</span> <span class=nx>element</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>Document</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>element</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>d</span><span class=p>.</span><span class=nx>elements</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>element</span><span class=p>.</span><span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºæ–‡æ¡£å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>document</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Document</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ·»åŠ å…ƒç´ 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>document</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>Text</span><span class=p>{</span><span class=nx>content</span><span class=p>:</span> <span class=s>&#34;Hello, World!&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>Image</span><span class=p>{</span><span class=nx>src</span><span class=p>:</span> <span class=s>&#34;image.png&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>Table</span><span class=p>{</span><span class=nx>rows</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>cols</span><span class=p>:</span> <span class=mi>2</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// åˆ›å»ºè®¿é—®è€…
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>pdfVisitor</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>PDFExportVisitor</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>htmlVisitor</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>HTMLExportVisitor</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å¯¼å‡ºä¸º PDF
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Exporting to PDF:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>Accept</span><span class=p>(</span><span class=nx>pdfVisitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// å¯¼å‡ºä¸º HTML
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;\nExporting to HTML:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>Accept</span><span class=p>(</span><span class=nx>htmlVisitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=å…¶ä½™å¸¸ç”¨æ¨¡å¼>å…¶ä½™å¸¸ç”¨æ¨¡å¼</h2><ul><li>é™¤å¼€23ç§æ ‡å‡†æ¨¡å¼åŠç®€å•å·¥å‚æ¨¡å¼ä¹‹å¤–çš„å¸¸ç”¨è®¾è®¡æ¨¡å¼</li></ul><h3 id=å¯¹è±¡æ± æ¨¡å¼object-pool-pattern->å¯¹è±¡æ± æ¨¡å¼(Object Pool Pattern) âœ”</h3><ul><li>åˆ›å»ºå‹æ¨¡å¼</li><li>å¯¹è±¡æ± åˆ›å»ºè®¾è®¡æ¨¡å¼ç”¨äºæ ¹æ®éœ€æ±‚é¢„æœŸå‡†å¤‡å’Œä¿ç•™å¤šä¸ªå®ä¾‹</li></ul><h4 id=å®ç°>å®ç°</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>pool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Pool</span> <span class=kd>chan</span> <span class=o>*</span><span class=nx>Object</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>total</span> <span class=kt>int</span><span class=p>)</span> <span class=o>*</span><span class=nx>Pool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=nx>Pool</span><span class=p>,</span> <span class=nx>total</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>total</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>p</span> <span class=o>&lt;-</span> <span class=nb>new</span><span class=p>(</span><span class=nx>Object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>p</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ç”¨æ³•>ç”¨æ³•</h4><ul><li>ä¸‹é¢ç»™å‡ºäº†ä¸€ä¸ªå…³äºå¯¹è±¡æ± çš„ç®€å•ç”Ÿå‘½å‘¨æœŸç¤ºä¾‹</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>p</span> <span class=o>:=</span> <span class=nx>pool</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nx>obj</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>p</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>obj</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span> <span class=cm>/*...*/</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>p</span> <span class=o>&lt;-</span> <span class=nx>obj</span>
</span></span><span class=line><span class=cl><span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// No more objects left â€” retry later or fail
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ç»éªŒæ³•åˆ™>ç»éªŒæ³•åˆ™</h4><ul><li>å¯¹è±¡æ± æ¨¡å¼åœ¨å¯¹è±¡åˆå§‹åŒ–æ¯”å¯¹è±¡ç»´æŠ¤æˆæœ¬æ›´é«˜çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨</li><li>å¦‚æœéœ€æ±‚å‡ºç°å³°å€¼ è€Œä¸æ˜¯ç¨³å®šéœ€æ±‚ åˆ™ç»´æŠ¤å¼€é”€å¯èƒ½ä¼šè¶…è¿‡å¯¹è±¡æ± çš„ä¼˜åŠ¿</li><li>ç”±äºå¯¹è±¡æ˜¯é¢„å…ˆåˆå§‹åŒ–çš„ å› æ­¤å®ƒå¯¹æ€§èƒ½æœ‰ç§¯æå½±å“</li></ul><h3 id=æ€§èƒ½åˆ†ææ¨¡å¼profiling-patterns>æ€§èƒ½åˆ†ææ¨¡å¼(Profiling Patterns)</h3><h4 id=timing-functions>Timing Functions</h4><ul><li>åŒ…è£…å‡½æ•°å¹¶è®°å½•æ‰§è¡Œ</li><li>åœ¨ä¼˜åŒ–ä»£ç æ—¶ é€šå¸¸éœ€è¦å¿«é€Ÿç®€å•çš„æ—¶é—´æµ‹é‡ ä»¥æ­¤æ¥éªŒè¯å‡è®¾ è€Œä¸æ˜¯ä½¿ç”¨profilerå·¥å…·/æ¡†æ¶</li><li>å¯ä»¥ä½¿ç”¨<code>time</code>åŒ…å’Œ<code>defer</code>è¯­å¥æ‰§è¡Œæ—¶é—´æµ‹é‡</li></ul><h4 id=ç”¨æ³•-1>ç”¨æ³•</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// profile.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>profile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è®¡ç®—å‡½æ•°æ‰§è¡Œçš„æŒç»­æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Duration</span><span class=p>(</span><span class=nx>invocation</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>,</span> <span class=nx>name</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>elapsed</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Since</span><span class=p>(</span><span class=nx>invocation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s lasted %s&#34;</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>elapsed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// main.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;package/profile&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Func1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Arguments to a defer statement is immediately evaluated and stored.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// The deferred function receives the pre-evaluated values when its invoked.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// time.Now() ä¼šç«‹å³æ‰§è¡Œå¹¶å­˜å‚¨ å³ä¼ å…¥çš„æ˜¯è¯¥å‡½æ•°çš„å¼€å§‹æ‰§è¡Œæ—¶é—´
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>defer</span> <span class=nx>profile</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span> <span class=s>&#34;Func1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Func2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>profile</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span> <span class=s>&#34;Func2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>3</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Func1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>Func2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>è¾“å‡ºç¤ºä¾‹:
</span></span></span><span class=line><span class=cl><span class=cm>2025/04/02 12:54:16 Func1 lasted 5.0131114s
</span></span></span><span class=line><span class=cl><span class=cm>2025/04/02 12:54:19 Func2 lasted 3.0020849s
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=function-options>Function Options</h3><p><a class=link href=https://ilolicon.github.io/p/go-functional-options/ target=_blank rel=noopener>å‡½æ•°é€‰é¡¹æ¨¡å¼</a></p><h3 id=circuit-breaker>Circuit-Breaker</h3><p><a class=link href=https://github.com/sony/gobreaker target=_blank rel=noopener>æ–­è·¯å™¨æ¨¡å¼</a></p><h2 id=å‚è€ƒæ–‡æ¡£>å‚è€ƒæ–‡æ¡£</h2><p><a class=link href=http://marcio.io/2015/07/singleton-pattern-in-go/ target=_blank rel=noopener>singleton-pattern-in-go</a></p><p><a class=link href=https://www.fengfengzhidao.com/article/JI33Q5QB8lppN5cbFPQR target=_blank rel=noopener>Go24ç§è®¾è®¡æ¨¡å¼</a></p><p><a class=link href=https://github.com/tmrts/go-patterns.git target=_blank rel=noopener>go-patterns</a></p><p><a class=link href=https://github.com/senghoo/golang-design-pattern.git target=_blank rel=noopener>golang-design-pattern</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/go%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F/>Goç¼–ç¨‹æ¨¡å¼</a>
<a href=/tags/golang/>Golang</a>
<a href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>è®¾è®¡æ¨¡å¼</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/go-functional-options/><div class=article-details><h2 class=article-title>GO FUNCTIONAL OPTIONS</h2></div></a></article><article><a href=/p/go-generics/><div class=article-details><h2 class=article-title>GO Generics</h2></div></a></article><article><a href=/p/golang/><div class=article-details><h2 class=article-title>Golang</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=ilolicon/ilolicon.github.io issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2025 ilolicon's Blog</section><section class=powerby>VicissitudeğŸ³<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>