<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Go语言中设计模式的实现细节."><title>GO DESIGN PATTERNS</title><link rel=canonical href=https://ilolicon.github.io/p/go-design-patterns/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="GO DESIGN PATTERNS"><meta property="og:description" content="Go语言中设计模式的实现细节."><meta property="og:url" content="https://ilolicon.github.io/p/go-design-patterns/"><meta property="og:site_name" content="ilolicon's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Go编程模式"><meta property="article:tag" content="Golang"><meta property="article:tag" content="设计模式"><meta property="article:published_time" content="2023-04-21T11:43:42+08:00"><meta property="article:modified_time" content="2023-04-21T11:43:42+08:00"><meta name=twitter:title content="GO DESIGN PATTERNS"><meta name=twitter:description content="Go语言中设计模式的实现细节."><link rel="shortcut icon" href=/img/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu96a5ab8e0364e843af4687201b687892_162934_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>ilolicon's Blog</a></h1><h2 class=site-description>Keep Calm and Carry On.</h2></div></header><ol class=social-menu><li><a href=https://github.com/ilolicon target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#创建型模式>创建型模式</a><ol><li><a href=#单例模式singleton->单例模式(Singleton) ✔</a><ol><li><a href=#适用场景>适用场景</a></li><li><a href=#实现方式及解析>实现方式及解析</a></li></ol></li><li><a href=#简单工厂模式simple-factory->简单工厂模式(Simple Factory) ✔</a><ol><li><a href=#特点>特点</a></li><li><a href=#适用场景-1>适用场景</a></li><li><a href=#优点>优点</a></li><li><a href=#缺点>缺点</a></li><li><a href=#示例>示例</a></li></ol></li><li><a href=#工厂方法模式factory-method->工厂方法模式(Factory Method) ✔</a><ol><li><a href=#特点-1>特点</a></li><li><a href=#适用场景-2>适用场景</a></li><li><a href=#优点-1>优点</a></li><li><a href=#缺点-1>缺点</a></li><li><a href=#示例-1>示例</a></li></ol></li><li><a href=#抽象工厂模式abstract-factory->抽象工厂模式(Abstract Factory) ✘</a><ol><li><a href=#特点-2>特点</a></li><li><a href=#适用场景-3>适用场景</a></li><li><a href=#优点-2>优点</a></li><li><a href=#缺点-2>缺点</a></li><li><a href=#示例-2>示例</a></li></ol></li><li><a href=#建造者模式builder->建造者模式(Builder) ✔</a><ol><li><a href=#示例-3>示例</a></li></ol></li><li><a href=#原型模式prototype->原型模式(Prototype) ✘</a><ol><li><a href=#示例-4>示例</a></li><li><a href=#注意事项>注意事项</a></li></ol></li></ol></li><li><a href=#结构型模式>结构型模式</a><ol><li><a href=#外观模式facade->外观模式(Facade) ✔</a><ol><li><a href=#适用场景-4>适用场景</a></li><li><a href=#优点-3>优点</a></li><li><a href=#缺点-3>缺点</a></li><li><a href=#示例-5>示例</a></li></ol></li><li><a href=#适配器模式adapter->适配器模式(Adapter) ✔</a><ol><li><a href=#优点-4>优点</a></li><li><a href=#缺点-4>缺点</a></li><li><a href=#示例-6>示例</a></li></ol></li><li><a href=#代理模式proxy->代理模式(Proxy) ✔</a><ol><li><a href=#适用场景-5>适用场景</a></li><li><a href=#示例-7>示例</a></li></ol></li><li><a href=#组合模式composite->组合模式(Composite) ✘</a><ol><li><a href=#适用场景-6>适用场景</a></li><li><a href=#优点-5>优点</a></li><li><a href=#示例-8>示例</a></li></ol></li><li><a href=#享元模式flyweight->享元模式(Flyweight) ✘</a><ol><li><a href=#示例-9>示例</a></li></ol></li><li><a href=#装饰模式decorator->装饰模式(Decorator) ✔</a><ol><li><a href=#优点-6>优点</a></li><li><a href=#示例-10>示例</a></li></ol></li><li><a href=#桥模式bridge->桥模式(Bridge) ✘</a><ol><li><a href=#示例-11>示例</a></li><li><a href=#优点-7>优点</a></li></ol></li></ol></li><li><a href=#行为型模式>行为型模式</a><ol><li><a href=#中介者模式mediator>中介者模式(Mediator)</a><ol><li><a href=#优点-8>优点</a></li><li><a href=#示例-12>示例</a></li></ol></li><li><a href=#观察者模式observer->观察者模式(Observer) ✔</a><ol><li><a href=#优点-9>优点</a></li><li><a href=#示例-13>示例</a></li></ol></li><li><a href=#命令模式command->命令模式(Command) ✔</a><ol><li><a href=#核心思想>核心思想</a></li><li><a href=#示例-14>示例</a></li></ol></li><li><a href=#迭代器模式iterator>迭代器模式(Iterator)</a><ol><li><a href=#适用场景-7>适用场景</a></li><li><a href=#示例-15>示例</a></li></ol></li><li><a href=#模板方法模式template-method->模板方法模式(Template Method) ✔</a><ol><li><a href=#适用场景-8>适用场景</a></li><li><a href=#优点-10>优点</a></li><li><a href=#示例-16>示例</a></li></ol></li><li><a href=#策略模式strategy->策略模式(Strategy) ✔</a><ol><li><a href=#适用场景-9>适用场景</a></li><li><a href=#优点-11>优点</a></li><li><a href=#示例-17>示例</a></li></ol></li><li><a href=#状态模式state>状态模式(State)</a><ol><li><a href=#优点-12>优点</a></li><li><a href=#示例-18>示例</a></li></ol></li><li><a href=#备忘录模式memento>备忘录模式(Memento)</a><ol><li><a href=#优点-13>优点</a></li><li><a href=#示例-19>示例</a></li></ol></li><li><a href=#解释器模式interpreter>解释器模式(Interpreter)</a><ol><li><a href=#抽象语法树>抽象语法树</a></li><li><a href=#适用场景-10>适用场景</a></li><li><a href=#示例-20>示例</a></li></ol></li><li><a href=#职责链模式chain-of-responsibility>职责链模式(Chain of Responsibility)</a><ol><li><a href=#核心思想-1>核心思想</a></li><li><a href=#适用场景-11>适用场景</a></li><li><a href=#示例-21>示例</a></li></ol></li><li><a href=#访问者模式visitor>访问者模式(Visitor)</a><ol><li><a href=#优点-14>优点</a></li><li><a href=#示例-22>示例</a></li></ol></li></ol></li><li><a href=#其余常用模式>其余常用模式</a><ol><li><a href=#对象池模式object-pool-pattern->对象池模式(Object Pool Pattern) ✔</a><ol><li><a href=#实现>实现</a></li><li><a href=#用法>用法</a></li><li><a href=#经验法则>经验法则</a></li></ol></li><li><a href=#性能分析模式profiling-patterns>性能分析模式(Profiling Patterns)</a><ol><li><a href=#timing-functions>Timing Functions</a></li><li><a href=#用法-1>用法</a></li></ol></li><li><a href=#function-options>Function Options</a></li><li><a href=#circuit-breaker>Circuit-Breaker</a></li></ol></li><li><a href=#参考文档>参考文档</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/golang/ style=background-color:#38a8d2;color:#fff>Golang</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/go-design-patterns/>GO DESIGN PATTERNS</a></h2><h3 class=article-subtitle>Go语言中设计模式的实现细节.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Apr 21, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 35 分钟</time></div></footer></div></header><section class=article-content><ul><li><code>设计模式</code>是软件设计中常见问题的典型解决方案 每个模式就像一张蓝图 你可以通过对其进行定制来解决代码中的特定设计问题</li><li>模式是针对软件设计中常见问题的解决方案工具箱 它们定义了一种让你的团队能更高效沟通的通用语言</li><li>不同设计模式在其复杂程度、细节层次以及应用范围等方面各不相同 此外 我们可以根据模式的目的来将它们划分为三个不同的组别<ul><li><code>创建型模式</code> 提供对象的创建机制 增加已有代码的灵活性和复用性</li><li><code>结构型模式</code> 介绍如何将对象和类组装成较大的结构 并同时保持结构的灵活和高效</li><li><code>行为型模式</code> 负责对象间的高效沟通和职责委派</li></ul></li></ul><h2 id=创建型模式>创建型模式</h2><ul><li>在Go语言中 创建型模式(Creational Patterns)是一类用于处理对象创建的设计模式</li><li>它们的主要目标是提供一种灵活的方式来创建对象 同时隐藏对象创建的具体细节 从而降低代码的耦合度 并提高代码的可复用性和可维护性</li><li>比如标准库: <code>http.NewRequest()</code> <code>bytes.NewReader()</code> <code>md5.New()</code> 等等 &mldr;</li><li>创建型模式的核心思想是将对象的创建与使用分离 使得系统不依赖于具体的对象创建方式 而是依赖于抽象</li></ul><h3 id=单例模式singleton->单例模式(Singleton) ✔</h3><ul><li>单例模式(singleton) 保证一个类只有一个实例 并提供一个访问它的全局访问点</li><li>通常让一个全局变量成为一个对象被访问 但不能防止实例化多个对象</li><li>常见做法：让类自身负责保证它的唯一实例 这个类可以保证没有其他实例可以被创建 并且可以提供一个访问该实例的方法</li></ul><h4 id=适用场景>适用场景</h4><ul><li>当某个对象只能存在一个实例的情况下使用单例模式 比如：<ul><li>全局Config配置对象</li><li>全局Logger日志对象</li><li>&mldr;</li></ul></li><li>优点：<ul><li>提供了对唯一实例的受控访问</li><li>由于在系统内存中只存在一个对象 因此可以节约系统资源 对于一些需要频繁创建和销毁的对象 单例模式可以提高系统性能</li></ul></li></ul><h4 id=实现方式及解析>实现方式及解析</h4><h5 id=饿汉模式>饿汉模式</h5><ul><li>在程序加载时就创建对象实例</li><li>Go语言中我们可以放到<code>init</code>函数中 保证线程安全<ul><li>会减慢程序启动速度(<code>init</code>启动时会先加载)</li><li>如果实例不被调用 则会浪费一段内存空间 特别是该对象比较大的时候</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=懒汉模式>懒汉模式</h5><ul><li>在获取对象实例时 如果实例为空则创建</li><li>避免饿汉模式的内存空间浪费</li><li>在Go中并发非常容易 容易被不正确使用 导致忽略并发安全</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>在上述情况下 多个goroutine都可以执行第一个检查</li><li>并且它们都将创建该singleton类型的实例并相互覆盖 无法保证它将在此处返回哪个实例 并且对该实例的其他进一步操作可能与开发人员的期望不一致</li><li>如果有代码保留了对该单例实例的引用 则可能存在具有不同状态的该类型的多个实例 从而产生潜在的不同代码行为 这也成为调试过程中的一个噩梦 并且很难发现该错误</li><li>因为在调试时 由于运行时暂停而没有出现任何错误 这使非并发安全执行的可能性降到了最低 并且很容易隐藏开发人员的问题</li></ul><h5 id=双重检查模式激进加锁>双重检查模式(激进加锁)</h5><ul><li>解决懒汉模式的非线程安全 避免资源竞争导致数据不一致</li><li>潜在问题：<ul><li>如果实例存在 没有必要加锁</li><li>每次请求都加锁(执行过多的锁定) 降低性能/增加瓶颈</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>    <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span> <span class=c1>// 如果实例存在没有必要加锁
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>defer</span> <span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>优化：检查对应是否为空之后再加锁</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>    <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span> <span class=c1>// // 不太完美 因为这里不是完全原子的
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>defer</span> <span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>instance</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>上面的方式仍然不太完美 因为判断实例是否为空的过程仍然不是完全原子的</li><li>我们可以使用<code>sync/atomic</code>包 原子化加载并设置一个标志 该标志表明我们是否已初始化实例</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync/atomic&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>initialized</span> <span class=kt>uint32</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>    <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>atomic</span><span class=p>.</span><span class=nf>LoadUInt32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>initialized</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>{</span>  <span class=c1>// 原子操作 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>mu</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>initialized</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>         <span class=nx>atomic</span><span class=p>.</span><span class=nf>StoreUint32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>initialized</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=synconce>Sync.Once</h5><ul><li>Go语言单例惯用实现解析</li><li>上面实现原子操作的写法稍显繁琐</li><li>Go标准库<code>sync</code>中的<code>Once</code>类型 它能保证某个操作仅且只执行一次</li><li><code>sync.Once</code>源码</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Copyright 2009 The Go Authors. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=c1>// Use of this source code is governed by a BSD-style
</span></span></span><span class=line><span class=cl><span class=c1>// license that can be found in the LICENSE file.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>sync</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync/atomic&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// Once is an object that will perform exactly one action.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// A Once must not be copied after first use.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Once</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// done indicates whether the action has been performed.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// It is first in the struct because it is used in the hot path.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// The hot path is inlined at every call site.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// Placing done first allows more compact instructions on some architectures (amd64/386),
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// and fewer instructions (to calculate offset) on other architectures.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>done</span> <span class=kt>uint32</span>
</span></span><span class=line><span class=cl>    <span class=nx>m</span>    <span class=nx>Mutex</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Do calls the function f if and only if Do is being called for the
</span></span></span><span class=line><span class=cl><span class=c1>// first time for this instance of Once. In other words, given
</span></span></span><span class=line><span class=cl><span class=c1>//  var once Once
</span></span></span><span class=line><span class=cl><span class=c1>// if once.Do(f) is called multiple times, only the first call will invoke f,
</span></span></span><span class=line><span class=cl><span class=c1>// even if f has a different value in each invocation. A new instance of
</span></span></span><span class=line><span class=cl><span class=c1>// Once is required for each function to execute.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Do is intended for initialization that must be run exactly once. Since f
</span></span></span><span class=line><span class=cl><span class=c1>// is niladic, it may be necessary to use a function literal to capture the
</span></span></span><span class=line><span class=cl><span class=c1>// arguments to a function to be invoked by Do:
</span></span></span><span class=line><span class=cl><span class=c1>//  config.once.Do(func() { config.init(filename) })
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// Because no call to Do returns until the one call to f returns, if f causes
</span></span></span><span class=line><span class=cl><span class=c1>// Do to be called, it will deadlock.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1>// If f panics, Do considers it to have returned; future calls of Do return
</span></span></span><span class=line><span class=cl><span class=c1>// without calling f.
</span></span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Once</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>f</span> <span class=kd>func</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Note: Here is an incorrect implementation of Do:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// if atomic.CompareAndSwapUint32(&amp;o.done, 0, 1) {
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//      f()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//  }
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// Do guarantees that when it returns, f has finished.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// This implementation would not implement that guarantee:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// given two simultaneous calls, the winner of the cas would
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// call f, and the second would return immediately, without
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// waiting for the first&#39;s call to f to complete.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// This is why the slow path falls back to a mutex, and why
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// the atomic.StoreUint32 must be delayed until after f returns.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>atomic</span><span class=p>.</span><span class=nf>LoadUint32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>o</span><span class=p>.</span><span class=nx>done</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Outlined slow-path to allow inlining of the fast-path.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>o</span><span class=p>.</span><span class=nf>doSlow</span><span class=p>(</span><span class=nx>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Once</span><span class=p>)</span> <span class=nf>doSlow</span><span class=p>(</span><span class=nx>f</span> <span class=kd>func</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>o</span><span class=p>.</span><span class=nx>m</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>o</span><span class=p>.</span><span class=nx>m</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>o</span><span class=p>.</span><span class=nx>done</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>defer</span> <span class=nx>atomic</span><span class=p>.</span><span class=nf>StoreUint32</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>o</span><span class=p>.</span><span class=nx>done</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>f</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>通过上面源码发现 我们可以借助这个实现只执行一次某个函数/方法</li><li>once.Do()的用法如下</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>once</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>Once</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>once</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 在这里执行安全的初始化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=完整示例>完整示例</h5><ul><li>使用sync.Once包是安全地实现此目标的首选方式</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>singleton</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>instance</span> <span class=o>*</span><span class=nx>singleton</span>
</span></span><span class=line><span class=cl>    <span class=nx>once</span>     <span class=nx>sync</span><span class=p>.</span><span class=nx>Once</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>singleton</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetInstance</span><span class=p>()</span> <span class=o>*</span><span class=nx>singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>once</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>instance</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>singleton</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>instance</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=简单工厂模式simple-factory->简单工厂模式(Simple Factory) ✔</h3><ul><li>简单工厂并不是一个正式的设计模式 而是一种编程习惯 它通过一个工厂类来封装对象的创建逻辑 客户端只需要传递参数给工厂类 由工厂类决定创建哪种对象</li></ul><h4 id=特点>特点</h4><ul><li>只有一个工厂类 负责创建所有产品</li><li>通道条件判断(如<code>switch</code>或<code>if-else</code>)来决定创建哪种产品</li></ul><h4 id=适用场景-1>适用场景</h4><ul><li>产品种类少 且创建逻辑简单的场景</li></ul><h4 id=优点>优点</h4><ul><li>简单易用 适合小型项目</li></ul><h4 id=缺点>缺点</h4><ul><li>不符合开闭原则(OCP) 新增产品时需要修改工厂类</li></ul><blockquote><p><a class=link href=https://zh.wikipedia.org/wiki/%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99 target=_blank rel=noopener>开闭原则</a>: 当需求发生变化时 可以通过增加新的代码来扩展系统的功能 而不是修改现有的代码</p></blockquote><h4 id=示例>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Product</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Use</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ProductA</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ProductA</span><span class=p>)</span> <span class=nf>Use</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Using Product A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ProductB</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ProductB</span><span class=p>)</span> <span class=nf>Use</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Using Product B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>CreateProduct</span><span class=p>(</span><span class=nx>productType</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>Product</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=nx>productType</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;A&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ProductA</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;B&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ProductB</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>productA</span> <span class=o>:=</span> <span class=nf>CreateProduct</span><span class=p>(</span><span class=s>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>productA</span><span class=p>.</span><span class=nf>Use</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>productB</span> <span class=o>:=</span> <span class=nf>CreateProduct</span><span class=p>(</span><span class=s>&#34;B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>productB</span><span class=p>.</span><span class=nf>Use</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=工厂方法模式factory-method->工厂方法模式(Factory Method) ✔</h3><ul><li>上面的简单工厂模式 一个工厂就负责了多个产品的生产</li><li>工厂方法模式则是定义了一个创建对象的接口 但将具体的创建逻辑延迟到子类中 每个子类负责创建一种具体的产品</li></ul><h4 id=特点-1>特点</h4><ul><li>每个产品对应一个工厂类</li><li>符合<code>开闭原则</code> 新增产品时只需增加新的工厂类 无需修改现有代码</li><li>将对象的实例化推迟到用于创建实例的专用函数</li></ul><h4 id=适用场景-2>适用场景</h4><ul><li>产品种类多 且创建逻辑复杂的场景</li></ul><h4 id=优点-1>优点</h4><ul><li>符合开闭原则 扩展性强</li><li>每个工厂只负责一种产品的创建 职责单一</li></ul><h4 id=缺点-1>缺点</h4><ul><li>类的数量会增加 系统复杂度提高</li></ul><h4 id=示例-1>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Database</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>MySQL</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>MySQL</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to MySQL&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>PostgreSQL</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=nx>PostgreSQL</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to PostgreSQL&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// DatabaseFactory工厂接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DatabaseFactory</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateDatabase</span><span class=p>()</span> <span class=nx>Database</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>MySQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=nx>MySQLFactory</span><span class=p>)</span> <span class=nf>CreateDatabase</span><span class=p>()</span> <span class=nx>Database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>MySQL</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>PostgreSQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=nx>PostgreSQLFactory</span><span class=p>)</span> <span class=nf>CreateDatabase</span><span class=p>()</span> <span class=nx>Database</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>PostgreSQL</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UseDatabaseFactory</span><span class=p>(</span><span class=nx>factory</span> <span class=nx>DatabaseFactory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>db</span> <span class=o>:=</span> <span class=nx>factory</span><span class=p>.</span><span class=nf>CreateDatabase</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>db</span><span class=p>.</span><span class=nf>Connect</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabaseFactory</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>MySQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabaseFactory</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PostgreSQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=抽象工厂模式abstract-factory->抽象工厂模式(Abstract Factory) ✘</h3><ul><li>抽象工厂模式提供一个创建一系列相关或相互依赖对象的接口 而无需指定它们的具体类 它适用于需要创建一组相关产品的场景</li></ul><h4 id=特点-2>特点</h4><ul><li>每个工厂类可以创建多个相关产品</li><li>强调<strong>产品族</strong>的概念 例如GUI库中的不同风格组件(Windows风格、Mac风格)</li></ul><h4 id=适用场景-3>适用场景</h4><ul><li>需要创建一组相关对象的场景</li></ul><h4 id=优点-2>优点</h4><ul><li>可以创建一组相关对象 保证对象之间的兼容性</li><li>符合开闭原则 扩展性强</li></ul><h4 id=缺点-2>缺点</h4><ul><li>类的数量会增加 系统复杂度提高</li><li>新增产品族或产品等级结构时 需要修改抽象工厂接口及其所有实现类</li></ul><h4 id=示例-2>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 抽象层：数据库连接接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBConnention</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 抽象层：数据库命令接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBCommand</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体产品：MySQL连接
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MySQLConnection</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLConnection</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to MySQL&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体产品：MySQL命令
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MySQLCommand</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Executed MySQL query: %s&#34;</span><span class=p>,</span> <span class=nx>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体产品：Postgres连接
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PostgresSQLConnection</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLConnection</span><span class=p>)</span> <span class=nf>Connect</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;Connected to Postgres&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体产品：PostgresSQL命令
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PostgresSQLCommand</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Executed PostgresSQL query: %s&#34;</span><span class=p>,</span> <span class=nx>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 抽象工厂接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DBFactory</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateConnection</span><span class=p>()</span> <span class=nx>DBConnention</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateCommand</span><span class=p>()</span> <span class=nx>DBCommand</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体的MySQL工厂
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MySQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLFactory</span><span class=p>)</span> <span class=nf>CreateConnection</span><span class=p>()</span> <span class=nx>DBConnention</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>MySQLConnection</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MySQLFactory</span><span class=p>)</span> <span class=nf>CreateCommand</span><span class=p>()</span> <span class=nx>DBCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>MySQLCommand</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体的PostgresSQL工厂
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PostgresSQLFactory</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLFactory</span><span class=p>)</span> <span class=nf>CreateConnection</span><span class=p>()</span> <span class=nx>DBConnention</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>PostgresSQLConnection</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PostgresSQLFactory</span><span class=p>)</span> <span class=nf>CreateCommand</span><span class=p>()</span> <span class=nx>DBCommand</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>PostgresSQLCommand</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UseDatabase</span><span class=p>(</span><span class=nx>factory</span> <span class=nx>DBFactory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>connection</span> <span class=o>:=</span> <span class=nx>factory</span><span class=p>.</span><span class=nf>CreateConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>command</span> <span class=o>:=</span> <span class=nx>factory</span><span class=p>.</span><span class=nf>CreateCommand</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>connection</span><span class=p>.</span><span class=nf>Connect</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>command</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=s>&#34;SELECT * FROM table&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 业务逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabase</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>MySQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nf>UseDatabase</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PostgresSQLFactory</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=建造者模式builder->建造者模式(Builder) ✔</h3><ul><li>用于分步构建复杂对象</li><li>建造者模式的核心思想是将一个复杂对象的构建过程与其表示分离 使得同样的构建过程可以创建不同的表示</li><li>建造者模式特别适用于以下场景<ul><li>对象的构建过程非常复杂 包含多个步骤</li><li>对象的构建过程需要支持不同的配置或表示</li></ul></li></ul><h4 id=示例-3>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>House</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Walls</span>   <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Roof</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Windows</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Doors</span>   <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>House</span><span class=p>)</span> <span class=nf>Show</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;House with %s walls, %s roof, %s windows, and %s doors\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>h</span><span class=p>.</span><span class=nx>Walls</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Roof</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Windows</span><span class=p>,</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Doors</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 建造者接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HouseBuilder</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildWalls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildRoof</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildWindows</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>BuildDoors</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>GetHouse</span><span class=p>()</span> <span class=o>*</span><span class=nx>House</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体建造者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConcreateHouseBuilder</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>house</span> <span class=o>*</span><span class=nx>House</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 返回一个空House
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewConcreateHouseBuilder</span><span class=p>()</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ConcreateHouseBuilder</span><span class=p>{</span><span class=nx>house</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>House</span><span class=p>{}}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildWalls</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Walls</span> <span class=p>=</span> <span class=s>&#34;concrete&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildRoof</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Roof</span> <span class=p>=</span> <span class=s>&#34;tile&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildWindows</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Windows</span> <span class=p>=</span> <span class=s>&#34;glass&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>BuildDoors</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nx>house</span><span class=p>.</span><span class=nx>Doors</span> <span class=p>=</span> <span class=s>&#34;wooden&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>ConcreateHouseBuilder</span><span class=p>)</span> <span class=nf>GetHouse</span><span class=p>()</span> <span class=o>*</span><span class=nx>House</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>b</span><span class=p>.</span><span class=nx>house</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 指挥者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Director</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>builder</span> <span class=nx>HouseBuilder</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewDirector</span><span class=p>(</span><span class=nx>builder</span> <span class=nx>HouseBuilder</span><span class=p>)</span> <span class=o>*</span><span class=nx>Director</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Director</span><span class=p>{</span><span class=nx>builder</span><span class=p>:</span> <span class=nx>builder</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>Director</span><span class=p>)</span> <span class=nf>Construct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildWalls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildRoof</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildWindows</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>builder</span><span class=p>.</span><span class=nf>BuildDoors</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 客户端代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>builder</span> <span class=o>:=</span> <span class=nf>NewConcreateHouseBuilder</span><span class=p>()</span> <span class=c1>// 常见具体构建者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>director</span> <span class=o>:=</span> <span class=nf>NewDirector</span><span class=p>(</span><span class=nx>builder</span><span class=p>)</span>      <span class=c1>// 创建指挥者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>director</span><span class=p>.</span><span class=nf>Construct</span><span class=p>()</span>                  <span class=c1>// 指挥者构建产品
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>house</span> <span class=o>:=</span> <span class=nx>builder</span><span class=p>.</span><span class=nf>GetHouse</span><span class=p>()</span> <span class=c1>// 获取最终产品
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>house</span><span class=p>.</span><span class=nf>Show</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=原型模式prototype->原型模式(Prototype) ✘</h3><ul><li>它通过复制现有对象来创建新对象 而不是通过新建类的方式</li><li>原型模式的核心思想是利用对象的克隆能力 避免重复初始化 特别适用于<strong>创建成本较高</strong>的对象</li></ul><h4 id=示例-4>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 原型接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Prototype</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Clone</span><span class=p>()</span> <span class=nx>Prototype</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体原型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConcretePrototype</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Age</span>  <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConcretePrototype</span><span class=p>)</span> <span class=nf>Clone</span><span class=p>()</span> <span class=nx>Prototype</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建一个新对象 并复制当前对象的属性
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ConcretePrototype</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span><span class=p>:</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Age</span><span class=p>:</span>  <span class=nx>p</span><span class=p>.</span><span class=nx>Age</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConcretePrototype</span><span class=p>)</span> <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Name: %s, Age: %d&#34;</span><span class=p>,</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>p</span><span class=p>.</span><span class=nx>Age</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建原型对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>prototype</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ConcretePrototype</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;Tom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Age</span><span class=p>:</span>  <span class=mi>18</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 克隆原型对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>clone</span> <span class=o>:=</span> <span class=nx>prototype</span><span class=p>.</span><span class=nf>Clone</span><span class=p>().(</span><span class=o>*</span><span class=nx>ConcretePrototype</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 修改克隆对象属性
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>clone</span><span class=p>.</span><span class=nx>Name</span> <span class=p>=</span> <span class=s>&#34;Jerry&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>clone</span><span class=p>.</span><span class=nx>Age</span> <span class=p>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 输出原型对象和克隆对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Prototype:&#34;</span><span class=p>,</span> <span class=nx>prototype</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Clone:&#34;</span><span class=p>,</span> <span class=nx>clone</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=注意事项>注意事项</h4><ul><li>使用原型模式 如果有<strong>引用类型</strong> 则需要考虑深拷贝和浅拷贝的问题</li><li>浅拷贝只复制对象本身而不复制其引用的对象 深拷贝则会递归地复制整个对象图</li><li>这需要根据需求选择适当的拷贝方式</li></ul><h2 id=结构型模式>结构型模式</h2><ul><li>结构型模式<code>Structural Pattern</code> 它主要关注如何将类或对象组合成更大的结构 以便在不改变原有类或对象的情况下 实现新的功能或优化系统结构</li><li>结构型模式的核心思想是通过组合<code>Composition</code>而不是继承<code>Inheritance</code>来实现代码的复用和扩展</li><li>它们帮助开发者设计出灵活、可扩展的系统结构 同时降低类与类之间的耦合度</li></ul><h3 id=外观模式facade->外观模式(Facade) ✔</h3><ul><li>根据迪米特法则 如果两个类不必彼此直接通信 那么这两个类就不应当发生直接的相互作用</li><li>Facade模式也叫外观模式 是由GoF提出的23种设计模式中的一种</li><li>Facade模式为一组具有类似功能的类群 比如类库/子系统等等 提供一个一致的简单的界面</li><li>这个一致的简单的界面被称作facade</li></ul><h4 id=适用场景-4>适用场景</h4><ul><li>复杂系统需要简单入口使用</li><li>客户端程序与多个子系统之间存在很大的依赖性</li><li>在层次化结构中 可以使用外观模式定义系统中每一层的入口 层与层之间不直接产生联系 而通过外观类建立联系 降低层之间的耦合度</li></ul><h4 id=优点-3>优点</h4><ul><li>它对客户端屏蔽了子系统组件 减少了客户端所需处理的对象数目 并使得子系统使用起来更加容易</li><li>通过引入外观模式 客户端代码将变得很简单 与之关联的对象也很少</li><li>它实现了子系统与客户端之间的松耦合关系 这使得子系统的变化不会影响到调用它的客户端 只需要调整外观类即可</li><li>一个子系统的修改对其他子系统没有任何影响</li></ul><h4 id=缺点-3>缺点</h4><ul><li>不能很好地限制客户端直接使用子系统类 如果对客户端访问子系统类做太多的限制则减少了可变性和灵活性</li><li>如果设计不当 增加新的子系统可能需要修改外观类的源代码 违背了开闭原则</li></ul><h4 id=示例-5>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemA</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sa</span> <span class=o>*</span><span class=nx>SubSystemA</span><span class=p>)</span> <span class=nf>MethodA</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;子系统方法A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemB</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sb</span> <span class=o>*</span><span class=nx>SubSystemB</span><span class=p>)</span> <span class=nf>MethodB</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;子系统方法B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemC</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sc</span> <span class=o>*</span><span class=nx>SubSystemC</span><span class=p>)</span> <span class=nf>MethodC</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;子系统方法C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SubSystemD</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sd</span> <span class=o>*</span><span class=nx>SubSystemD</span><span class=p>)</span> <span class=nf>MethodD</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;子系统方法D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 外观模式 提供了一个外观类 简化成一个简单的接口供使用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Facade</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>a</span> <span class=o>*</span><span class=nx>SubSystemA</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span> <span class=o>*</span><span class=nx>SubSystemB</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span> <span class=o>*</span><span class=nx>SubSystemC</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span> <span class=o>*</span><span class=nx>SubSystemD</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Facade</span><span class=p>)</span> <span class=nf>MethodOne</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>a</span><span class=p>.</span><span class=nf>MethodA</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>b</span><span class=p>.</span><span class=nf>MethodB</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Facade</span><span class=p>)</span> <span class=nf>MethodTwo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>c</span><span class=p>.</span><span class=nf>MethodC</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>d</span><span class=p>.</span><span class=nf>MethodD</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果不用外观模式实现MethodA() 和 MethodB()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>sa</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemA</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>sa</span><span class=p>.</span><span class=nf>MethodA</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>sb</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>sb</span><span class=p>.</span><span class=nf>MethodB</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;-----------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用外观模式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>f</span> <span class=o>:=</span> <span class=nx>Facade</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>a</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemA</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemB</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemC</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>d</span><span class=p>:</span> <span class=nb>new</span><span class=p>(</span><span class=nx>SubSystemD</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 调用外观包裹方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>f</span><span class=p>.</span><span class=nf>MethodOne</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>示例2</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 电视机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TV</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TV</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;打开 电视机&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TV</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;关闭 电视机&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 音箱
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>VoiceBox</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>VoiceBox</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;打开 音箱&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>VoiceBox</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;关闭 音箱&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 灯光
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Light</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>l</span> <span class=o>*</span><span class=nx>Light</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;打开 灯光&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>l</span> <span class=o>*</span><span class=nx>Light</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;关闭 灯光&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 游戏机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Xbox</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>x</span> <span class=o>*</span><span class=nx>Xbox</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;打开 游戏机&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>x</span> <span class=o>*</span><span class=nx>Xbox</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;关闭 游戏机&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 麦克风
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MicroPhone</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MicroPhone</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;打开 麦克风&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MicroPhone</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;关闭 麦克风&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 投影仪
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Projector</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Projector</span><span class=p>)</span> <span class=nf>On</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;打开 投影仪&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Projector</span><span class=p>)</span> <span class=nf>Off</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;关闭 投影仪&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 家庭影院(外观)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HomePlayerFacade</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>tv</span> <span class=nx>TV</span>
</span></span><span class=line><span class=cl>    <span class=nx>vb</span> <span class=nx>VoiceBox</span>
</span></span><span class=line><span class=cl>    <span class=nx>light</span> <span class=nx>Light</span>
</span></span><span class=line><span class=cl>    <span class=nx>xbox</span> <span class=nx>Xbox</span>
</span></span><span class=line><span class=cl>    <span class=nx>mp</span> <span class=nx>MicroPhone</span>
</span></span><span class=line><span class=cl>    <span class=nx>pro</span> <span class=nx>Projector</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// KTV模式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>hp</span> <span class=o>*</span><span class=nx>HomePlayerFacade</span><span class=p>)</span> <span class=nf>DoKTV</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;家庭影院进入KTV模式&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>tv</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>pro</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>mp</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>light</span><span class=p>.</span><span class=nf>Off</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>vb</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 游戏模式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>hp</span> <span class=o>*</span><span class=nx>HomePlayerFacade</span><span class=p>)</span> <span class=nf>DoGame</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;家庭影院进入Game模式&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>tv</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>light</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hp</span><span class=p>.</span><span class=nx>xbox</span><span class=p>.</span><span class=nf>On</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>homePlayer</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>HomePlayerFacade</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>homePlayer</span><span class=p>.</span><span class=nf>DoKTV</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;------------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>homePlayer</span><span class=p>.</span><span class=nf>DoGame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=适配器模式adapter->适配器模式(Adapter) ✔</h3><ul><li>将一个类的接口转换成客户希望的另外一个接口</li><li>使得原本由于接口不兼容而不能一起工作的那些类可以一起工作</li></ul><h4 id=优点-4>优点</h4><ul><li>将目标类和适配者类解耦 通过引入一个适配器类来重用现有的适配者类 无须修改原有结构</li><li>增加了类的透明性和复用性 将具体的业务实现过程封装在适配者类中 对于客户端类而言是透明的 而且提高了适配者的复用性 同一个适配者类可以在多个不同的系统中复用</li><li>灵活性和扩展性都非常好 可以很方便地更换适配器 也可以在不修改原有代码的基础上增加新的适配器类 完全符合<strong>开闭原则</strong></li></ul><h4 id=缺点-4>缺点</h4><ul><li>适配器中置换适配者类的某些方法比较麻烦</li></ul><h4 id=示例-6>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 适配的目标
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>V5</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Use5V</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 业务类 依赖V5接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Phone</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>v</span> <span class=nx>V5</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewPhone</span><span class=p>(</span><span class=nx>v</span> <span class=nx>V5</span><span class=p>)</span> <span class=o>*</span><span class=nx>Phone</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Phone</span><span class=p>{</span><span class=nx>v</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Phone</span><span class=p>)</span> <span class=nf>Charge</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Phone进行充电...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>v</span><span class=p>.</span><span class=nf>Use5V</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 被适配的角色 适配者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>V220</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>V220</span><span class=p>)</span> <span class=nf>Use220V</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;使用220V的电压&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 电源适配器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Adapter</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>v220</span> <span class=o>*</span><span class=nx>V220</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>Adapter</span><span class=p>)</span> <span class=nf>Use5V</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;使用适配器进行充电&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 调用适配者的方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>a</span><span class=p>.</span><span class=nx>v220</span><span class=p>.</span><span class=nf>Use220V</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewAdapter</span><span class=p>(</span><span class=nx>v220</span> <span class=o>*</span><span class=nx>V220</span><span class=p>)</span> <span class=o>*</span><span class=nx>Adapter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Adapter</span><span class=p>{</span><span class=nx>v220</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ------- 业务逻辑层 -------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>iphone</span> <span class=o>:=</span> <span class=nf>NewPhone</span><span class=p>(</span><span class=nf>NewAdapter</span><span class=p>(</span><span class=nb>new</span><span class=p>(</span><span class=nx>V220</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>iphone</span><span class=p>.</span><span class=nf>Charge</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=代理模式proxy->代理模式(Proxy) ✔</h3><ul><li>它通过提供一个代理对象来控制对另一个对象的访问</li><li>代理模式的核心思想是在不改变原始对象的情况下 通过代理对象来增强或限制对原始对象的访问</li></ul><h4 id=适用场景-5>适用场景</h4><ul><li><code>延迟初始化</code> 当对象的创建成本较高时 可以通过代理延迟对象的初始化</li><li><code>访问控制</code> 通过代理对象限制对原始对象的访问权限</li><li><code>日志记录</code> 通过代理对象记录对原始对象的访问日志</li><li><code>缓存</code> 通过代理对象缓存原始对象的结果 避免重复计算</li></ul><h4 id=示例-7>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 主题接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Subject</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Request</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 真实对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>RealSubject</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>RealSubject</span><span class=p>)</span> <span class=nf>Request</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;RealSubject: Handling Request&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 代理对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Proxy</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>realSubject</span> <span class=o>*</span><span class=nx>RealSubject</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewProxy</span><span class=p>()</span> <span class=o>*</span><span class=nx>Proxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Proxy</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>Proxy</span><span class=p>)</span> <span class=nf>Request</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 延迟初始化真实对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=nx>p</span><span class=p>.</span><span class=nx>realSubject</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Proxy: Lazy Initialzing RealSubject&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>p</span><span class=p>.</span><span class=nx>realSubject</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>RealSubject</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 访问控制
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Proxy: Checking Access&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span> <span class=c1>//  模拟访问控制逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 调用真实对象的方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>p</span><span class=p>.</span><span class=nx>realSubject</span><span class=p>.</span><span class=nf>Request</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 日志记录
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Proxy: Logging Request&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>proxy</span> <span class=o>:=</span> <span class=nf>NewProxy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 通过代理对象访问真实对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>proxy</span><span class=p>.</span><span class=nf>Request</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=组合模式composite->组合模式(Composite) ✘</h3><ul><li>它允许你将对象组合成树形结构来表示<code>部分-整体</code>的层次关系</li><li>组合模式让客户端可以统一地处理单个对象和对象组合</li></ul><h4 id=适用场景-6>适用场景</h4><ul><li>文件系统：如目录和文件的管理 可以通过组合模式将文件夹视为组合节点 文件视为叶子节点</li><li>组织结构：如公司内部的部门和员工关系 可以通过组合模式将部门视为组合节点 员工视为叶子节点</li></ul><h4 id=优点-5>优点</h4><ul><li>简化客户端代码：客户端可以一致地对待单个对象和对象组合 而不需要关心它们的具体类型</li><li>增强灵活性：可以在不修改现有代码的情况下轻松添加新的组件或修改现有组件的结构</li><li>提高可扩展性：支持递归组合 使得复杂的层次结构易于构建和维护</li></ul><h4 id=示例-8>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 组件接口：文件系统节点
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>FileSystemNode</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 叶子节点：文件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>File</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>File</span><span class=p>)</span> <span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>indent</span> <span class=o>+</span> <span class=nx>f</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 组合节点：文件夹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Folder</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>children</span> <span class=p>[]</span><span class=nx>FileSystemNode</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Folder</span><span class=p>)</span> <span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>indent</span> <span class=o>+</span> <span class=nx>f</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>child</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>f</span><span class=p>.</span><span class=nx>children</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>child</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=nx>indent</span> <span class=o>+</span> <span class=s>&#34;  &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>Folder</span><span class=p>)</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>child</span> <span class=nx>FileSystemNode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nx>children</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>f</span><span class=p>.</span><span class=nx>children</span><span class=p>,</span> <span class=nx>child</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 客户端代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建文件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>file1</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>File</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;file1.txt&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>file2</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>File</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;file2.txt&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>file3</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>File</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;file3.txt&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建文件夹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>folder1</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Folder</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Folder1&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>folder2</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Folder</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Folder2&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 将文件添加到文件夹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>folder1</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>file1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>folder1</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>file2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>folder2</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>file3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 将文件夹添加到另一个文件夹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>rootFolder</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Folder</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Root&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>rootFolder</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>folder1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>rootFolder</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>folder2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 显示文件系统结构
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>rootFolder</span><span class=p>.</span><span class=nf>Display</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>输出：
</span></span></span><span class=line><span class=cl><span class=cm>Root
</span></span></span><span class=line><span class=cl><span class=cm>  Folder1
</span></span></span><span class=line><span class=cl><span class=cm>    file1.txt
</span></span></span><span class=line><span class=cl><span class=cm>    file2.txt
</span></span></span><span class=line><span class=cl><span class=cm>  Folder2
</span></span></span><span class=line><span class=cl><span class=cm>    file3.txt
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=享元模式flyweight->享元模式(Flyweight) ✘</h3><ul><li>它通过共享对象来减少内存使用和提高性能</li><li>享元模式的核心思想是将对象的共享部分(内部状态)与不可共享部分(外部状态)分离 从而减少重复对象的创建</li><li>享元模式的核心思想<ul><li><code>共享对象</code> 享元模式通过共享相同的内在状态(内部状态)来减少内存使用</li><li><code>分离状态</code> 将对象的状态分为内部状态(可共享)和外部状态(不可共享)</li><li><code>工厂管理</code> 使用工厂模式来管理和复用享元对象</li></ul></li></ul><h4 id=示例-9>示例</h4><ul><li>在数据库操作中 创建和销毁连接是非常耗时的操作</li><li>为了提高性能 通常会使用连接池来管理数据库连接 连接池的核心思想是：<ul><li>复用连接：从连接池中获取连接 使用完后将连接释放回连接池 而不是销毁</li><li>减少开销：避免频繁创建和销毁连接 从而提高性能</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 享元接口：数据库连接
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Connection</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体享元：数据库连接对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConcreteConnection</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>ConcreteConnection</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Connection %d executing query: %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 享元工厂：连接池
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ConnectionPool</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>connections</span> <span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=nx>Connection</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>       <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl>    <span class=nx>nextID</span>      <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewConnectionPool</span><span class=p>()</span> <span class=o>*</span><span class=nx>ConnectionPool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>ConnectionPool</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>connections</span><span class=p>:</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=nx>Connection</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>nextID</span><span class=p>:</span>      <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取连接对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConnectionPool</span><span class=p>)</span> <span class=nf>GetConnection</span><span class=p>()</span> <span class=nx>Connection</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>conn</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nb>delete</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>conn</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建新的连接对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>conn</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ConcreteConnection</span><span class=p>{</span><span class=nx>id</span><span class=p>:</span> <span class=nx>p</span><span class=p>.</span><span class=nx>nextID</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>nextID</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>conn</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将连接对象释放回连接池 以便其他客户端可以复用这个连接对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>ConnectionPool</span><span class=p>)</span> <span class=nf>ReleaseConnection</span><span class=p>(</span><span class=nx>conn</span> <span class=nx>Connection</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>p</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>c</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>conn</span><span class=p>.(</span><span class=o>*</span><span class=nx>ConcreteConnection</span><span class=p>);</span> <span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>[</span><span class=nx>c</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span> <span class=p>=</span> <span class=nx>c</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 客户端代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>pool</span> <span class=o>:=</span> <span class=nf>NewConnectionPool</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>conn1</span> <span class=o>:=</span> <span class=nx>pool</span><span class=p>.</span><span class=nf>GetConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn1</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=s>&#34;SELECT * FROM users&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>pool</span><span class=p>.</span><span class=nf>ReleaseConnection</span><span class=p>(</span><span class=nx>conn1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>conn2</span> <span class=o>:=</span> <span class=nx>pool</span><span class=p>.</span><span class=nf>GetConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>conn2</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=s>&#34;SELECT * FROM orders&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>pool</span><span class=p>.</span><span class=nf>ReleaseConnection</span><span class=p>(</span><span class=nx>conn2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Connection 1 executing query: SELECT * FROM users
</span></span></span><span class=line><span class=cl><span class=cm>Connection 1 executing query: SELECT * FROM orders
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=装饰模式decorator->装饰模式(Decorator) ✔</h3><ul><li>它允许你动态地为对象添加行为或职责 而不需要修改对象的原始类</li><li>通过引入装饰者类 可以在运行时灵活地组合不同的功能 而不需要创建大量的子类</li><li>装饰者模式的核心思想是将对象包装在一个或多个装饰者中 每个装饰者都可以在调用被装饰对象的方法之前或之后添加额外的行为</li></ul><h4 id=优点-6>优点</h4><ul><li>动态扩展功能<ul><li>你可以在运行时为请求处理器添加日志记录和性能监控功能 而无需修改核心请求处理器的代码</li></ul></li><li>单一职责原则<ul><li>每个装饰器只负责一个特定的功能(如日志记录或性能监控) 符合单一职责原则</li></ul></li><li>灵活性<ul><li>可以轻松地添加或移除装饰器 而不会影响其他部分的代码</li></ul></li></ul><h4 id=示例-10>示例</h4><ul><li>假设你正在开发一个Web服务 其中有一个核心功能是处理用户请求</li><li>现在 你需要在不修改核心功能代码的情况下 为请求处理添加以下功能<ul><li>日志记录：记录每个请求的详细信息</li><li>性能监控：记录每个请求的处理时间</li></ul></li><li>使用装饰器模式 你可以轻松地实现这些功能 而无需修改原始请求处理逻辑</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 组件接口：请求处理器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>RequestHandler</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CoreRequestHandler</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>handler</span> <span class=o>*</span><span class=nx>CoreRequestHandler</span><span class=p>)</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>100</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Response from %s&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 装饰器: 日志记录
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>LoggingDecorator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>handler</span> <span class=nx>RequestHandler</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>l</span> <span class=o>*</span><span class=nx>LoggingDecorator</span><span class=p>)</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;LoggingDecorator: Request to %s\n&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>response</span> <span class=o>:=</span> <span class=nx>l</span><span class=p>.</span><span class=nx>handler</span><span class=p>.</span><span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Logging: Response for %s: %s\n&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 装饰器：性能监控
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PerformanceMonitorDecorator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>handler</span> <span class=nx>RequestHandler</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PerformanceMonitorDecorator</span><span class=p>)</span> <span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 记录开始时间
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>start</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 调用原始处理器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>response</span> <span class=o>:=</span> <span class=nx>p</span><span class=p>.</span><span class=nx>handler</span><span class=p>.</span><span class=nf>HandleRequest</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 记录处理时间
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>duration</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Since</span><span class=p>(</span><span class=nx>start</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Performance: Request for %s took %v\n&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=nx>duration</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建请求处理器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>handler</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>CoreRequestHandler</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加日志记录
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>loggingHandler</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>LoggingDecorator</span><span class=p>{</span><span class=nx>handler</span><span class=p>:</span> <span class=nx>handler</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加性能监控
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>monitorHandler</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>PerformanceMonitorDecorator</span><span class=p>{</span><span class=nx>handler</span><span class=p>:</span> <span class=nx>loggingHandler</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 处理请求
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>monitorHandler</span><span class=p>.</span><span class=nf>HandleRequest</span><span class=p>(</span><span class=s>&#34;http://www.baidu.com&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=桥模式bridge->桥模式(Bridge) ✘</h3><ul><li>它的核心思想是将抽象部分与实现部分分离 使它们可以独立变化</li><li>通过这种方式 桥接模式能够避免类的数量爆炸(即类的组合呈指数增长) 同时提高代码的可扩展性和可维护性</li></ul><h4 id=示例-11>示例</h4><ul><li>假设你有两台电脑：一台 Mac 和一台 Windows 还有两台打印机：爱普生和惠普</li><li>这两台电脑和打印机可能会任意组合使用</li><li>刚开始功能会这样写 windows组合爱普生和惠普 mac组合爱普生和惠普 打印就调用自己的print方法</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Mac + Epson
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MacEpson</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MacEpson</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for mac&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a EPSON Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Mac + HP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>MacHp</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>MacHp</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for mac&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a HP Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Windows + Epson
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WindowsEpson</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WindowsEpson</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a EPSON Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Windows + HP
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WindowsHp</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WindowsHp</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by a HP Printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>但是 如果引入新的打印机 代码量会成倍增长</li><li>所以 我们需要把计算机和打印机解耦 计算机的print的方法 就桥接到选择的打印机的print方法上</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义Printer接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Printer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>PrintFile</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义Epson打印机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Epson</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Epson</span><span class=p>)</span> <span class=nf>PrintFile</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by Epson printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义惠普打印机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HP</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HP</span><span class=p>)</span> <span class=nf>PrintFile</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Printing by HP printer&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义Computer接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Computer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>Printer</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义Mac计算机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Mac</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>printer</span> <span class=nx>Printer</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>Mac</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for Mac&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>m</span><span class=p>.</span><span class=nx>printer</span><span class=p>.</span><span class=nf>PrintFile</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>Mac</span><span class=p>)</span> <span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>p</span> <span class=nx>Printer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>m</span><span class=p>.</span><span class=nx>printer</span> <span class=p>=</span> <span class=nx>p</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义windows计算机
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Windows</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>printer</span> <span class=nx>Printer</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>Windows</span><span class=p>)</span> <span class=nf>Print</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Print request for Windows&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>printer</span><span class=p>.</span><span class=nf>PrintFile</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>Windows</span><span class=p>)</span> <span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>p</span> <span class=nx>Printer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>printer</span> <span class=p>=</span> <span class=nx>p</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建打印机实例
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hpPrinter</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>HP</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>epsonPrinter</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Epson</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建计算机实例
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>macComputer</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Mac</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>winComputer</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Windows</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Mac 使用 HP 打印机
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>hpPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Mac 使用 Epson 打印机
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>epsonPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>macComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Windows 使用 HP 打印机
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>hpPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Windows 使用 Epson 打印机
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>SetPrinter</span><span class=p>(</span><span class=nx>epsonPrinter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>winComputer</span><span class=p>.</span><span class=nf>Print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=优点-7>优点</h4><ul><li>解耦<ul><li>抽象部分和实现部分可以独立变化 互不影响</li><li>修改实现部分不会影响抽象部分的代码</li></ul></li><li>灵活性<ul><li>可以动态地切换实现部分(例如 运行时更换实现)</li></ul></li><li>可扩展性<ul><li>新增抽象部分或实现部分时 不需要修改现有代码</li></ul></li><li>避免类爆炸<ul><li>通过组合代替继承 避免了类的数量呈指数增长</li></ul></li></ul><h2 id=行为型模式>行为型模式</h2><ul><li>行为型模式<code>Behavioral pattern</code> 它主要关注对象之间的职责分配和通信方式</li><li>行为型模式的核心思想是通过定义对象之间的交互方式 来更好地实现系统的功能 同时降低对象之间的耦合度</li></ul><h3 id=中介者模式mediator>中介者模式(Mediator)</h3><ul><li>它通过引入一个中介者对象来封装一组对象之间的交互</li><li>中介者模式的核心思想是 将对象之间的复杂交互集中到一个中介者对象中 从而减少对象之间的直接耦合</li></ul><h4 id=优点-8>优点</h4><ul><li>减少耦合：对象之间不直接通信 而是通过中介者进行交互 减少了对象之间的耦合</li><li>集中控制：将对象之间的交互逻辑集中到中介者中 便于维护和扩展</li><li>简化对象职责：每个对象只需要关注自己的行为 而不需要知道其他对象的存在</li></ul><h4 id=示例-12>示例</h4><ul><li>假设我们有一个聊天室系统 用户(同事类)之间通过聊天室(中介者)发送消息</li><li>用户之间不直接通信 而是通过聊天室来转发消息</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义中介者接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Mediator</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>SendMessage</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>sender</span> <span class=nx>Colleague</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体中介者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>ChatRoom</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>users</span> <span class=p>[]</span><span class=nx>Colleague</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>ChatRoom</span><span class=p>)</span> <span class=nf>Register</span><span class=p>(</span><span class=nx>user</span> <span class=nx>Colleague</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>users</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>users</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>ChatRoom</span><span class=p>)</span> <span class=nf>SendMessage</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>sender</span> <span class=nx>Colleague</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>user</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>c</span><span class=p>.</span><span class=nx>users</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>user</span> <span class=o>!=</span> <span class=nx>sender</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>user</span><span class=p>.</span><span class=nf>Receive</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义同事类接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Colleague</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Send</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>Receive</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体同事类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span>     <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>mediator</span> <span class=nx>Mediator</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>u</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=nf>Send</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s sends: %s\n&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>u</span><span class=p>.</span><span class=nx>mediator</span><span class=p>.</span><span class=nf>SendMessage</span><span class=p>(</span><span class=nx>message</span><span class=p>,</span> <span class=nx>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>u</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=nf>Receive</span><span class=p>(</span><span class=nx>message</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s receives: %s\n&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建中介者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>chatRoom</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ChatRoom</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建用户
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>alice</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span> <span class=nx>mediator</span><span class=p>:</span> <span class=nx>chatRoom</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>bob</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Bob&#34;</span><span class=p>,</span> <span class=nx>mediator</span><span class=p>:</span> <span class=nx>chatRoom</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>charlie</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Charlie&#34;</span><span class=p>,</span> <span class=nx>mediator</span><span class=p>:</span> <span class=nx>chatRoom</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 注册用户到聊天室
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>chatRoom</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>alice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>chatRoom</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>bob</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>chatRoom</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>charlie</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 用户发送消息
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>alice</span><span class=p>.</span><span class=nf>Send</span><span class=p>(</span><span class=s>&#34;Hello, everyone!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>bob</span><span class=p>.</span><span class=nf>Send</span><span class=p>(</span><span class=s>&#34;Hi, Alice!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>charlie</span><span class=p>.</span><span class=nf>Send</span><span class=p>(</span><span class=s>&#34;Hey, Bob!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=观察者模式observer->观察者模式(Observer) ✔</h3><ul><li>它定义了对象之间的一对多依赖关系</li><li>当一个对象(被观察者)的状态发生改变时 所有依赖它的对象(观察者)都会收到通知并自动更新</li><li>观察者模式的核心思想是 解耦被观察者和观察者 使得它们可以独立变化</li></ul><h4 id=优点-9>优点</h4><ul><li>解耦：被观察者和观察者之间是松耦合的 它们可以独立变化</li><li>支持动态注册和移除观察者：可以在运行时动态地注册和移除观察者</li><li>符合开闭原则：新增观察者时 不需要修改被观察者的代码</li></ul><h4 id=示例-13>示例</h4><ul><li>假设我们有一个天气站(被观察者) 当天气数据更新时 通知多个显示设备(观察者)更新显示内容</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义观察者接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Observer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Update</span><span class=p>(</span><span class=nx>temperature</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>humidity</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>pressure</span> <span class=kt>float64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义被观察者接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Subject</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>RemoveObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>NotifyObservers</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体被观察者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WeatherData</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>observers</span>   <span class=p>[]</span><span class=nx>Observer</span>
</span></span><span class=line><span class=cl>    <span class=nx>temperature</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl>    <span class=nx>humidity</span>    <span class=kt>float64</span>
</span></span><span class=line><span class=cl>    <span class=nx>pressure</span>    <span class=kt>float64</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>w</span><span class=p>.</span><span class=nx>observers</span><span class=p>,</span> <span class=nx>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>RemoveObserver</span><span class=p>(</span><span class=nx>o</span> <span class=nx>Observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>observer</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>observer</span> <span class=o>==</span> <span class=nx>o</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>w</span><span class=p>.</span><span class=nx>observers</span><span class=p>[:</span><span class=nx>i</span><span class=p>],</span> <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>NotifyObservers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>observer</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>w</span><span class=p>.</span><span class=nx>observers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>observer</span><span class=p>.</span><span class=nf>Update</span><span class=p>(</span><span class=nx>w</span><span class=p>.</span><span class=nx>temperature</span><span class=p>,</span> <span class=nx>w</span><span class=p>.</span><span class=nx>humidity</span><span class=p>,</span> <span class=nx>w</span><span class=p>.</span><span class=nx>pressure</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WeatherData</span><span class=p>)</span> <span class=nf>SetMeasurements</span><span class=p>(</span><span class=nx>temperature</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>humidity</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>pressure</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>temperature</span> <span class=p>=</span> <span class=nx>temperature</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>humidity</span> <span class=p>=</span> <span class=nx>humidity</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nx>pressure</span> <span class=p>=</span> <span class=nx>pressure</span>
</span></span><span class=line><span class=cl>    <span class=nx>w</span><span class=p>.</span><span class=nf>NotifyObservers</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体观察者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>DisplayDevice</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>DisplayDevice</span><span class=p>)</span> <span class=nf>Update</span><span class=p>(</span><span class=nx>temperature</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>humidity</span> <span class=kt>float64</span><span class=p>,</span> <span class=nx>pressure</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s: Temperature=%.2f, Humidity=%.2f, Pressure=%.2f\n&#34;</span><span class=p>,</span> <span class=nx>d</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>temperature</span><span class=p>,</span> <span class=nx>humidity</span><span class=p>,</span> <span class=nx>pressure</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建被观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>WeatherData</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>display1</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>DisplayDevice</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Display 1&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>display2</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>DisplayDevice</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Display 2&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 注册观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>display1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>RegisterObserver</span><span class=p>(</span><span class=nx>display2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 更新天气数据并通知观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>SetMeasurements</span><span class=p>(</span><span class=mf>25.0</span><span class=p>,</span> <span class=mf>65.0</span><span class=p>,</span> <span class=mf>1013.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>SetMeasurements</span><span class=p>(</span><span class=mf>26.5</span><span class=p>,</span> <span class=mf>70.0</span><span class=p>,</span> <span class=mf>1012.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 移除一个观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>RemoveObserver</span><span class=p>(</span><span class=nx>display1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 再次更新天气数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>weatherData</span><span class=p>.</span><span class=nf>SetMeasurements</span><span class=p>(</span><span class=mf>27.0</span><span class=p>,</span> <span class=mf>68.0</span><span class=p>,</span> <span class=mf>1011.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=命令模式command->命令模式(Command) ✔</h3><ul><li>它将请求封装为一个对象 从而使你可以用不同的请求对客户进行参数化 并且支持请求的排队、记录日志、撤销操作等功能</li></ul><h4 id=核心思想>核心思想</h4><ul><li>将请求封装为对象：将每个请求(如方法调用)封装为一个独立的对象</li><li>解耦请求的发送者和接收者：发送者不需要知道接收者的具体实现 只需要通过命令对象来执行请求</li><li>支持扩展：可以轻松地添加新的命令 而不需要修改现有代码</li></ul><h4 id=示例-14>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义命令接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Command</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体命令 表示打印消息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PrintCommand</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>message</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>PrintCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Executing PrintCommand:&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体命令 表示发送邮件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>EmailCommand</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>to</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>EmailCommand</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Executing EmailCommand: Sending email to %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>to</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Subject: %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>subject</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Body: %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 任务队列 用于存储和执行命令
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TaskQueue</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>commands</span> <span class=p>[]</span><span class=nx>Command</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>tq</span> <span class=o>*</span><span class=nx>TaskQueue</span><span class=p>)</span> <span class=nf>AddCommand</span><span class=p>(</span><span class=nx>cmd</span> <span class=nx>Command</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span><span class=p>,</span> <span class=nx>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>tq</span> <span class=o>*</span><span class=nx>TaskQueue</span><span class=p>)</span> <span class=nf>ProcessCommands</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>cmd</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>cmd</span><span class=p>.</span><span class=nf>Execute</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span> <span class=c1>// 模拟任务执行的时间
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>tq</span><span class=p>.</span><span class=nx>commands</span> <span class=p>=</span> <span class=kc>nil</span> <span class=c1>// 清空任务队列
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建任务队列
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>taskQueue</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>TaskQueue</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加任务到队列
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PrintCommand</span><span class=p>{</span><span class=nx>message</span><span class=p>:</span> <span class=s>&#34;Hello, World!&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>EmailCommand</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>to</span><span class=p>:</span>      <span class=s>&#34;user@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>subject</span><span class=p>:</span> <span class=s>&#34;Welcome&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=p>:</span>    <span class=s>&#34;Thank you for signing up!&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PrintCommand</span><span class=p>{</span><span class=nx>message</span><span class=p>:</span> <span class=s>&#34;Task queue is running...&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 处理任务队列
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Processing task queue:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>ProcessCommands</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加更多任务
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>PrintCommand</span><span class=p>{</span><span class=nx>message</span><span class=p>:</span> <span class=s>&#34;Another task&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>EmailCommand</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>to</span><span class=p>:</span>      <span class=s>&#34;admin@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>subject</span><span class=p>:</span> <span class=s>&#34;Report&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=p>:</span>    <span class=s>&#34;Here is the daily report.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 再次处理任务队列
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;\nProcessing task queue again:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>taskQueue</span><span class=p>.</span><span class=nf>ProcessCommands</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=迭代器模式iterator>迭代器模式(Iterator)</h3><ul><li>它提供了一种方法顺序访问一个聚合对象中的各个元素 而又不需要暴露该对象的内部表示</li><li>迭代器模式的核心思想是将遍历逻辑从聚合对象中分离出来 使得聚合对象和遍历逻辑可以独立变化</li></ul><h4 id=适用场景-7>适用场景</h4><ul><li>集合类库：如Go的 slice、map 等集合类型 可以通过迭代器模式提供统一的遍历接口</li><li>数据库查询结果：数据库查询结果可以封装为一个聚合对象 并提供迭代器遍历查询结果</li><li>文件系统遍历：文件系统中的目录和文件可以封装为一个聚合对象 并提供迭代器遍历文件系统</li><li>树形结构遍历：树形结构(如二叉树、多叉树)可以提供多种遍历方式(如深度优先、广度优先)</li></ul><h4 id=示例-15>示例</h4><ul><li>假设我们有一个集合类BookCollection 它包含多本书</li><li>我们需要实现一个迭代器 用于遍历这个集合</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义书籍结构体
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Book</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Title</span>  <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Author</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义迭代器接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Iterator</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>HasNext</span><span class=p>()</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>    <span class=nf>Next</span><span class=p>()</span> <span class=o>*</span><span class=nx>Book</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体迭代器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>BookIterator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>books</span>    <span class=p>[]</span><span class=o>*</span><span class=nx>Book</span>
</span></span><span class=line><span class=cl>    <span class=nx>position</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>BookIterator</span><span class=p>)</span> <span class=nf>HasNext</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>b</span><span class=p>.</span><span class=nx>position</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>b</span><span class=p>.</span><span class=nx>books</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>BookIterator</span><span class=p>)</span> <span class=nf>Next</span><span class=p>()</span> <span class=o>*</span><span class=nx>Book</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nf>HasNext</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>book</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>books</span><span class=p>[</span><span class=nx>b</span><span class=p>.</span><span class=nx>position</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nx>position</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>book</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义聚合接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Aggregate</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateIterator</span><span class=p>()</span> <span class=nx>Iterator</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体聚合
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>BookCollection</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>books</span> <span class=p>[]</span><span class=o>*</span><span class=nx>Book</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>BookCollection</span><span class=p>)</span> <span class=nf>CreateIterator</span><span class=p>()</span> <span class=nx>Iterator</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>BookIterator</span><span class=p>{</span><span class=nx>books</span><span class=p>:</span> <span class=nx>b</span><span class=p>.</span><span class=nx>books</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建书籍集合
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>collection</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>BookCollection</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>books</span><span class=p>:</span> <span class=p>[]</span><span class=o>*</span><span class=nx>Book</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>Title</span><span class=p>:</span> <span class=s>&#34;The Go Programming Language&#34;</span><span class=p>,</span> <span class=nx>Author</span><span class=p>:</span> <span class=s>&#34;Alan A. A. Donovan&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>Title</span><span class=p>:</span> <span class=s>&#34;Design Patterns&#34;</span><span class=p>,</span> <span class=nx>Author</span><span class=p>:</span> <span class=s>&#34;Erich Gamma&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>Title</span><span class=p>:</span> <span class=s>&#34;Clean Code&#34;</span><span class=p>,</span> <span class=nx>Author</span><span class=p>:</span> <span class=s>&#34;Robert C. Martin&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建迭代器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>iterator</span> <span class=o>:=</span> <span class=nx>collection</span><span class=p>.</span><span class=nf>CreateIterator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 遍历集合
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=nx>iterator</span><span class=p>.</span><span class=nf>HasNext</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>book</span> <span class=o>:=</span> <span class=nx>iterator</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Title: %s, Author: %s\n&#34;</span><span class=p>,</span> <span class=nx>book</span><span class=p>.</span><span class=nx>Title</span><span class=p>,</span> <span class=nx>book</span><span class=p>.</span><span class=nx>Author</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=模板方法模式template-method->模板方法模式(Template Method) ✔</h3><ul><li>它定义了一个算法的骨架 并将某些步骤延迟到子类中实现</li><li>模板方法模式的核心思想是 将算法的通用部分放在父类中 而将可变部分交给子类实现</li><li>通过模板方法模式 可以避免代码重复 并确保算法的结构不变</li></ul><h4 id=适用场景-8>适用场景</h4><ul><li><code>框架设计</code> 如Web框架中的请求处理流程(初始化、处理请求、返回响应等)</li><li><code>工作流引擎</code> 如订单处理流程(创建订单、支付订单、发货订单等)</li><li><code>测试框架</code> 如测试用例的执行流程(初始化、执行测试、清理资源等)</li><li><code>游戏开发</code> 如游戏角色的行为流程(移动、攻击、防御等)</li></ul><h4 id=优点-10>优点</h4><ul><li><code>代码复用</code> 将算法的通用部分放在父类中 避免了代码重复</li><li><code>扩展性</code> 新增子类时 只需要实现抽象方法 而不需要修改父类的代码</li><li><code>控制算法结构</code> 父类控制算法的结构 确保算法的步骤不会被子类改变</li></ul><h4 id=示例-16>示例</h4><ul><li>假设我们有一个饮料制作系统 支持制作咖啡和茶</li><li>咖啡和茶的制作过程有一些共同的步骤(如烧水、倒入杯子) 也有一些不同的步骤(如冲泡咖啡、泡茶)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 抽象类，定义饮料制作的模板方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Beverage</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>BoilWater</span><span class=p>()</span>           <span class=c1>// 烧水
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>Brew</span><span class=p>()</span>                <span class=c1>// 冲泡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>PourInCup</span><span class=p>()</span>           <span class=c1>// 倒入杯子
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>AddCondiments</span><span class=p>()</span>       <span class=c1>// 添加调料
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>WantCondiments</span><span class=p>()</span> <span class=kt>bool</span> <span class=c1>// 是否添加调料（钩子方法）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 模板方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>MakeBeverage</span><span class=p>(</span><span class=nx>b</span> <span class=nx>Beverage</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>BoilWater</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>Brew</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=p>.</span><span class=nf>PourInCup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>b</span><span class=p>.</span><span class=nf>WantCondiments</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span><span class=p>.</span><span class=nf>AddCondiments</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体类：咖啡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Coffee</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>BoilWater</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Boiling water&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>Brew</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Brewing coffee&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>PourInCup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Pouring coffee into cup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>AddCondiments</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Adding sugar and milk&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Coffee</span><span class=p>)</span> <span class=nf>WantCondiments</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体类：茶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Tea</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>BoilWater</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Boiling water&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>Brew</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Steeping tea&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>PourInCup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Pouring tea into cup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>AddCondiments</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Adding lemon&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Tea</span><span class=p>)</span> <span class=nf>WantCondiments</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 制作咖啡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Making coffee:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>coffee</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Coffee</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nf>MakeBeverage</span><span class=p>(</span><span class=nx>coffee</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 制作茶
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;\nMaking tea:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>tea</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Tea</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nf>MakeBeverage</span><span class=p>(</span><span class=nx>tea</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=策略模式strategy->策略模式(Strategy) ✔</h3><ul><li>它定义了一系列算法 并将每个算法封装起来 使它们可以互相替换</li><li>策略模式的核心思想是将算法的使用与算法的实现分离 从而使得算法可以独立于客户端而变化</li><li>通过策略模式 可以在运行时动态地选择算法 而不需要修改客户端代码</li></ul><h4 id=适用场景-9>适用场景</h4><ul><li>支付系统：如示例所示 支持多种支付方式</li><li>排序算法：支持多种排序算法(如快速排序、归并排序、冒泡排序等)</li><li>压缩算法：支持多种压缩算法(如ZIP、RAR、7z等)</li><li>路由算法：支持多种路由算法(如最短路径、最快路径、最少收费路径等)</li></ul><h4 id=优点-11>优点</h4><ul><li>解耦：将算法的使用与算法的实现分离 使得算法可以独立于客户端而变化</li><li>易于扩展：新增算法时 只需要添加新的策略类 而不需要修改现有代码</li><li>动态选择算法：可以在运行时动态地选择算法 而不需要修改客户端代码</li></ul><h4 id=示例-17>示例</h4><ul><li>假设我们有一个支付系统 支持多种支付方式(如信用卡支付、支付宝支付、微信支付等) 我们可以使用策略模式来实现支付方式的选择</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义策略接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PaymentStrategy</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体策略：信用卡支付
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>CreditCardPayment</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>CreditCardPayment</span><span class=p>)</span> <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Paying %.2f using Credit Card\n&#34;</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体策略：支付宝支付
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>AlipayPayment</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>AlipayPayment</span><span class=p>)</span> <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Paying %.2f using Alipay\n&#34;</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体策略：微信支付
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>WechatPayment</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=o>*</span><span class=nx>WechatPayment</span><span class=p>)</span> <span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Paying %.2f using Wechat Pay\n&#34;</span><span class=p>,</span> <span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 上下文
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PaymentContext</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>strategy</span> <span class=nx>PaymentStrategy</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PaymentContext</span><span class=p>)</span> <span class=nf>SetStrategy</span><span class=p>(</span><span class=nx>strategy</span> <span class=nx>PaymentStrategy</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>strategy</span> <span class=p>=</span> <span class=nx>strategy</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PaymentContext</span><span class=p>)</span> <span class=nf>ExecutePayment</span><span class=p>(</span><span class=nx>amount</span> <span class=kt>float64</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>strategy</span><span class=p>.</span><span class=nf>Pay</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建上下文
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>PaymentContext</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用信用卡支付
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetStrategy</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>CreditCardPayment</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>ExecutePayment</span><span class=p>(</span><span class=mf>100.0</span><span class=p>)</span> <span class=c1>// 输出: Paying 100.00 using Credit Card
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用支付宝支付
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetStrategy</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>AlipayPayment</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>ExecutePayment</span><span class=p>(</span><span class=mf>200.0</span><span class=p>)</span> <span class=c1>// 输出: Paying 200.00 using Alipay
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用微信支付
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetStrategy</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>WechatPayment</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>ExecutePayment</span><span class=p>(</span><span class=mf>300.0</span><span class=p>)</span> <span class=c1>// 输出: Paying 300.00 using Wechat Pay
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=状态模式state>状态模式(State)</h3><ul><li>它允许对象在其内部状态改变时改变其行为</li><li>状态模式的核心思想是将对象的状态封装成独立的类 并将对象的行为委托给当前状态对象</li><li>通过状态模式 可以将复杂的条件逻辑分散到多个状态类中 从而使得代码更加清晰和易于维护</li></ul><h4 id=优点-12>优点</h4><ul><li>清晰的状态转换逻辑：将状态转换逻辑分散到各个状态类中 避免了复杂的条件语句</li><li>符合开闭原则：新增状态时 只需要添加新的状态类 而不需要修改现有代码</li><li>易于扩展：可以轻松地添加新的状态和行为</li></ul><h4 id=示例-18>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义状态接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>State</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>context</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 上下文
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Context</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span> <span class=nx>State</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>SetState</span><span class=p>(</span><span class=nx>state</span> <span class=nx>State</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>state</span> <span class=p>=</span> <span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>PressSwitch</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体状态：开
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>OnState</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>OnState</span><span class=p>)</span> <span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>context</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Turning the light off...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>OffState</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体状态：关
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>OffState</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>OffState</span><span class=p>)</span> <span class=nf>PressSwitch</span><span class=p>(</span><span class=nx>context</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Turning the light on...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>context</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>OnState</span><span class=p>{})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建上下文并设置初始状态
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Context</span><span class=p>{</span><span class=nx>state</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>OffState</span><span class=p>{}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 按下开关
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>()</span> <span class=c1>// 输出: Turning the light on...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>()</span> <span class=c1>// 输出: Turning the light off...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>context</span><span class=p>.</span><span class=nf>PressSwitch</span><span class=p>()</span> <span class=c1>// 输出: Turning the light on...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=备忘录模式memento>备忘录模式(Memento)</h3><ul><li>它允许在不破坏封装性的前提下 捕获并外部化一个对象的内部状态 以便稍后可以将该对象恢复到之前的状态</li><li>备忘录模式的核心思想是 将对象的状态保存到一个备忘录对象中 并在需要时从备忘录中恢复状态</li></ul><h4 id=优点-13>优点</h4><ul><li>这种方式非常适合需要支持撤销操作或状态管理的场景</li><li>比如文本编辑器、游戏存档、事务回滚等</li><li>在Go语言中 备忘录模式可以通过接口和结构体的组合来实现 代码简洁且易于扩展</li></ul><h4 id=示例-19>示例</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义备忘录接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Memento</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>GetState</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体备忘录
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TextMemento</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TextMemento</span><span class=p>)</span> <span class=nf>GetState</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>t</span><span class=p>.</span><span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 原发器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Originator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>SetState</span><span class=p>(</span><span class=nx>state</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>o</span><span class=p>.</span><span class=nx>state</span> <span class=p>=</span> <span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>GetState</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>o</span><span class=p>.</span><span class=nx>state</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>CreateMemento</span><span class=p>()</span> <span class=nx>Memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>TextMemento</span><span class=p>{</span><span class=nx>state</span><span class=p>:</span> <span class=nx>o</span><span class=p>.</span><span class=nx>state</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Originator</span><span class=p>)</span> <span class=nf>RestoreMemento</span><span class=p>(</span><span class=nx>m</span> <span class=nx>Memento</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>o</span><span class=p>.</span><span class=nx>state</span> <span class=p>=</span> <span class=nx>m</span><span class=p>.</span><span class=nf>GetState</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 管理者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Caretaker</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mementos</span> <span class=p>[]</span><span class=nx>Memento</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Caretaker</span><span class=p>)</span> <span class=nf>AddMemento</span><span class=p>(</span><span class=nx>m</span> <span class=nx>Memento</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span><span class=p>,</span> <span class=nx>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Caretaker</span><span class=p>)</span> <span class=nf>GetMemento</span><span class=p>(</span><span class=nx>index</span> <span class=kt>int</span><span class=p>)</span> <span class=nx>Memento</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>index</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>c</span><span class=p>.</span><span class=nx>mementos</span><span class=p>[</span><span class=nx>index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建原发器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>editor</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Originator</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建管理者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>caretaker</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Caretaker</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 编辑文本并保存状态
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>editor</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=s>&#34;State 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>caretaker</span><span class=p>.</span><span class=nf>AddMemento</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>CreateMemento</span><span class=p>())</span> <span class=c1>// 创建一个备忘录对象，保存当前状态。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>editor</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=s>&#34;State 2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>caretaker</span><span class=p>.</span><span class=nf>AddMemento</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>CreateMemento</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>editor</span><span class=p>.</span><span class=nf>SetState</span><span class=p>(</span><span class=s>&#34;State 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>caretaker</span><span class=p>.</span><span class=nf>AddMemento</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>CreateMemento</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>editor</span><span class=p>.</span><span class=nf>GetState</span><span class=p>())</span> <span class=c1>// 这个时候的状态已经是  State 3
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// 恢复到之前的状态
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>editor</span><span class=p>.</span><span class=nf>RestoreMemento</span><span class=p>(</span><span class=nx>caretaker</span><span class=p>.</span><span class=nf>GetMemento</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Restored State:&#34;</span><span class=p>,</span> <span class=nx>editor</span><span class=p>.</span><span class=nf>GetState</span><span class=p>())</span> <span class=c1>// 输出: Restored State: State 2
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nx>editor</span><span class=p>.</span><span class=nf>RestoreMemento</span><span class=p>(</span><span class=nx>caretaker</span><span class=p>.</span><span class=nf>GetMemento</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Restored State:&#34;</span><span class=p>,</span> <span class=nx>editor</span><span class=p>.</span><span class=nf>GetState</span><span class=p>())</span> <span class=c1>// 输出: Restored State: State 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=解释器模式interpreter>解释器模式(Interpreter)</h3><ul><li>它定义了一种语言的语法表示 并提供了一个解释器来解释这种语法</li><li>解释器模式通常用于处理类似编程语言、查询语言、规则引擎等场景</li><li>核心思想<ul><li>定义语法规则：将语言的语法规则表示为一个抽象语法树(AST)</li><li>解释执行：通过解释器遍历抽象语法树 执行相应的操作</li></ul></li></ul><h4 id=抽象语法树>抽象语法树</h4><ul><li>抽象语法树(Abstract Syntax Tree-AST)是编译器和解释器中的一个核心概念</li><li>它是一种树形数据结构 用于表示源代码的语法结构</li><li>AST 之所以被称为<code>抽象语法树</code> 是因为它抽象掉了源代码中的一些具体细节 只保留了程序的逻辑结构</li><li>为什么叫 抽象语法树<ul><li>抽象(Abstract)<ul><li>AST 并不包含源代码中的所有细节 比如括号、分号、空格等 它只关注程序的逻辑结构</li><li>例如 表达式 2 * (3 + 4) 的<code>AST</code>会抽象掉括号 只保留运算符和操作数的层次关系</li></ul></li><li>语法(Syntax)<ul><li>AST 表示的是源代码的语法结构 而不是语义(即程序的含义)</li><li>例如 AST 可以表示一个<code>if</code>语句的语法结构 但不会解释<code>if</code>语句的具体行为</li></ul></li><li>树(Tree)<ul><li>AST是一种树形数据结构 每个节点表示一个语法结构(如表达式、语句、函数等)</li><li>树的层次结构反映了源代码的嵌套关系</li></ul></li></ul></li><li>比如：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>if</span> <span class=nx>x</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nx>Positive</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nx>Non</span><span class=o>-</span><span class=nx>positive</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>对应的AST如下:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IfStatement
</span></span><span class=line><span class=cl>├── Condition: BinaryExpression
</span></span><span class=line><span class=cl>│   ├── Left: Identifier <span class=o>(</span>x<span class=o>)</span>
</span></span><span class=line><span class=cl>│   ├── Operator: &gt;
</span></span><span class=line><span class=cl>│   └── Right: Number <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>├── ThenBlock: BlockStatement
</span></span><span class=line><span class=cl>│   └── Expression: CallExpression
</span></span><span class=line><span class=cl>│       ├── Function: Identifier <span class=o>(</span>print<span class=o>)</span>
</span></span><span class=line><span class=cl>│       └── Arguments: StringLiteral <span class=o>(</span><span class=s2>&#34;Positive&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>└── ElseBlock: BlockStatement
</span></span><span class=line><span class=cl>    └── Expression: CallExpression
</span></span><span class=line><span class=cl>        ├── Function: Identifier <span class=o>(</span>print<span class=o>)</span>
</span></span><span class=line><span class=cl>        └── Arguments: StringLiteral <span class=o>(</span><span class=s2>&#34;Non-positive&#34;</span><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=适用场景-10>适用场景</h4><ul><li>数据库查询引擎：如 MySQL、PostgreSQL 等数据库的查询解析和执行</li><li>规则引擎：如业务规则引擎 用于解析和执行规则</li><li>模板引擎：如Go的<code>text/template</code>用于解析和执行模板</li><li>数学表达式计算：如计算器应用程序 用于解析和计算数学表达式</li></ul><h4 id=示例-20>示例</h4><ul><li>以Go语言里面的模板字符串为例</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;text/template&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义模板字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>const</span> <span class=nx>tmpl</span> <span class=p>=</span> <span class=s>`Hello, </span><span class=cp>{{</span><span class=na>.Name</span><span class=cp>}}</span><span class=s>! You are </span><span class=cp>{{</span><span class=na>.Age</span><span class=cp>}}</span><span class=s> years old.`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 解析模板
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>t</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;example&#34;</span><span class=p>).</span><span class=nf>Parse</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>data</span> <span class=o>:=</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=nx>Age</span>  <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=p>}{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span> <span class=nx>Age</span><span class=p>:</span> <span class=mi>25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 执行模板并输出结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>err</span> <span class=p>=</span> <span class=nx>t</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>这个是解释器模式的应用 我们需要了解内部的原理 然后自己手搓一个这样的模板字符串解析器出来</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义上下文 存储模板数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Context</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Data</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义抽象表达式接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Expression</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 是文本表达式 表示普通文本
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>TextExpression</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>text</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>TextExpression</span><span class=p>)</span> <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>t</span><span class=p>.</span><span class=nx>text</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 是变量表达式 表示变量替换
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>VariableExpression</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>key</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=o>*</span><span class=nx>VariableExpression</span><span class=p>)</span> <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>value</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>Data</span><span class=p>[</span><span class=nx>v</span><span class=p>.</span><span class=nx>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%v&#34;</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 是模板 包含多个表达式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Template</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>expressions</span> <span class=p>[]</span><span class=nx>Expression</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Template</span><span class=p>)</span> <span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=nx>strings</span><span class=p>.</span><span class=nx>Builder</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>expr</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>t</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span><span class=p>.</span><span class=nf>WriteString</span><span class=p>(</span><span class=nx>expr</span><span class=p>.</span><span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>result</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 解析模板字符串并构建抽象语法树
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseTemplate</span><span class=p>(</span><span class=nx>tmpl</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>Template</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>template</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Template</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>start</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 查找变量表达式的起始位置
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>startVar</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Index</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=p>:],</span> <span class=s>&#34;{{&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>startVar</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 如果没有变量表达式，剩下的都是普通文本
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>TextExpression</span><span class=p>{</span><span class=nx>text</span><span class=p>:</span> <span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=p>:]})</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 添加普通文本
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>TextExpression</span><span class=p>{</span><span class=nx>text</span><span class=p>:</span> <span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span> <span class=p>:</span> <span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=p>]})</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 查找变量表达式的结束位置
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>endVar</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Index</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=p>:],</span> <span class=s>&#34;}}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>endVar</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 如果没有结束符，直接退出
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 解析变量表达式
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>key</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>TrimSpace</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>[</span><span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=o>+</span><span class=mi>2</span> <span class=p>:</span> <span class=nx>start</span><span class=o>+</span><span class=nx>startVar</span><span class=o>+</span><span class=nx>endVar</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>template</span><span class=p>.</span><span class=nx>expressions</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>VariableExpression</span><span class=p>{</span><span class=nx>key</span><span class=p>:</span> <span class=nx>key</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 更新起始位置
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>start</span> <span class=p>=</span> <span class=nx>start</span> <span class=o>+</span> <span class=nx>startVar</span> <span class=o>+</span> <span class=nx>endVar</span> <span class=o>+</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>template</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义模板字符串
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>tmpl</span> <span class=o>:=</span> <span class=s>&#34;Hello, {{Name}}! You are {{Age}} years old.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 解析模板并构建抽象语法树
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>template</span> <span class=o>:=</span> <span class=nf>ParseTemplate</span><span class=p>(</span><span class=nx>tmpl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 定义上下文数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ctx</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Context</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Data</span><span class=p>:</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>interface</span><span class=p>{}{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Name&#34;</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Age&#34;</span><span class=p>:</span>  <span class=mi>25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 解释执行模板并输出结果
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>result</span> <span class=o>:=</span> <span class=nx>template</span><span class=p>.</span><span class=nf>Interpret</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>result</span><span class=p>)</span> <span class=c1>// 输出: Hello, Alice! You are 25 years old.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=职责链模式chain-of-responsibility>职责链模式(Chain of Responsibility)</h3><ul><li>是一种行为设计模式 它允许多个对象有机会处理请求 从而避免请求的发送者与接收者之间的耦合</li><li>责任链模式将这些对象连成一条链 并沿着这条链传递请求 直到有对象处理它为止</li></ul><h4 id=核心思想-1>核心思想</h4><ul><li>解耦请求发送者和接收者：请求的发送者不需要知道具体由哪个对象处理请求 只需要将请求发送到链上即可</li><li>动态组合处理逻辑：可以动态地组合处理者 灵活地调整处理顺序或增加新的处理者</li><li>每个处理者只关心自己的职责：每个处理者只处理自己能处理的请求 不能处理的请求会传递给下一个处理者</li></ul><h4 id=适用场景-11>适用场景</h4><ul><li>当一个请求需要经过多个对象处理 但具体由哪个对象处理不确定时</li><li>当需要动态指定处理请求的对象时</li><li>当希望避免请求发送者与接收者之间的紧密耦合时</li><li>实际应用场景<ul><li>中间件</li><li>审批流程</li></ul></li></ul><h4 id=示例-21>示例</h4><ul><li>实现一下gin的中间件功能 中间件自己可以处理请求 可以拦截 可以放行</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 模拟Gin的上下文
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Context</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Request</span>  <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span>
</span></span><span class=line><span class=cl>    <span class=nx>Writer</span>   <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span>
</span></span><span class=line><span class=cl>    <span class=nx>handlers</span> <span class=p>[]</span><span class=nx>HandlerFunc</span> <span class=c1>// 责任链中的处理函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>index</span>    <span class=kt>int</span>           <span class=c1>// 当前执行的处理函数索引
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义处理函数类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HandlerFunc</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 调用责任链中的下一个处理函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>Next</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>index</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>c</span><span class=p>.</span><span class=nx>index</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>handlers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>handlers</span><span class=p>[</span><span class=nx>c</span><span class=p>.</span><span class=nx>index</span><span class=p>](</span><span class=nx>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 终止责任链的执行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=nf>Abort</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>index</span> <span class=p>=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>handlers</span><span class=p>)</span> <span class=c1>// 直接跳到末尾 不再执行后续处理函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 模拟Gin的引擎
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Engine</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>handlers</span> <span class=p>[]</span><span class=nx>HandlerFunc</span> <span class=c1>// 全局中间件和责任链
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 添加中间件到责任链
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>Use</span><span class=p>(</span><span class=nx>middleware</span> <span class=nx>HandlerFunc</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>e</span><span class=p>.</span><span class=nx>handlers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>handlers</span><span class=p>,</span> <span class=nx>middleware</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 实现http.Handler接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>ServeHTTP</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Context</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Request</span><span class=p>:</span>  <span class=nx>r</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Writer</span><span class=p>:</span>   <span class=nx>w</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>handlers</span><span class=p>:</span> <span class=nx>e</span><span class=p>.</span><span class=nx>handlers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>index</span><span class=p>:</span>    <span class=o>-</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// 开始执行责任链
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 示例中间件 1：日志记录
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>LoggingMiddleware</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Request: %s %s\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Method</span><span class=p>,</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>URL</span><span class=p>.</span><span class=nx>Path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// 传递给下一个中间件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 示例中间件 2：认证检查
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>AuthMiddleware</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>token</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>token</span> <span class=o>!=</span> <span class=s>&#34;valid-token&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusUnauthorized</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Unauthorized&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span> <span class=c1>// 终止责任链
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// 传递给下一个中间件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 示例中间件 3：请求处理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>HelloHandler</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;Hello, World!&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建引擎
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>engine</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Engine</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加中间件到责任链
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>engine</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>LoggingMiddleware</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>engine</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>AuthMiddleware</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>engine</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span><span class=nx>HelloHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 启动 HTTP 服务器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Server is running on :9090&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:9090&#34;</span><span class=p>,</span> <span class=nx>engine</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=访问者模式visitor>访问者模式(Visitor)</h3><ul><li>它允许你将算法与对象结构分离</li><li>访问者模式的核心思想是 将操作(算法)从对象结构中分离出来 使得可以在不修改对象结构的情况下定义新的操作</li><li>通过访问者模式 可以将对象结构的元素与作用于这些元素的操作解耦 从而使得操作可以独立变化</li></ul><h4 id=优点-14>优点</h4><ul><li>解耦：将操作与对象结构分离 使得操作可以独立变化</li><li>扩展性：新增操作时 只需要添加新的访问者 而不需要修改对象结构。</li><li>符合开闭原则：对象结构对扩展开放 对修改关闭</li></ul><h4 id=示例-22>示例</h4><ul><li>假设我们有一个文档对象模型(DOM) 包含多种元素(如文本、图片、表格等) 我们需要对这些元素进行不同的操作(如导出为PDF、导出为HTML等)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义访问者接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Visitor</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>VisitText</span><span class=p>(</span><span class=nx>text</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>VisitImage</span><span class=p>(</span><span class=nx>image</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>VisitTable</span><span class=p>(</span><span class=nx>table</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 定义元素接口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Element</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体元素：文本
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Text</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>visitor</span><span class=p>.</span><span class=nf>VisitText</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体元素：图片
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Image</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>src</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>i</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>visitor</span><span class=p>.</span><span class=nf>VisitImage</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体元素：表格
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Table</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>rows</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>cols</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>visitor</span><span class=p>.</span><span class=nf>VisitTable</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体访问者：导出为 PDF
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>PDFExportVisitor</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PDFExportVisitor</span><span class=p>)</span> <span class=nf>VisitText</span><span class=p>(</span><span class=nx>text</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting text to PDF: %s\n&#34;</span><span class=p>,</span> <span class=nx>text</span><span class=p>.</span><span class=nx>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PDFExportVisitor</span><span class=p>)</span> <span class=nf>VisitImage</span><span class=p>(</span><span class=nx>image</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting image to PDF: %s\n&#34;</span><span class=p>,</span> <span class=nx>image</span><span class=p>.</span><span class=nx>src</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>PDFExportVisitor</span><span class=p>)</span> <span class=nf>VisitTable</span><span class=p>(</span><span class=nx>table</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting table to PDF: %d rows, %d cols\n&#34;</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>rows</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>cols</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 具体访问者：导出为 HTML
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>HTMLExportVisitor</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HTMLExportVisitor</span><span class=p>)</span> <span class=nf>VisitText</span><span class=p>(</span><span class=nx>text</span> <span class=o>*</span><span class=nx>Text</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting text to HTML: %s\n&#34;</span><span class=p>,</span> <span class=nx>text</span><span class=p>.</span><span class=nx>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HTMLExportVisitor</span><span class=p>)</span> <span class=nf>VisitImage</span><span class=p>(</span><span class=nx>image</span> <span class=o>*</span><span class=nx>Image</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting image to HTML: %s\n&#34;</span><span class=p>,</span> <span class=nx>image</span><span class=p>.</span><span class=nx>src</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>HTMLExportVisitor</span><span class=p>)</span> <span class=nf>VisitTable</span><span class=p>(</span><span class=nx>table</span> <span class=o>*</span><span class=nx>Table</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Exporting table to HTML: %d rows, %d cols\n&#34;</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>rows</span><span class=p>,</span> <span class=nx>table</span><span class=p>.</span><span class=nx>cols</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 是对象结构
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Document</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>elements</span> <span class=p>[]</span><span class=nx>Element</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>Document</span><span class=p>)</span> <span class=nf>AddElement</span><span class=p>(</span><span class=nx>element</span> <span class=nx>Element</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=p>.</span><span class=nx>elements</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>d</span><span class=p>.</span><span class=nx>elements</span><span class=p>,</span> <span class=nx>element</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>d</span> <span class=o>*</span><span class=nx>Document</span><span class=p>)</span> <span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span> <span class=nx>Visitor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>element</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>d</span><span class=p>.</span><span class=nx>elements</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>element</span><span class=p>.</span><span class=nf>Accept</span><span class=p>(</span><span class=nx>visitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建文档对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>document</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Document</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加元素
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>document</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>Text</span><span class=p>{</span><span class=nx>content</span><span class=p>:</span> <span class=s>&#34;Hello, World!&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>Image</span><span class=p>{</span><span class=nx>src</span><span class=p>:</span> <span class=s>&#34;image.png&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>AddElement</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>Table</span><span class=p>{</span><span class=nx>rows</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>cols</span><span class=p>:</span> <span class=mi>2</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 创建访问者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>pdfVisitor</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>PDFExportVisitor</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>htmlVisitor</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>HTMLExportVisitor</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 导出为 PDF
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Exporting to PDF:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>Accept</span><span class=p>(</span><span class=nx>pdfVisitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 导出为 HTML
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;\nExporting to HTML:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>document</span><span class=p>.</span><span class=nf>Accept</span><span class=p>(</span><span class=nx>htmlVisitor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=其余常用模式>其余常用模式</h2><ul><li>除开23种标准模式及简单工厂模式之外的常用设计模式</li></ul><h3 id=对象池模式object-pool-pattern->对象池模式(Object Pool Pattern) ✔</h3><ul><li>创建型模式</li><li>对象池创建设计模式用于根据需求预期准备和保留多个实例</li></ul><h4 id=实现>实现</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>pool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Pool</span> <span class=kd>chan</span> <span class=o>*</span><span class=nx>Object</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>total</span> <span class=kt>int</span><span class=p>)</span> <span class=o>*</span><span class=nx>Pool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=nx>Pool</span><span class=p>,</span> <span class=nx>total</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span><span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>total</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>p</span> <span class=o>&lt;-</span> <span class=nb>new</span><span class=p>(</span><span class=nx>Object</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>p</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=用法>用法</h4><ul><li>下面给出了一个关于对象池的简单生命周期示例</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>p</span> <span class=o>:=</span> <span class=nx>pool</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nx>obj</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>p</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>obj</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span> <span class=cm>/*...*/</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>p</span> <span class=o>&lt;-</span> <span class=nx>obj</span>
</span></span><span class=line><span class=cl><span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// No more objects left — retry later or fail
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=经验法则>经验法则</h4><ul><li>对象池模式在对象初始化比对象维护成本更高的情况下非常有用</li><li>如果需求出现峰值 而不是稳定需求 则维护开销可能会超过对象池的优势</li><li>由于对象是预先初始化的 因此它对性能有积极影响</li></ul><h3 id=性能分析模式profiling-patterns>性能分析模式(Profiling Patterns)</h3><h4 id=timing-functions>Timing Functions</h4><ul><li>包装函数并记录执行</li><li>在优化代码时 通常需要快速简单的时间测量 以此来验证假设 而不是使用profiler工具/框架</li><li>可以使用<code>time</code>包和<code>defer</code>语句执行时间测量</li></ul><h4 id=用法-1>用法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// profile.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>profile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 计算函数执行的持续时间
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Duration</span><span class=p>(</span><span class=nx>invocation</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>,</span> <span class=nx>name</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>elapsed</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Since</span><span class=p>(</span><span class=nx>invocation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%s lasted %s&#34;</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>elapsed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// main.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;package/profile&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Func1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Arguments to a defer statement is immediately evaluated and stored.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// The deferred function receives the pre-evaluated values when its invoked.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// time.Now() 会立即执行并存储 即传入的是该函数的开始执行时间
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>defer</span> <span class=nx>profile</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span> <span class=s>&#34;Func1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Func2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>profile</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span> <span class=s>&#34;Func2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>3</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>Func1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nf>Func2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>输出示例:
</span></span></span><span class=line><span class=cl><span class=cm>2025/04/02 12:54:16 Func1 lasted 5.0131114s
</span></span></span><span class=line><span class=cl><span class=cm>2025/04/02 12:54:19 Func2 lasted 3.0020849s
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=function-options>Function Options</h3><p><a class=link href=https://ilolicon.github.io/p/go-functional-options/ target=_blank rel=noopener>函数选项模式</a></p><h3 id=circuit-breaker>Circuit-Breaker</h3><p><a class=link href=https://github.com/sony/gobreaker target=_blank rel=noopener>断路器模式</a></p><h2 id=参考文档>参考文档</h2><p><a class=link href=http://marcio.io/2015/07/singleton-pattern-in-go/ target=_blank rel=noopener>singleton-pattern-in-go</a></p><p><a class=link href=https://www.fengfengzhidao.com/article/JI33Q5QB8lppN5cbFPQR target=_blank rel=noopener>Go24种设计模式</a></p><p><a class=link href=https://github.com/tmrts/go-patterns.git target=_blank rel=noopener>go-patterns</a></p><p><a class=link href=https://github.com/senghoo/golang-design-pattern.git target=_blank rel=noopener>golang-design-pattern</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/go%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F/>Go编程模式</a>
<a href=/tags/golang/>Golang</a>
<a href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/go-functional-options/><div class=article-details><h2 class=article-title>GO FUNCTIONAL OPTIONS</h2></div></a></article><article><a href=/p/go-generics/><div class=article-details><h2 class=article-title>GO Generics</h2></div></a></article><article><a href=/p/golang/><div class=article-details><h2 class=article-title>Golang</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=ilolicon/ilolicon.github.io issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2025 ilolicon's Blog</section><section class=powerby>Vicissitude🐳<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>