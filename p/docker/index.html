<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Docker is a platform designed to help developers build, share, and run modern applications. We handle the tedious setup, so you can focus on the code."><title>Docker</title><link rel=canonical href=https://ilolicon.github.io/p/docker/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Docker"><meta property="og:description" content="Docker is a platform designed to help developers build, share, and run modern applications. We handle the tedious setup, so you can focus on the code."><meta property="og:url" content="https://ilolicon.github.io/p/docker/"><meta property="og:site_name" content="ilolicon's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Cloud Native"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Dockerfile"><meta property="article:tag" content="Container"><meta property="article:published_time" content="2020-06-12T12:10:00+08:00"><meta property="article:modified_time" content="2020-06-12T12:10:00+08:00"><meta name=twitter:title content="Docker"><meta name=twitter:description content="Docker is a platform designed to help developers build, share, and run modern applications. We handle the tedious setup, so you can focus on the code."><link rel="shortcut icon" href=/img/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu96a5ab8e0364e843af4687201b687892_162934_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>ilolicon's Blog</a></h1><h2 class=site-description>Keep Calm and Carry On.</h2></div></header><ol class=social-menu><li><a href=https://github.com/ilolicon target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ä¸»æœºçº§è™šæ‹ŸåŒ–>ä¸»æœºçº§è™šæ‹ŸåŒ–</a><ol><li><a href=#type1>Type1</a></li><li><a href=#type2>Type2</a></li></ol></li><li><a href=#å®¹å™¨çº§è™šæ‹ŸåŒ–>å®¹å™¨çº§è™šæ‹ŸåŒ–</a><ol><li><a href=#namespace>Namespace</a></li><li><a href=#control-groups>Control Groups</a></li><li><a href=#lxc>LXC</a></li><li><a href=#å®¹å™¨ç¼–æ’>å®¹å™¨ç¼–æ’</a></li></ol></li><li><a href=#docker>Docker</a><ol><li><a href=#oci>OCI</a></li><li><a href=#runc>runC</a></li><li><a href=#docker-architecture>docker architecture</a></li><li><a href=#docker-objects>docker objects</a><ol><li><a href=#images>Images</a></li><li><a href=#containers>Containers</a></li></ol></li><li><a href=#docker-install>docker install</a><ol><li><a href=#docker-cerepo>docker-ce.repo</a></li><li><a href=#é•œåƒåŠ é€Ÿ>é•œåƒåŠ é€Ÿ</a></li></ol></li><li><a href=#docker-cli>docker cli</a></li><li><a href=#docker-event-state>docker event state</a></li><li><a href=#docker-image>docker image</a><ol><li><a href=#docker-image-layer>docker image layer</a></li><li><a href=#aufs>aufs</a></li><li><a href=#docekr-registry>docekr registry</a></li><li><a href=#registryrepository-and-index>registry(repository and index)</a></li><li><a href=#docker-hub>docker hub</a></li><li><a href=#docker-pull>docker pull</a></li><li><a href=#é•œåƒçš„ç›¸å…³æ“ä½œ>é•œåƒçš„ç›¸å…³æ“ä½œ</a></li></ol></li><li><a href=#å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œ>å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œ</a><ol><li><a href=#å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œæ¦‚è¿°>å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œæ¦‚è¿°</a></li><li><a href=#bridged-containers>Bridged Containers</a></li><li><a href=#joined-container>Joined Container</a></li><li><a href=#open-container>Open Container</a></li><li><a href=#closed-container>Closed Container</a></li><li><a href=#è‡ªå®šä¹‰docker0æ¡¥çš„ç½‘ç»œä¿¡æ¯>è‡ªå®šä¹‰docker0æ¡¥çš„ç½‘ç»œä¿¡æ¯</a></li><li><a href=#ä½¿ç”¨tcpå¥—æ¥å­—>ä½¿ç”¨TCPå¥—æ¥å­—</a></li><li><a href=#åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ>åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ</a></li></ol></li><li><a href=#dockerå­˜å‚¨å·>dockerå­˜å‚¨å·</a><ol><li><a href=#why-data-volumeså­˜å‚¨å·>Why Data Volumes(å­˜å‚¨å·)</a></li><li><a href=#data-volumes>Data volumes</a></li><li><a href=#sharing-volumes>Sharing volumes</a></li></ol></li></ol></li><li><a href=#dockerfile>Dockerfile</a><ol><li><a href=#dockerfile-format>Dockerfile Format</a></li><li><a href=#dockerignore-file>.dockerignore file</a></li><li><a href=#environment-replacement>Environment replacement</a></li><li><a href=#docekrfile-instructions>Docekrfile Instructions</a><ol><li><a href=#from>FROM</a></li><li><a href=#maintanierdeprecated>MAINTANIER(deprecated)</a></li><li><a href=#label>LABEL</a></li><li><a href=#copy>COPY</a></li><li><a href=#add>ADD</a></li><li><a href=#workdir>WORKDIR</a></li><li><a href=#volume>VOLUME</a></li><li><a href=#expose>EXPOSE</a></li><li><a href=#env>ENV</a></li><li><a href=#run>RUN</a></li><li><a href=#cmd>CMD</a></li><li><a href=#entrypoint>ENTRYPOINT</a></li><li><a href=#user>USER</a></li><li><a href=#healthcheck>HEALTHCHECK</a></li><li><a href=#shell>SHELL</a></li><li><a href=#stopsignal>STOPSIGNAL</a></li><li><a href=#arg>ARG</a></li><li><a href=#onbuild>ONBUILD</a></li></ol></li></ol></li><li><a href=#dockerèµ„æºé™åˆ¶>Dockerèµ„æºé™åˆ¶</a><ol><li><a href=#oome>OOME</a><ol><li><a href=#limit-a-containers-access-to-memory>Limit a containerâ€™s access to memory</a></li><li><a href=#--memory-swap>&ndash;memory-swap</a></li></ol></li><li><a href=#cpu>CPU</a><ol><li><a href=#configure-the-default-cfs-scheduler>Configure the default CFS scheduler</a></li></ol></li><li><a href=#æµ‹è¯•>æµ‹è¯•</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/cloudnative/ style=background-color:#2a9d8f;color:#fff>CloudNative</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/docker/>Docker</a></h2><h3 class=article-subtitle>Docker is a platform designed to help developers build, share, and run modern applications. We handle the tedious setup, so you can focus on the code.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jun 12, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 18 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p><a class=link href=https://docs.docker.com/ target=_blank rel=noopener><img src=https://img.shields.io/badge/Docker-README-00A6ED loading=lazy alt="docker readme"></a></p><p><a class=link href=https://www.docker.com/ target=_blank rel=noopener><img src=/p/docker/icons/docker-icon.svg loading=lazy alt=docker></a></p><h2 id=ä¸»æœºçº§è™šæ‹ŸåŒ–>ä¸»æœºçº§è™šæ‹ŸåŒ–</h2><p><a class=link href=https://virtual.51cto.com/art/201904/594481.htm target=_blank rel=noopener>Type1å’ŒType2è™šæ‹Ÿæœºç®¡ç†ç¨‹åºåŒºåˆ«</a></p><h3 id=type1>Type1</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Type1è™šæ‹Ÿæœºç®¡ç†ç¨‹åºç›´æ¥åœ¨ä¸»æœºçš„ç‰©ç†ç¡¬ä»¶ä¸Šè¿è¡Œ å®ƒè¢«ç§°ä¸ºè£¸æœºè™šæ‹Ÿæœºç®¡ç†ç¨‹åº
</span></span><span class=line><span class=cl>å®ƒä¸å¿…é¢„å…ˆåŠ è½½åº•å±‚æ“ä½œç³»ç»Ÿ é€šè¿‡ç›´æ¥è®¿é—®åº•å±‚ç¡¬ä»¶è€Œæ— éœ€å…¶ä»–è½¯ä»¶<span class=o>(</span>ä¾‹å¦‚æ“ä½œç³»ç»Ÿå’Œè®¾å¤‡é©±åŠ¨ç¨‹åº<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>VMware ESXi</li><li>Microsoft Hyper-VæœåŠ¡å™¨</li><li>å¼€æºKVM</li><li>&mldr;</li></ul><h3 id=type2>Type2</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Type2è™šæ‹Ÿæœºç®¡ç†ç¨‹åºé€šå¸¸å®‰è£…åœ¨ç°æœ‰æ“ä½œç³»ç»Ÿä¹‹ä¸Š å®ƒç§°ä¸ºæ‰˜ç®¡è™šæ‹Ÿæœºç®¡ç†ç¨‹åº
</span></span><span class=line><span class=cl>å› ä¸ºå®ƒä¾èµ–äºä¸»æœºé¢„å…ˆå®‰è£…çš„æ“ä½œç³»ç»Ÿæ¥ç®¡ç†å¯¹CPU/å†…å­˜/å­˜å‚¨å’Œç½‘ç»œèµ„æºçš„è°ƒç”¨
</span></span></code></pre></td></tr></table></div></div><ul><li>VMware Fusion</li><li>Oracle VM VirtualBox</li><li>ç”¨äºx86çš„Oracle VM Server</li><li>Oracle Solaris Zones</li><li>Parallels</li><li>VMware Workstation</li><li>&mldr;</li></ul><h2 id=å®¹å™¨çº§è™šæ‹ŸåŒ–>å®¹å™¨çº§è™šæ‹ŸåŒ–</h2><h3 id=namespace>Namespace</h3><p><a class=link href=https://man7.org/linux/man-pages/man7/namespaces.7.html target=_blank rel=noopener>man-namespaces</a></p><p><a class=link href=https://lwn.net/Articles/531381/ target=_blank rel=noopener>namespaces API</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>clone<span class=o>()</span>   <span class=c1># Creating a child in a new namespace</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>setns<span class=o>()</span>   <span class=c1># Joining an existing namespace</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>unshare<span class=o>()</span> <span class=c1># Leaving a namespace</span>
</span></span></code></pre></td></tr></table></div></div><p>Linux Namespaces</p><div class=table-wrapper><table><thead><tr><th>namespace</th><th>ç³»ç»Ÿè°ƒç”¨å‚æ•°</th><th>éš”ç¦»å†…å®¹</th><th>å†…æ ¸ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>UTS</td><td>CLONE_NEWUTS</td><td>ä¸»æœºåå’ŒåŸŸå</td><td>2.6.19</td></tr><tr><td>IPC</td><td>CLONE_NEWIPC</td><td>ä¿¡å·é‡/æ¶ˆæ¯é˜Ÿåˆ—/å…±äº«å†…å­˜</td><td>2.6.19</td></tr><tr><td>PID</td><td>CLONE_NEWPID</td><td>è¿›ç¨‹ç¼–å·</td><td>2.6.24</td></tr><tr><td>Network</td><td>CLONE_NEWNET</td><td>ç½‘ç»œè®¾å¤‡/ç½‘ç»œæ ˆ/ç«¯å£ç­‰</td><td>2.6.29</td></tr><tr><td>Mount</td><td>CLONE_NEWNS</td><td>æŒ‚è½½ç‚¹(æ–‡ä»¶ç³»ç»Ÿ)</td><td>2.4.19</td></tr><tr><td>User</td><td>CLONE_NEWUSER</td><td>ç”¨æˆ·å’Œç”¨æˆ·ç»„</td><td>3.8</td></tr></tbody></table></div><h3 id=control-groups>Control Groups</h3><p><a class=link href=https://man7.org/linux/man-pages/man7/cgroups.7.html target=_blank rel=noopener>man-cgroups</a></p><p><a class=link href=https://tech.meituan.com/2015/03/31/cgroups.html target=_blank rel=noopener>linuxèµ„æºç®¡ç†ä¹‹cgroupsç®€ä»‹</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cgroupsæ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§å¯ä»¥é™åˆ¶å•ä¸ªè¿›ç¨‹æˆ–è€…å¤šä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨èµ„æºçš„æœºåˆ¶ å¯ä»¥å¯¹cpu/å†…å­˜ç­‰èµ„æºå®ç°ç²¾ç»†åŒ–çš„æ§åˆ¶
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cgroups çš„å…¨ç§°æ˜¯control groups 
</span></span><span class=line><span class=cl>cgroupsä¸ºæ¯ç§å¯ä»¥æ§åˆ¶çš„èµ„æºå®šä¹‰äº†ä¸€ä¸ªå­ç³»ç»Ÿ å…¸å‹çš„å­ç³»ç»Ÿä»‹ç»å¦‚ä¸‹
</span></span></code></pre></td></tr></table></div></div><ul><li>blkio å—è®¾å¤‡IO</li><li>cpu CPU</li><li>cpuacct CPUèµ„æºä½¿ç”¨æŠ¥å‘Š</li><li>cpuset å¤šå¤„ç†å™¨å¹³å°ä¸Šçš„CPUé›†åˆ(æŒ‰æ ¸/æŒ‰æ¯”ä¾‹)</li><li>devices è®¾å¤‡è®¿é—®</li><li>freezer æŒ‚èµ·æˆ–æ¢å¤ä»»åŠ¡</li><li>memory å†…å­˜ç”¨é‡åŠæŠ¥å‘Š</li><li>perf_event å¯¹cgroupä¸­çš„ä»»åŠ¡è¿›è¡Œç»Ÿä¸€æ€§èƒ½æµ‹è¯•</li><li>net_cls cgroupä¸­çš„ä»»åŠ¡åˆ›å»ºçš„æ•°æ®æŠ¥æ–‡çš„ç±»åˆ«æ ‡è¯†ç¬¦</li></ul><h3 id=lxc>LXC</h3><p><a class=link href=https://www.redhat.com/zh/topics/containers/whats-a-linux-container target=_blank rel=noopener>whats-a-linux-container</a></p><ul><li>LinuX Container<ul><li>lxc-create(åˆ›å»ºnamespace)</li><li>template(æ‹‰å–æ‰€éœ€å‘è¡Œç‰ˆçš„ä»“åº“ç›¸å…³åŒ…è¿›è¡Œå®‰è£…)</li></ul></li></ul><h3 id=å®¹å™¨ç¼–æ’>å®¹å™¨ç¼–æ’</h3><ul><li>machine + swarm + docker compose(å•æœºç¼–æ’)</li><li>mesos + marathon</li><li>kubernetes(k8s)</li></ul><h2 id=docker>Docker</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># docker å®¹å™¨å¼•æ“çš„å‘å±•</span>
</span></span><span class=line><span class=cl><span class=c1># LXC -&gt; libcontainer -&gt; runC</span>
</span></span><span class=line><span class=cl>-&gt; libcontainer<span class=o>(</span>dockerç ”å‘çš„å®¹å™¨å¼•æ“ æ›¿æ¢LXC<span class=o>)</span> 
</span></span><span class=line><span class=cl>-&gt; runC<span class=o>(</span>å®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒæ ‡å‡† Dockerå°†RunCæèµ ç»™OCIä½œä¸ºOCIå®¹å™¨è¿è¡Œæ—¶æ ‡å‡†çš„å‚è€ƒå®ç°<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p><a class=link href=https://os.51cto.com/art/202110/687502.htm target=_blank rel=noopener>docker/containerd/runCåˆ†åˆ«æ˜¯ä»€ä¹ˆ</a></p><h3 id=oci>OCI</h3><p><a class=link href=https://opencontainers.org/ target=_blank rel=noopener><img src=/p/docker/icons/opencontainers-icon.svg loading=lazy alt="Open Container Initiative"></a></p><p>Open Container Initiative</p><ul><li>ç”±LinuxåŸºé‡‘ä¼šä¸»å¯¼äº2015å¹´6æœˆåˆ›ç«‹</li><li>æ—¨åœ¨å›´ç»•å®¹å™¨æ ¼å¼å’Œè¿è¡Œæ—¶åˆ¶å®šä¸€ä¸ªå¼€æ”¾çš„å·¥ä¸šåŒ–æ ‡å‡†</li><li>contains two specifications<ul><li>the Runtime Specification (runtime-spec) è¿è¡Œæ—¶æ ‡å‡†(è§„èŒƒ)</li><li>the Image Specification (image-spec) é•œåƒæ ¼å¼æ ‡å‡†(è§„èŒƒ)</li></ul></li><li>The Runtime Specification outlines how to run a &ldquo;filesystem bundle&rdquo; that is unpacked on disk</li><li>At a high-level an OCI implementation would download an OCI Image then unpack that image into an OCI Runtime filesystem bundle</li></ul><h3 id=runc>runC</h3><p><a class=link href=https://github.com/opencontainers/runc target=_blank rel=noopener>runC</a></p><ul><li>OCF: Open Container Format</li><li>runC: runc is a CLI tool for spawning and running containers on Linux according to the OCI specification</li></ul><h3 id=docker-architecture>docker architecture</h3><p><a class=link href=https://docs.docker.com/get-started/overview/#docker-architecture target=_blank rel=noopener><img src=/p/docker/icons/architecture.svg loading=lazy alt="docker architecture"></a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Client -&gt; Daemon<span class=o>(</span>REST API, over UNIX sockets or a network interface<span class=o>)</span>
</span></span><span class=line><span class=cl>Registry -&gt; Host<span class=o>(</span>https/http<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Registry: ä»“åº“å<span class=o>(</span>repo name<span class=o>)</span> + æ ‡ç­¾<span class=o>(</span>tag<span class=o>)</span> å”¯ä¸€æ ‡è¯†ä¸€ä¸ªé•œåƒ
</span></span><span class=line><span class=cl>-&gt; nginx:1.14.0
</span></span><span class=line><span class=cl>-&gt; nginx:latest<span class=o>(</span>default æœ€æ–°ç‰ˆ<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Images: An image is a read-only template with instructions <span class=k>for</span> creating a Docker container
</span></span><span class=line><span class=cl>Imagesï¼šé™æ€çš„ ä¸ä¼šè¿è¡Œ
</span></span><span class=line><span class=cl>Containersï¼šåŠ¨æ€ æœ‰ç”Ÿå‘½å‘¨æœŸ ç±»ä¼¼å‘½ä»¤
</span></span><span class=line><span class=cl>  /bin/ls
</span></span><span class=line><span class=cl>    - ls /etc
</span></span><span class=line><span class=cl>    - ls /var
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Moby
</span></span><span class=line><span class=cl>docker-ee <span class=c1># ä¼ä¸šç‰ˆ</span>
</span></span><span class=line><span class=cl>docker-ce <span class=c1># ç¤¾åŒºç‰ˆ</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=docker-objects>docker objects</h3><p><a class=link href=https://docs.docker.com/get-started/overview/#docker-objects target=_blank rel=noopener>docker objects</a></p><ul><li>images</li><li>containers</li><li>networks</li><li>volumes</li><li>plugins</li><li>other objects</li></ul><h4 id=images>Images</h4><ul><li>An image is a read-only template with instructions for creating a Docker container</li><li>Often, an image is based on another image, with some additional customization</li><li>You might create your own images or you might only use those created by others and published in a registry</li></ul><h4 id=containers>Containers</h4><ul><li>A container is a runnable instance of an image</li><li>You can create/start/stop/move or delete a container using the Docker API or CLI</li><li>You can connect a container to one or more networks, attach storage to it, or even create a new image based on its current state</li></ul><h3 id=docker-install>docker install</h3><p><a class=link href=https://docs.docker.com/engine/install/ target=_blank rel=noopener>Install Docker Engine</a></p><p><a class=link href=https://mirrors.aliyun.com/docker-ce/ target=_blank rel=noopener>é˜¿é‡Œäº‘Mirrors docker-ce</a></p><h4 id=docker-cerepo>docker-ce.repo</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>docker-ce-stable<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span>Docker CE Stable - <span class=nv>$basearch</span>
</span></span><span class=line><span class=cl><span class=nv>baseurl</span><span class=o>=</span>https://download.docker.com/linux/centos/<span class=nv>$releasever</span>/<span class=nv>$basearch</span>/stable
</span></span><span class=line><span class=cl><span class=c1># baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/$releasever/$basearch/stable</span>
</span></span><span class=line><span class=cl><span class=nv>enabled</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>gpgcheck</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>gpgkey</span><span class=o>=</span>https://download.docker.com/linux/centos/gpg
</span></span></code></pre></td></tr></table></div></div><h4 id=é•œåƒåŠ é€Ÿ>é•œåƒåŠ é€Ÿ</h4><ul><li>docker cn</li><li><a class=link href=https://help.aliyun.com/document_detail/60750.html target=_blank rel=noopener>é˜¿é‡Œäº‘å®˜æ–¹é•œåƒåŠ é€Ÿ</a></li><li>ä¸­å›½ç§‘æŠ€å¤§å­¦</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># é…ç½®æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>/etc/docker/daemon.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ›´æ¢é•œåƒä¸‹è½½ä»“åº“é“¾æ¥</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;registry-mirrors&#34;</span>: <span class=o>[</span><span class=s2>&#34;ç³»ç»Ÿåˆ†é…å‰ç¼€.mirror.aliyuncs.com &#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=docker-cli>docker cli</h3><p><a class=link href=https://docs.docker.com/reference/ target=_blank rel=noopener>docekr-reference</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker --help
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># docker event state æ¶‰åŠéƒ¨åˆ†å¸¸ç”¨å‘½ä»¤</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=docker-event-state>docker event state</h3><p><a class=link href=https://docs.docker.com/engine/reference/commandline/events/ target=_blank rel=noopener><img src=/p/docker/icons/docker-event-state.jpg width=975 height=496 srcset="/p/docker/icons/docker-event-state_hu1fb588f0bea85f45f342114261d318d9_52218_480x0_resize_q75_box.jpg 480w, /p/docker/icons/docker-event-state_hu1fb588f0bea85f45f342114261d318d9_52218_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="docker event state" class=gallery-image data-flex-grow=196 data-flex-basis=471px></a></p><h3 id=docker-image>docker image</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Dockeré•œåƒå«æœ‰å¯åŠ¨å®¹å™¨æ‰€éœ€çš„æ–‡ä»¶ç³»ç»ŸåŠå…¶å†…å®¹ å› æ­¤ å…¶ç”¨äºåˆ›å»ºå¹¶å¯åŠ¨dockerå®¹å™¨
</span></span></code></pre></td></tr></table></div></div><h4 id=docker-image-layer>docker image layer</h4><p><img src=/p/docker/icons/docker-base-image.png width=800 height=600 srcset="/p/docker/icons/docker-base-image_hu2e660399b17286aa9ee92b351b0a326a_72247_480x0_resize_box_3.png 480w, /p/docker/icons/docker-base-image_hu2e660399b17286aa9ee92b351b0a326a_72247_1024x0_resize_box_3.png 1024w" loading=lazy alt=åˆ†å±‚æ„å»º class=gallery-image data-flex-grow=133 data-flex-basis=320px></p><ul><li>é‡‡ç”¨åˆ†å±‚æ„å»ºæœºåˆ¶ æœ€åº•å±‚ä¸ºbootfs å…¶å®ƒä¸ºrootfs<ul><li>bootfs: ç”¨äº<code>ç³»ç»Ÿå¼•å¯¼</code>çš„æ–‡ä»¶ç³»ç»Ÿ åŒ…æ‹¬<code>bootloader</code>å’Œ<code>kernel</code> å®¹å™¨å¯åŠ¨å®Œæˆåä¼šè¢«å¸è½½ä»¥èŠ‚çº¦å†…å­˜èµ„æº</li><li>rootfs: ä½äºbootfsä¹‹ä¸Š è¡¨ç°ä¸ºdockerå®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ<ul><li>ä¼ ç»Ÿæ¨¡å¼ä¸­ ç³»ç»Ÿå¯åŠ¨æ—¶ å†…æ ¸æŒ‚è½½rootfsæ—¶ä¼šé¦–å…ˆå°†å…¶æŒ‚è½½ä¸º<code>åªè¯»</code>æ¨¡å¼(è‡ªæ£€) å®Œæ•´æ€§è‡ªæ£€å®Œæˆåå°†å…¶é‡æ–°æŒ‚è½½ä¸ºè¯»å†™æ¨¡å¼</li><li>dockerä¸­ rootfsç”±å†…æ ¸æŒ‚è½½ä¸º<code>åªè¯»</code>æ¨¡å¼ è€Œåé€šè¿‡<code>è”åˆæŒ‚è½½</code>æŠ€æœ¯é¢å¤–æŒ‚è½½ä¸€ä¸ª<code>å¯å†™</code>å±‚</li></ul></li></ul></li><li>docker image layer<ul><li>ä½ä¸ä¸‹å±‚çš„é•œåƒæˆä¸ºçˆ¶é•œåƒ(parent image) æœ€åº•å±‚çš„ç§°ä¸ºåŸºç¡€é•œåƒ(base image)</li><li>æœ€ä¸Šå±‚çš„ä¸º<code>å¯è¯»å†™</code>å±‚ å…¶ä¸‹çš„å‡ä¸º<code>åªè¯»</code>å±‚</li></ul></li></ul><p><img src=/p/docker/icons/docker-image-layer.png width=651 height=430 srcset="/p/docker/icons/docker-image-layer_hu698cd364b218f2ed2f564ab487df7ce9_26319_480x0_resize_box_3.png 480w, /p/docker/icons/docker-image-layer_hu698cd364b218f2ed2f564ab487df7ce9_26319_1024x0_resize_box_3.png 1024w" loading=lazy alt="docker image layer" class=gallery-image data-flex-grow=151 data-flex-basis=363px></p><h4 id=aufs>aufs</h4><ul><li>Advanced Mult-Layered Unification Filesystem é«˜çº§å¤šå±‚ç»Ÿä¸€æ–‡ä»¶ç³»ç»Ÿ</li><li>ç”¨äºä¸ºLinuxæ–‡ä»¶ç³»ç»Ÿå®ç°<code>è”åˆæŒ‚è½½</code></li><li>aufsæ˜¯ä¹‹å‰UnionFSçš„é‡æ–°å®ç° 2006å¹´ç”±Junjiro Okajimaå¼€å‘</li><li>Docekræœ€åˆä½¿ç”¨aufsä½œä¸ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿå±‚ å®ƒç›®å‰ä»ä½œä¸ºå­˜å‚¨åç«¯ä¹‹ä¸€æ¥æ”¯æŒ</li><li>aufsçš„ç«äº‰äº§å“æ˜¯overlayfs åè€…è‡ªä»3.18ç‰ˆæœ¬å¼€å§‹è¢«åˆå¹¶åˆ°Linuxå†…æ ¸</li><li>dockerçš„åˆ†å±‚é•œåƒ é™¤aufsä¹‹å¤– dockerè¿˜æ”¯æŒbtrfs/devicemapper/vfsç­‰<ul><li>Ubuntuç³»ç»Ÿä¸‹ docekré»˜è®¤Ubuntuçš„aufs è€Œåœ¨CentOS7ä¸Š ç”¨çš„æ˜¯devicemapper(æ–°ç‰ˆé»˜è®¤ä½¿ç”¨overlay2)</li></ul></li></ul><h4 id=docekr-registry>docekr registry</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>å¯åŠ¨å®¹å™¨æ—¶ docker daemon ä¼šè¯•å›¾ä»æœ¬åœ°è·å–ç›¸å…³çš„é•œåƒ æœ¬åœ°é•œåƒä¸å­˜åœ¨æ—¶ å…¶å°†ä»Registryä¸­ä¸‹è½½è¯¥é•œåƒå¹¶ä¿å­˜åˆ°æœ¬åœ°
</span></span></code></pre></td></tr></table></div></div><ul><li>Registryç”¨äºä¿å­˜dockeré•œåƒ åŒ…æ‹¬é•œåƒçš„å±‚æ¬¡ç»“æ„å’Œå…ƒæ•°æ®</li><li>ç”¨æˆ·å¯ä»¥è‡ªå»ºRegistry ä¹Ÿå¯ä»¥ä½¿ç”¨å®˜æ–¹çš„Docker Hub</li><li>åˆ†ç±»<ul><li>Sponsor Registry: ç¬¬ä¸‰æ–¹çš„registry ä¾›å®¢æˆ·å’ŒDockerç¤¾åŒºä½¿ç”¨(æèµ è€…)</li><li>Mirror Registry: ç¬¬ä¸‰æ–¹çš„registry åªè®©å®¢æˆ·ä½¿ç”¨(äº‘)</li><li>Vendor Registry: ç”±å‘å¸ƒDockeré•œåƒçš„ä¾›åº”å•†æä¾›çš„registry(redhat)</li><li>Private Registry: é€šè¿‡è®¾æœ‰é˜²ç«å¢™å’Œé¢å¤–å®‰å…¨å±‚çš„ç§æœ‰å®ä½“æä¾›çš„registry(è‡ªå»º)<ul><li><a class=link href=https://hub.docker.com/_/registry target=_blank rel=noopener>docker-registry/docker-distribution</a></li><li><a class=link href=https://goharbor.io/ target=_blank rel=noopener>harbor</a></li></ul></li></ul></li></ul><p><img src=/p/docker/icons/docker-registry.png width=1001 height=516 srcset="/p/docker/icons/docker-registry_hua933c1d1f3b2ebd39d6af526d8740ae9_269181_480x0_resize_box_3.png 480w, /p/docker/icons/docker-registry_hua933c1d1f3b2ebd39d6af526d8740ae9_269181_1024x0_resize_box_3.png 1024w" loading=lazy alt="docker registry" class=gallery-image data-flex-grow=193 data-flex-basis=465px></p><h4 id=registryrepository-and-index>registry(repository and index)</h4><ul><li>Repository<ul><li>ç”±æŸç‰¹å®šçš„dockeré•œåƒçš„<code>æ‰€æœ‰è¿­ä»£ç‰ˆæœ¬</code>ç»„æˆçš„é•œåƒä»“åº“</li><li>ä¸€ä¸ªRegistryä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªRepository<ul><li>Repositoryå¯åˆ†ä¸º<code>é¡¶å±‚ä»“åº“</code>å’Œ<code>ç”¨æˆ·ä»“åº“</code></li><li>ç”¨æˆ·ä»“åº“åç§°æ ¼å¼ä¸º<code>ç”¨æˆ·å/ä»“åº“å</code> => <code>ilolicon/nginx</code></li></ul></li><li>æ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ªTag(æ ‡ç­¾) æ¯ä¸ªæ ‡ç­¾å¯¹åº”ä¸€ä¸ªé•œåƒ</li></ul></li><li>Index<ul><li>ç»´æŠ¤ç”¨æˆ·è´¦æˆ·/é•œåƒçš„æ ¡éªŒä»¥åŠå…¬å…±å‘½åç©ºé—´çš„ä¿¡æ¯</li><li>ç›¸å½“äºä¸ºRegistryæä¾›ä¸€ä¸ªå®Œæˆç”¨æˆ·è®¤è¯ç­‰åŠŸèƒ½çš„æ£€ç´¢æ¥å£</li></ul></li></ul><h4 id=docker-hub>docker hub</h4><p><a class=link href=https://docs.docker.com/docker-hub/ target=_blank rel=noopener>DockerHub</a></p><p>Docker Hub provides the following major features:</p><ul><li><a class=link href=https://docs.docker.com/docker-hub/repos/ target=_blank rel=noopener>Repositories</a>: Push and pull container images</li><li><a class=link href=https://docs.docker.com/docker-hub/orgs/ target=_blank rel=noopener>Teams & Organizations</a>: Manage access to private repositories of container images</li><li><a class=link href=https://docs.docker.com/docker-hub/official_images/ target=_blank rel=noopener>Docker Official Images</a>: Pull and use high-quality container images provided by Docker</li><li><a class=link href=https://docs.docker.com/docker-hub/publish/ target=_blank rel=noopener>Docker Verified Publisher Images</a>: Pull and use high- quality container images provided by external vendors</li><li><a class=link href=https://docs.docker.com/docker-hub/builds/ target=_blank rel=noopener>Builds</a>: Automatically build container images from GitHub and Bitbucket and push them to Docker Hub</li><li><a class=link href=https://docs.docker.com/docker-hub/webhooks/ target=_blank rel=noopener>Webhooks</a>: Trigger actions after a successful push to a repository to integrate Docker Hub with other services</li></ul><h4 id=docker-pull>docker pull</h4><p><a class=link href=https://docs.docker.com/engine/reference/commandline/pull/ target=_blank rel=noopener>pull-commandline</a></p><p><a class=link href=https://quay.io/ target=_blank rel=noopener>quay.io</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker pull &lt;registry&gt;<span class=o>[</span>:port<span class=o>]</span>/<span class=o>[</span>&lt;namespace&gt;/<span class=o>]</span>&lt;name&gt;:&lt;tag&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># e.g:</span>
</span></span><span class=line><span class=cl><span class=c1># registry: quay.io</span>
</span></span><span class=line><span class=cl><span class=c1># port: 443(æ²¡æŒ‡å®š é»˜è®¤)</span>
</span></span><span class=line><span class=cl><span class=c1># namespace: coreos</span>
</span></span><span class=line><span class=cl><span class=c1># name: flannel(repostoryåç§°)</span>
</span></span><span class=line><span class=cl><span class=c1># tag: v0.15.1-arm64 æŒ‡å®šç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>$ docker pull quay.io/coreos/flannel:v0.15.1-arm64
</span></span></code></pre></td></tr></table></div></div><div class=table-wrapper><table><thead><tr><th>Namespace</th><th>Examples(&lt;namespace/name>)</th></tr></thead><tbody><tr><td>organization</td><td>redhat/kubernetes google/kubernetes</td></tr><tr><td>login(user name)</td><td>alice/application ilolicon/application</td></tr><tr><td>role</td><td>devel/database test/database prod/database</td></tr></tbody></table></div><h4 id=é•œåƒçš„ç›¸å…³æ“ä½œ>é•œåƒçš„ç›¸å…³æ“ä½œ</h4><p><img src=/p/docker/icons/docker-image-create.png width=1330 height=778 srcset="/p/docker/icons/docker-image-create_hu35c6b1faa4899c64f224a792974bf729_550128_480x0_resize_box_3.png 480w, /p/docker/icons/docker-image-create_hu35c6b1faa4899c64f224a792974bf729_550128_1024x0_resize_box_3.png 1024w" loading=lazy alt="docker image create" class=gallery-image data-flex-grow=170 data-flex-basis=410px></p><ul><li><p>é•œåƒçš„ç”Ÿæˆé€”å¾„</p><ul><li><a class=link href=https://docs.docker.com/engine/reference/builder/ target=_blank rel=noopener>Dockerfile</a></li><li><a class=link href=https://docs.docker.com/engine/reference/commandline/commit/ target=_blank rel=noopener>åŸºäºå®¹å™¨åˆ¶ä½œ</a></li><li>Docekr Hub automated builds(ä»æ˜¯åŸºäºDockerfile)</li></ul></li><li><p>å¦ä¸€ç§é•œåƒåˆ†å‘æ–¹å¼</p><ul><li><a class=link href=https://docs.docker.com/engine/reference/commandline/save/ target=_blank rel=noopener>docker-save</a></li><li><a class=link href=https://docs.docker.com/engine/reference/commandline/load/ target=_blank rel=noopener>docker-load</a></li></ul></li></ul><h3 id=å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œ>å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œ</h3><h4 id=å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œæ¦‚è¿°>å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œæ¦‚è¿°</h4><p><a class=link href=https://www.cnblogs.com/hukey/p/14062579.html target=_blank rel=noopener>å®¹å™¨è™šæ‹ŸåŒ–ç½‘ç»œ</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>OVS: Open VSwitch
</span></span><span class=line><span class=cl>SDN
</span></span><span class=line><span class=cl>Overlay Network<span class=o>(</span>å åŠ ç½‘ç»œ<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># dockeré»˜è®¤çš„ä¸‰ç§ç½‘ç»œ</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ilolicon@master ~<span class=o>]</span>$ docker network ls
</span></span><span class=line><span class=cl>NETWORK ID     NAME      DRIVER    SCOPE
</span></span><span class=line><span class=cl>78fa953ed316   bridge    bridge    <span class=nb>local</span> <span class=c1># æ¡¥æ¥ é»˜è®¤NATæ¡¥</span>
</span></span><span class=line><span class=cl>8ec55273feb2   host      host      <span class=nb>local</span> <span class=c1># è®©å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œåç§°ç©ºé—´</span>
</span></span><span class=line><span class=cl>9081fe29a218   none      null      <span class=nb>local</span> <span class=c1># åªæœ‰loæ¥å£ æ²¡æœ‰å…¶ä»–ç½‘å¡</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>ilolicon@master ~<span class=o>]</span>$ yum -y install bridge-utils
</span></span><span class=line><span class=cl><span class=o>[</span>ilolicon@master ~<span class=o>]</span>$ brctl show
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/docker/icons/four-network-container-archetypes.png width=921 height=563 srcset="/p/docker/icons/four-network-container-archetypes_hu5fe812ea1b5552a81ec2413a76585961_183707_480x0_resize_box_3.png 480w, /p/docker/icons/four-network-container-archetypes_hu5fe812ea1b5552a81ec2413a76585961_183707_1024x0_resize_box_3.png 1024w" loading=lazy alt="Four network container archetypes" class=gallery-image data-flex-grow=163 data-flex-basis=392px></p><p><a class=link href=https://docs.docker.com/network/ target=_blank rel=noopener>docker-docs:network overview</a></p><ul><li>Closed Container</li><li>Bridged Container(NATæ¡¥æ¥ç½‘ç»œ é»˜è®¤)</li><li>Joined Container(è”ç›Ÿå¼å®¹å™¨ç½‘ç»œ ç›¸å¯¹éš”ç¦» åªæ˜¯å…±äº«åŒä¸€ä¸ªç½‘ç»œåç§°ç©ºé—´)</li><li>Open Container(å¼€æ”¾å¼å®¹å™¨ç½‘ç»œ å…±äº«å®¿ä¸»æœºç½‘ç»œåç§°ç©ºé—´)</li></ul><h4 id=bridged-containers>Bridged Containers</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Bridged Containerså¯ä»¥ä¸ºdocker runå‘½ä»¤ä½¿ç”¨</span>
</span></span><span class=line><span class=cl><span class=c1># &#34;--hostname HOSTNAME&#34; é€‰é¡¹ä¸ºå®¹å™¨æŒ‡å®šä¸»æœºå</span>
</span></span><span class=line><span class=cl>$ docker run --rm --net bridge --hostname cloudnative.ilolicon.com busybox:latest hostname
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;--dns DNS_SERVER_IP&#34; é€‰é¡¹èƒ½å¤Ÿä¸ºå®¹å™¨æŒ‡å®šæ‰€ä½¿ç”¨çš„dnsæœåŠ¡å™¨åœ°å€</span>
</span></span><span class=line><span class=cl>$ docker run --rm --dns 8.8.8.8 --dns 8.8.4.4 busybox:latest nslookup docker.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># &#34;--add-host HOSTNAME:IP&#34; é€‰é¡¹èƒ½å¤Ÿä¸ºå®¹å™¨æŒ‡å®šæœ¬åœ°ä¸»æœºåè§£æé¡¹</span>
</span></span><span class=line><span class=cl>$ docker run --rm --dns 172.16.0.1 --add-host <span class=s2>&#34;docker.com:172.16.0.100&#34;</span> busybox:latest cat /etc/hosts
</span></span></code></pre></td></tr></table></div></div><h5 id=opening-inbound-communication--expose>Opening Inbound Communication / Expose</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-pé€‰é¡¹çš„ä½¿ç”¨æ ¼å¼
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æŒ‡å®šçš„å®¹å™¨ç«¯å£&lt;containerPort&gt; æ˜ å°„è‡³ä¸»æœºæ‰€æœ‰åœ°å€çš„ä¸€ä¸ªåŠ¨æ€ç«¯å£</span>
</span></span><span class=line><span class=cl>-p &lt;containerPort&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æŒ‡å®šçš„å®¹å™¨ç«¯å£&lt;containerPort&gt; æ˜ å°„è‡³æŒ‡å®šçš„ä¸»æœºç«¯å£&lt;hostPort&gt;</span>
</span></span><span class=line><span class=cl>-p &lt;hostPort&gt;:&lt;containerPort&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æŒ‡å®šçš„å®¹å™¨ç«¯å£&lt;containerPort&gt; æ˜ å°„è‡³ä¸»æœºæŒ‡å®š&lt;ip&gt;çš„åŠ¨æ€ç«¯å£</span>
</span></span><span class=line><span class=cl>-p &lt;ip&gt;::&lt;containerPort&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æŒ‡å®šçš„å®¹å™¨ç«¯å£&lt;containerPort&gt; æ˜ å°„è‡³ä¸»æœºæŒ‡å®š&lt;ip&gt;çš„ç«¯å£&lt;hostPort&gt;</span>
</span></span><span class=line><span class=cl>-p &lt;ip&gt;:&lt;hostPort&gt;:&lt;containerPort&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;åŠ¨æ€ç«¯å£&#34;</span> æŒ‡éšæœºç«¯å£ å…·ä½“çš„æ˜ å°„ç»“æœå¯ä½¿ç”¨docker portå‘½ä»¤æŸ¥çœ‹
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Exposeç«¯å£ è¿˜å¯ä»¥å‚è€ƒ -P é€‰é¡¹ï¼šæš´éœ²å®¹å™¨å†…éƒ¨å·²æŒ‡å®šçš„ç«¯å£
</span></span></code></pre></td></tr></table></div></div><h4 id=joined-container>Joined Container</h4><ul><li>è”ç›Ÿå¼å®¹å™¨æ˜¯æŒ‡ä½¿ç”¨æŸä¸ªå·²å­˜åœ¨å®¹å™¨çš„ç½‘ç»œæ¥å£çš„å®¹å™¨ æ¥å£è¢«è”ç›Ÿå†…çš„å„å®¹å™¨å…±äº«ä½¿ç”¨(NTS Network IPC)</li><li>è”ç›Ÿå¼å®¹å™¨å½¼æ­¤é—´è™½ç„¶å…±äº«åŒä¸€ä¸ªç½‘ç»œåç§°ç©ºé—´ ä½†å…¶å®ƒå†…éƒ¨åç§°ç©ºé—´å¦‚: User/Mountç­‰è¿˜æ˜¯éš”ç¦»çš„</li><li>è”ç›Ÿå¼å®¹å™¨å½¼æ­¤é—´å­˜åœ¨ç«¯å£å†²çªçš„å¯èƒ½æ€§ ä½¿ç”¨æ­¤ç§æ¨¡å¼çš„ç½‘ç»œæ¨¡å‹æƒ…å†µ<ul><li>å¤šä¸ªå®¹å™¨ä¸Šçš„ç¨‹åºéœ€è¦ç¨‹åºloopbackæ¥å£äº’ç›¸é€šä¿¡</li><li>å¯¹æŸå·²å­˜çš„å®¹å™¨çš„ç½‘ç»œå±æ€§è¿›è¡Œç›‘æ§</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ªç›‘å¬äº2222ç«¯å£çš„httpæœåŠ¡å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker run --name t1 -it --rm busybox
</span></span><span class=line><span class=cl>/ <span class=c1># ifconfig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ªè”ç›Ÿå¼å®¹å™¨(--networkæŒ‡å®šä½¿ç”¨t1çš„ç½‘ç»œåç§°ç©ºé—´) å¹¶æŸ¥çœ‹å…¶ç›‘å¬çš„ç«¯å£</span>
</span></span><span class=line><span class=cl>$ docker run --name t2 -it --rm --network container:t1 busybox
</span></span><span class=line><span class=cl>/ <span class=c1># ifconfig</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=open-container>Open Container</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># --network æŒ‡å®š host</span>
</span></span><span class=line><span class=cl><span class=c1># ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œåç§°ç©ºé—´ æ— éœ€å†Exposeç«¯å£</span>
</span></span><span class=line><span class=cl>$ docker run --rm -it --network host busybox
</span></span></code></pre></td></tr></table></div></div><h4 id=closed-container>Closed Container</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># --network none</span>
</span></span><span class=line><span class=cl>$ docker run --rm -it --network none busybox
</span></span></code></pre></td></tr></table></div></div><h4 id=è‡ªå®šä¹‰docker0æ¡¥çš„ç½‘ç»œä¿¡æ¯>è‡ªå®šä¹‰docker0æ¡¥çš„ç½‘ç»œä¿¡æ¯</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ç¼–è¾‘ /etc/docker/daemon.json é…ç½®æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;bip&#34;</span>: <span class=s2>&#34;192.168.1.5/24&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;fixed-cidr&#34;</span>: <span class=s2>&#34;10.20.0.0/16&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;fixed-cidr-v6&#34;</span>: <span class=s2>&#34;2001:db8::/64&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;mtu&#34;</span>: <span class=s2>&#34;1500&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;default-gateway&#34;</span>: <span class=s2>&#34;10.20.1.1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;default-gateway-v6&#34;</span>: <span class=s2>&#34;2001:db8:abcd::89&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;dns&#34;</span>: <span class=o>[</span><span class=s2>&#34;10.20.1.2&#34;</span>,<span class=s2>&#34;10.20.1.3&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¸å¿ƒé€‰é¡¹ä¸ºbip å³bridge ipä¹‹æ„ </span>
</span></span><span class=line><span class=cl><span class=c1># ç”¨äºæŒ‡å®šdocker0æ¡¥è‡ªèº«çš„IPåœ°å€ å…¶ä»–é€‰é¡¹å¯ä»¥é€šè¿‡æ­¤åœ°å€è®¡ç®—å¾—å‡º</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ä½¿ç”¨tcpå¥—æ¥å­—>ä½¿ç”¨TCPå¥—æ¥å­—</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># dockerdå®ˆæŠ¤è¿›ç¨‹çš„C/S å…¶é»˜è®¤ä»…ç›‘å¬Unix Socketæ ¼å¼çš„åœ°å€ /var/run/docker.sock</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœä½¿ç”¨TCPå¥—æ¥å­— éœ€è¦ä¿®æ”¹ /etc/docekr/daemon.json é…ç½®æ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=c1># ä¹Ÿå¯å‘dockerdç›´æ¥ä¼ é€’ &#34;-H|--host&#34;é€‰é¡¹</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;hosts&#34;</span>: <span class=o>[</span><span class=s2>&#34;tcp://0.0.0.0:2375&#34;</span>, <span class=s2>&#34;unix:///var/run/docker.sock&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># dockerdä½¿ç”¨TCPç›‘å¬0.0.0.0:2375ä¹‹å å®¢æˆ·ç«¯å¯ä»¥è¿œç¨‹æ‰§è¡ŒCLI</span>
</span></span><span class=line><span class=cl>$ docker -H x.x.x.x:2375 image ls
</span></span><span class=line><span class=cl>$ docker -H x.x.x.x:2375 ps -a
</span></span></code></pre></td></tr></table></div></div><h4 id=åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ>åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œ</span>
</span></span><span class=line><span class=cl>$ docker network create -d bridge --subnet <span class=s2>&#34;172.26.0.0/16&#34;</span> --gateway <span class=s2>&#34;172.26.0.1&#34;</span> mybr0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œ</span>
</span></span><span class=line><span class=cl><span class=o>[</span>ilolicon@master ~<span class=o>]</span>$ docker run -it --rm --name t1 --network mybr0 busybox
</span></span><span class=line><span class=cl>/ <span class=c1># ifconfig</span>
</span></span><span class=line><span class=cl>eth0      Link encap:Ethernet  HWaddr 02:42:AC:1A:00:02  
</span></span><span class=line><span class=cl>          inet addr:172.26.0.2  Bcast:172.26.255.255  Mask:255.255.0.0
</span></span></code></pre></td></tr></table></div></div><h3 id=dockerå­˜å‚¨å·>dockerå­˜å‚¨å·</h3><h4 id=why-data-volumeså­˜å‚¨å·>Why Data Volumes(å­˜å‚¨å·)</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Dockeré•œåƒç”±å¤šä¸ª<span class=s2>&#34;åªè¯»å±‚&#34;</span>å åŠ è€Œæˆ 
</span></span><span class=line><span class=cl>å¯åŠ¨å®¹å™¨æ—¶ Dockerä¼šåŠ è½½åªè¯»é•œåƒå±‚å¹¶åœ¨é•œåƒæ ˆé¡¶éƒ¨æ·»åŠ ä¸€ä¸ª<span class=s2>&#34;è¯»å†™å±‚&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>å¦‚æœè¿è¡Œä¸­çš„å®¹å™¨ä¿®æ”¹äº†ç°æœ‰çš„ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶
</span></span><span class=line><span class=cl>é‚£è¯¥æ–‡ä»¶å°†ä¼šä»è¯»å†™å±‚ä¸‹é¢çš„åªè¯»å±‚å¤åˆ¶åˆ°è¯»å†™å±‚ è¯¥æ–‡ä»¶çš„åªè¯»ç‰ˆæœ¬<span class=s2>&#34;ä»ç„¶å­˜åœ¨&#34;</span>
</span></span><span class=line><span class=cl>åªæ˜¯å·²ç»è¢«è¯»å†™å±‚ä¸­è¯¥æ–‡ä»¶çš„å‰¯æœ¬æ‰€éšè— æ­¤å³<span class=s2>&#34;å†™æ—¶å¤åˆ¶(COW)&#34;</span>æœºåˆ¶
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/docker/icons/files-visible-to-a-container.png width=751 height=423 srcset="/p/docker/icons/files-visible-to-a-container_hu5bf186c999f6f34c90c9ad0a7dba16dd_138845_480x0_resize_box_3.png 480w, /p/docker/icons/files-visible-to-a-container_hu5bf186c999f6f34c90c9ad0a7dba16dd_138845_1024x0_resize_box_3.png 1024w" loading=lazy alt=file-visible class=gallery-image data-flex-grow=177 data-flex-basis=426px></p><ul><li>å…³é—­å¹¶é‡å¯å®¹å™¨ å…¶æ•°æ®ä¸å—å½±å“ ä½†åˆ é™¤Dockerå®¹å™¨ åˆ™å…¶æ›´æ”¹å°†ä¼šå…¨éƒ¨ä¸¢å¤±</li><li>å­˜åœ¨çš„é—®é¢˜<ul><li>å­˜å‚¨äºè”åˆæ–‡ä»¶ç³»ç»Ÿä¸­ ä¸æ˜“äºå®¿ä¸»æœºè®¿é—®(æ•ˆç‡ä½)</li><li>å®¹å™¨é—´æ•°æ®å…±äº«ä¸ä¾¿</li><li>åˆ é™¤å®¹å™¨å…¶æ•°æ®ä¼šä¸¢å¤±</li></ul></li><li>è§£å†³æ–¹æ¡ˆ: &ldquo;<strong>å·</strong>(volume)&rdquo;<ul><li><strong>å·</strong>æ˜¯å®¹å™¨ä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ª<strong>ç›®å½•</strong> æ­¤ç±»ç›®å½•å¯ç»•è¿‡è”åˆæ–‡ä»¶ç³»ç»Ÿ ä¸å®¿ä¸»æœºä¸Šçš„æŸç›®å½•<strong>ç»‘å®š(å…³è”)</strong></li><li>Volumeäºå®¹å™¨åˆå§‹åŒ–ä¹‹æ—¶å³ä¼šåˆ›å»º ç”±base imageæä¾›çš„å·ä¸­çš„æ•°æ®ä¼šäºæ­¤æœŸé—´å®Œæˆå¤åˆ¶</li><li>Volumeçš„åˆè¡·æ˜¯ç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå®ç°æ•°æ®æŒä¹…åŒ– å› æ­¤åˆ é™¤å®¹å™¨ä¹‹æ—¶æ—¢ä¸ä¼šåˆ é™¤å· ä¹Ÿä¸ä¼šå¯¹å“ªæ€•æœªè¢«å¼•ç”¨çš„å·åšåƒåœ¾å›æ”¶æ“ä½œ(åŠ é€‰é¡¹å¯ä»¥)</li></ul></li></ul><p><img src=/p/docker/icons/volume.png width=693 height=192 srcset="/p/docker/icons/volume_huc6dd66b5d1fa365b97dd8d30d2bb4680_75141_480x0_resize_box_3.png 480w, /p/docker/icons/volume_huc6dd66b5d1fa365b97dd8d30d2bb4680_75141_1024x0_resize_box_3.png 1024w" loading=lazy alt=volume class=gallery-image data-flex-grow=360 data-flex-basis=866px></p><ul><li>å·ä¸ºdockeræä¾›äº†ç‹¬ç«‹äºå®¹å™¨çš„æ•°æ®ç®¡ç†æœºåˆ¶<ul><li>å¯ä»¥æŠŠ<strong>é•œåƒ</strong>æƒ³è±¡æˆé™æ€æ–‡ä»¶ -> ä¾‹å¦‚ <strong>ç¨‹åº</strong>; æŠŠå·ç±»æ¯”ä¸ºåŠ¨æ€å†…å®¹ -> ä¾‹å¦‚ <strong>æ•°æ®</strong>; äºæ˜¯ é•œåƒå¯ä»¥é‡ç”¨ è€Œå·å¯ä»¥å…±äº«</li><li>å·å®ç°äº†<strong>ç¨‹åº(é•œåƒ)</strong> å’Œ <strong>æ•°æ®(å·)</strong> åˆ†ç¦» ä»¥åŠ <strong>ç¨‹åº(é•œåƒ)</strong> å’Œ <strong>åˆ¶ä½œé•œåƒçš„ä¸»æœº</strong> åˆ†ç¦»; ç”¨æˆ·åˆ¶ä½œé•œåƒæ—¶æ— éœ€å†è€ƒè™‘é•œåƒè¿è¡Œçš„å®¹å™¨æ‰€åœ¨çš„ä¸»æœºçš„ç¯å¢ƒ</li></ul></li></ul><p><img src=/p/docker/icons/volume2.png width=932 height=374 srcset="/p/docker/icons/volume2_hubb053bbe15fe56dbede9e549ddb24aef_129737_480x0_resize_box_3.png 480w, /p/docker/icons/volume2_hubb053bbe15fe56dbede9e549ddb24aef_129737_1024x0_resize_box_3.png 1024w" loading=lazy alt=volume2 class=gallery-image data-flex-grow=249 data-flex-basis=598px></p><h4 id=data-volumes>Data volumes</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Docekræœ‰ä¸¤ç§ç±»å‹çš„å· æ¯ç§ç±»å‹éƒ½åœ¨å®¹å™¨ä¸­å­˜åœ¨ä¸€ä¸ªæŒ‚è½½ç‚¹ ä½†åœ¨å…¶å®¿ä¸»æœºä¸Šçš„ä½ç½®æœ‰æ‰€ä¸åŒ
</span></span></code></pre></td></tr></table></div></div><ul><li>Bind mount volume(ç»‘å®šæŒ‚åœ¨å·)<ul><li>a volume that points to a user-specified location on the host file system</li></ul></li><li>Docker-managed volume(Dockerç®¡ç†å·)<ul><li>the Docker daemon creates managed volumes in a portion of the host&rsquo;s file system that&rsquo;s owned by Docker</li></ul></li></ul><p><img src=/p/docker/icons/data-volumes.png width=1317 height=440 srcset="/p/docker/icons/data-volumes_hu4dfcbd12cf6b4d086e7fe173542ab64f_196844_480x0_resize_box_3.png 480w, /p/docker/icons/data-volumes_hu4dfcbd12cf6b4d086e7fe173542ab64f_196844_1024x0_resize_box_3.png 1024w" loading=lazy alt=data-volume class=gallery-image data-flex-grow=299 data-flex-basis=718px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># åœ¨å®¹å™¨ä¸­ä½¿ç”¨Volumes</span>
</span></span><span class=line><span class=cl><span class=c1># ä¸ºdocker runå‘½ä»¤ä½¿ç”¨-vé€‰é¡¹å³å¯ä½¿ç”¨Volume</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Docker-managed volume</span>
</span></span><span class=line><span class=cl>$ docker run -it --name t1 -v /data busybox
</span></span><span class=line><span class=cl>$ docker inspect -f <span class=o>{{</span>.Mounts<span class=o>}}</span> t1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Bind-mount Volume</span>
</span></span><span class=line><span class=cl>$ docker run -it -v HOSTDIR:VOLUMEDIR --name t2 bustbox
</span></span><span class=line><span class=cl>$ docker inspect -f <span class=o>{{</span>.Mount<span class=o>}}</span> t2
</span></span></code></pre></td></tr></table></div></div><h4 id=sharing-volumes>Sharing volumes</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># There are tow ways to share volumes between containers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¤šä¸ªå®¹å™¨çš„å·ä½¿ç”¨åŒä¸€ä¸ªä¸»æœºç›®å½•</span>
</span></span><span class=line><span class=cl>$ docker run -it --name t1 -v /docker/volumes/v1:/data busybox
</span></span><span class=line><span class=cl>$ docker run -it --name t2 -v /docker/volumes/v1:/data busybox
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¤åˆ¶ä½¿ç”¨å…¶ä»–å®¹å™¨çš„å· ä¸ºdocker runå‘½ä»¤ä½¿ç”¨ --volumes-from é€‰é¡¹</span>
</span></span><span class=line><span class=cl>$ docker run -it --name t3 -v /docker/volumes/v1:/data busybox
</span></span><span class=line><span class=cl>$ docker run -it --name t4 --volumes-from t3 busybox
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœæœ‰å¤šä¸ªå®¹å™¨éœ€è¦å…±äº«ç½‘ç»œåç§°ç©ºé—´(UTS Network IPC) ä»¥åŠéœ€è¦å…±äº«å­˜å‚¨å·</span>
</span></span><span class=line><span class=cl><span class=c1># å¯ä»¥ äº‹å…ˆåˆ›å»ºä¸€ä¸ª åŸºç¡€å®¹å™¨ å…¶ä»–çš„å®¹å™¨éƒ½åŠ å…¥è¯¥å®¹å™¨çš„ç½‘ç»œåç§°ç©ºé—´(Joined Container) å¹¶ä¸”å¤åˆ¶è¯¥å®¹å™¨ä½¿ç”¨çš„å·(--volumes-from)</span>
</span></span><span class=line><span class=cl>$ docker run --name infracon -it -v /data/infracon/volume:/data busybox
</span></span><span class=line><span class=cl>$ docker run --name nginx --network container:infracon --volumes-from infracon -it nginx
</span></span><span class=line><span class=cl>$ docker run ... --network container:infracon --volumes-from infracon ...
</span></span></code></pre></td></tr></table></div></div><h2 id=dockerfile>Dockerfile</h2><p><a class=link href=https://docs.docker.com/engine/reference/builder/ target=_blank rel=noopener>Dockerfile-reference</a></p><p>Dockerfile is nothing but the source code for building Docker images</p><ul><li>Docker can build images automatically by reading the instructions from a Dockerfile</li><li>A Dockerfile is a <code>text document</code> than contains all the commands a user could call on the command line to assemble an image</li><li>Using <code>docker build</code> users can create an automated build that executes several command-line instructions in succession</li></ul><p><img src=/p/docker/icons/docker-build.png width=490 height=242 srcset="/p/docker/icons/docker-build_hu78e016fdb09837500502497ac9124888_91582_480x0_resize_box_3.png 480w, /p/docker/icons/docker-build_hu78e016fdb09837500502497ac9124888_91582_1024x0_resize_box_3.png 1024w" loading=lazy alt=build class=gallery-image data-flex-grow=202 data-flex-basis=485px></p><h3 id=dockerfile-format>Dockerfile Format</h3><ul><li>Format<ul><li># Comment (æ³¨é‡Š)</li><li>INSTRUCTION arguments (æŒ‡ä»¤åŠå…¶å‚æ•° é€šå¸¸ä¸€è¡Œä¸€ä¸ªæ‰§è¡Œ å¤ªé•¿ä½¿ç”¨<code>\</code>æ¢è¡Œ)</li></ul></li><li>The instruction is not case-sensitive (æŒ‡ä»¤å¤§å°å†™ä¸æ•æ„Ÿ)<ul><li>However, convention is for them to be UPPERCASE to distinguish them from arguments more easily (ä¸€èˆ¬çº¦å®šä½¿ç”¨å¤§å†™ å’Œå‚æ•°åŒºåˆ†å¼€)</li></ul></li><li>Docker runs instructions in a Dockerfile in order (é¡ºåºæ‰§è¡Œ)</li><li>The first instruction must be <code>FROM</code> in order to specify the Base Image from which you are building (ç¬¬ä¸€ä¸ªéæŒ‡æ•°è¡Œ å¿…é¡»ä¸º<code>FROM</code>æŒ‡ä»¤)</li></ul><h3 id=dockerignore-file>.dockerignore file</h3><ul><li>Before the docker CLI sends the context to the docker daemon, it looks for a file named .dockerignore in the root directory of the context</li><li>If this file exists, the CLI modifies the context to exclude files and directories than match patterns in it</li><li>The CLI interprets the .dockerignore file as a newline-separated list of patterns similar to the file globs of Unix shells</li></ul><h3 id=environment-replacement>Environment replacement</h3><ul><li>Environment variables (declared with the <code>ENV</code> statement) can also be used in certain instructions as variables to be interpred by the Dockerfile</li><li>Environment variables are notated in the Dockerfile either with $variable_name or ${variable_name}</li><li>The ${variable_name} syntax also supports a few of the standard bash modifiers<ul><li>${variable:-word} - è®¾ç½®é»˜è®¤å€¼ variableæœªè®¾ç½®æˆ–ä¸ºç©º åˆ™å˜é‡é»˜è®¤å€¼ä¸º: word</li><li>${variable:+word} - å’Œ ${variable:-word} ç›¸å</li></ul></li></ul><h3 id=docekrfile-instructions>Docekrfile Instructions</h3><h4 id=from>FROM</h4><ul><li><code>FROM</code>æŒ‡ä»¤æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªä¸”å¿…é¡»ä¸ºDocekrfileæ–‡ä»¶å¼€ç¯‡çš„ç¬¬ä¸€ä¸ªéæ³¨é‡Šè¡Œ ç”¨äºä¸ºé•œåƒæ–‡ä»¶æ„å»ºè¿‡ç¨‹æŒ‡å®šåŸºå‡†é•œåƒ åç»­çš„æŒ‡ä»¤è¿è¡Œäºæ­¤åŸºå‡†é•œåƒæ‰€æä¾›çš„è¿è¡Œç¯å¢ƒ</li><li>å®è·µä¸­ åŸºå‡†é•œåƒå¯ä»¥æ˜¯ä»»ä½•å¯ç”¨é•œåƒæ–‡ä»¶ é»˜è®¤æƒ…å†µä¸‹ <code>docekr build</code>ä¼šåœ¨dockerä¸»æœºä¸ŠæŸ¥æ‰¾æŒ‡å®šçš„é•œåƒæ–‡ä»¶ åœ¨å…¶ä¸å­˜åœ¨æ—¶ åˆ™ä¼šä»Docker Hub Registryä¸Šæ‹‰å–æ‰€éœ€çš„é•œåƒæ–‡ä»¶<ul><li>å¦‚æœæ‰¾ä¸åˆ°æ‰§è¡Œçš„é•œåƒæ–‡ä»¶ <code>docker build</code>ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</li></ul></li><li>Syntax<ul><li><code>FROM &lt;repository>[:&lt;tag>]</code> æˆ–</li><li><code>FROM &lt;repository>@&lt;digest></code> @ç¬¦å·æŒ‡å®šhashç  ç¡®ä¿base imageä¸ä¼šè¢«ç¯¡æ”¹<ul><li><code>&lt;repository></code> æŒ‡å®šä½œä¸º base image çš„åç§°</li><li><code>&lt;tag></code> base image çš„æ ‡ç­¾ å¯é€‰ çœç•¥æ—¶é»˜è®¤ä¸ºlatest</li></ul></li></ul></li></ul><h4 id=maintanierdeprecated>MAINTANIER(deprecated)</h4><ul><li>ç”¨äºè®©Docekrfileåˆ¶ä½œè€…æä¾›æœ¬äººçš„è¯¦ç»†ä¿¡æ¯</li><li>Dockerfileå¹¶ä¸é™åˆ¶MAINTANIERæŒ‡ä»¤å‡ºç°çš„ä½ç½® ä½†æ¨èå°†å…¶æ”¾ç½®äº<code>FROM</code>æŒ‡ä»¤å</li><li>Syntax<ul><li><code>MAINTANIER &lt;author's detail></code><ul><li><code>&lt;author's detail></code>å¯ä»¥æ˜¯ä»»ä½•æ–‡æœ¬ä¿¡æ¯ ä½†çº¦å®šä¿—æˆåœ°ä½¿ç”¨ä½œè€…åç§°åŠå…¶é‚®ä»¶åœ°å€</li><li><code>MAINTANIER "ilolicon &lt;97431110@qq.com>"</code></li></ul></li></ul></li></ul><h4 id=label>LABEL</h4><p>The LABEL instruction adds metadata to an image (å¯æ›¿æ¢MAINTANIER å¹¶å¯æ·»åŠ æ›´å¤šå…ƒæ•°æ®ä¿¡æ¯)</p><ul><li>Syntax: <code>LABEL &lt;key>=&lt;value> &lt;key>=&lt;value> &lt;key>=&lt;value> ...</code></li><li>The LABEL instruction adds metadata to an image</li><li>A LABEL is a key-value pair</li><li>To include spaces within a LABEL value, use quotes and backslashes as you would in command-line parsing</li><li>An image can have more than one label</li><li>You can specify multiple labels on a single line</li></ul><h4 id=copy>COPY</h4><ul><li>ç”¨äºä»Dockerä¸»æœºå¤åˆ¶æ–‡ä»¶è‡³åˆ›å»ºçš„æ–°é•œåƒæ–‡ä»¶</li><li>Syntax<ul><li><code>COPY &lt;src> ... &lt;dest></code> æˆ–</li><li><code>COPY ["&lt;src>", ..., "&lt;dest>"]</code><ul><li><code>&lt;src></code> è¦å¤åˆ¶çš„æºæ–‡ä»¶æˆ–ç›®å½• æ”¯æŒä½¿ç”¨é€šé…ç¬¦</li><li><code>&lt;dest></code> ç›®æ ‡è·¯å¾„ å³æ­£åœ¨åˆ›å»ºçš„imageçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ å»ºè®®<code>&lt;dest></code>ä½¿ç”¨ç»å¯¹è·¯å¾„ å¦åˆ™<code>COPY</code>æŒ‡ä»¤åˆ™ä»¥WORKDIRä¸ºå…¶èµ·å§‹è·¯å¾„</li></ul></li><li>æ³¨æ„: åœ¨è·¯å¾„ä¸­æœ‰ç©ºç™½ç¬¦æ—¶ é€šå¸¸ä½¿ç”¨ç¬¬äºŒç§æ ¼å¼</li></ul></li><li>æ–‡ä»¶å¤åˆ¶å‡†åˆ™<ul><li><code>&lt;src></code>å¿…é¡»æ˜¯buildä¸Šä¸‹æ–‡ä¸­çš„è·¯å¾„ ä¸èƒ½æ˜¯å…¶çˆ¶ç›®å½•ä¸­çš„æ–‡ä»¶</li><li>å¦‚æœ<code>&lt;src></code>æ˜¯ç›®å½• åˆ™å…¶å†…éƒ¨æ–‡ä»¶æˆ–å­ç›®å½•ä¼šè¢«é€’å½’å¤åˆ¶ ä½†æ˜¯<code>&lt;src></code>ç›®å½•æœ¬èº«ä¸ä¼šè¢«å¤åˆ¶</li><li>å¦‚æœæŒ‡å®šå¤šä¸ª<code>&lt;src></code> æˆ–åœ¨<code>&lt;src></code>ä¸­ä½¿ç”¨äº†é€šé…ç¬¦ åˆ™<code>&lt;dest></code>å¿…é¡»æ˜¯ä¸€ä¸ªç›®å½• ä¸”å¿…é¡»ä»¥<code>/</code>ç»“å°¾</li><li>å¦‚æœ<code>&lt;dest></code>äº‹å…ˆä¸å­˜åœ¨ å®ƒå°†ä¼šè¢«è‡ªåŠ¨åˆ›å»º è¿™åŒ…æ‹¬å…¶çˆ¶çº§ç›®å½•</li></ul></li></ul><h4 id=add>ADD</h4><ul><li><code>ADD</code>æŒ‡ä»¤ç±»ä¼¼äº<code>COPY</code>æŒ‡ä»¤ ADDæ”¯æŒä½¿ç”¨TARæ–‡ä»¶å’ŒURLè·¯å¾„</li><li>Syntax<ul><li><code>ADD &lt;src> ... &lt;dest></code> æˆ–</li><li><code>ADD ["&lt;src>", ..., "&lt;dest>"]</code></li></ul></li><li>æ“ä½œå‡†åˆ™<ul><li>åŒ<code>COPY</code>æŒ‡ä»¤</li><li>URL<ul><li>å¦‚æœ<code>&lt;src></code>ä¸ºURLä¸”<code>&lt;dest></code>ä¸ä»¥<code>/</code>ç»“å°¾ åˆ™<code>&lt;src></code>æŒ‡å®šçš„æ–‡ä»¶å°†è¢«ä¸‹è½½å¹¶ç›´æ¥è¢«åˆ›å»ºä¸º<code>&lt;dest></code></li><li>å¦‚æœ<code>&lt;src></code>ä¸ºURLä¸”<code>&lt;dest></code>ä»¥<code>/</code>ç»“å°¾ åˆ™æ–‡ä»¶åURLæŒ‡å®šçš„æ–‡ä»¶å°†è¢«ä¸‹è½½å¹¶ä¿å­˜ä¸º<code>&lt;dest>/&lt;filename></code></li></ul></li><li>TAR<ul><li>å¦‚æœ<code>&lt;src></code>æ˜¯ä¸€ä¸ªæœ¬åœ°ç³»ç»Ÿä¸Šçš„å‹ç¼©æ ¼å¼çš„taræ–‡ä»¶ å®ƒå°†è¢«å±•å¼€ä¸ºä¸€ä¸ªç›®å½• å…¶è¡Œä¸ºç±»ä¼¼äº<code>tar -x</code>å‘½ä»¤ ç„¶è€Œ é€šé“URLè·å–åˆ°çš„taræ–‡ä»¶å°†ä¸ä¼šè‡ªåŠ¨å±•å¼€</li></ul></li><li>å¦‚æœ<code>&lt;src></code>æœ‰å¤šä¸ª æˆ–å…¶é—´æ¥æˆ–ç›´æ¥ä½¿ç”¨äº†é€šé…ç¬¦ åˆ™<code>&lt;dest></code>å¿…é¡»æ˜¯ä¸€ä¸ªä»¥<code>/</code>ç»“å°¾çš„ç›®å½•è·¯å¾„ å¦‚æœ<code>&lt;dest></code>ä¸ä»¥<code>/</code>ç»“å°¾ åˆ™å…¶å°†è¢«è§†ä¸ºä¸€ä¸ªæ™®é€šæ–‡ä»¶ <code>&lt;src></code>çš„å†…å®¹å°†è¢«ç›´æ¥å†™å…¥åˆ°<code>&lt;dest></code></li></ul></li></ul><h4 id=workdir>WORKDIR</h4><ul><li>ç”¨äºä¸ºDockerfileä¸­æ‰€æœ‰çš„<code>RUN/CMD/ENTRYPOINT/COPY/ADD</code>æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•</li><li>Syntax<ul><li><code>WORKDIR &lt;dirpath></code><ul><li>åœ¨Dockerfileä¸­ <code>WORKDIR</code>æŒ‡ä»¤å¯ä»¥å‡ºç°å¤šæ¬¡ å…¶è·¯å¾„ä¹Ÿå¯ä»¥ä¸ºç›¸å¯¹è·¯å¾„ ä¸è¿‡å…¶æ˜¯ç›¸å¯¹æ­¤å‰ä¸€ä¸ª<code>WODKDIR</code>æŒ‡ä»¤æŒ‡å®šçš„è·¯å¾„</li><li>å¦å¤– <code>WORKDIR</code>ä¹Ÿå¯è°ƒç”¨ç”±<code>ENV</code>æŒ‡ä»¤å®šä¹‰çš„å˜é‡</li></ul></li><li>e.g<ul><li><code>WORKDIR /var/log</code></li><li><code>WORKDIR $STATEPATH</code></li></ul></li></ul></li></ul><h4 id=volume>VOLUME</h4><ul><li>ç”¨äºåœ¨imageä¸­åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ç›®å½• ä»¥æŒ‚è½½Docker hostä¸Šçš„å·æˆ–å…¶ä»–å®¹å™¨ä¸Šçš„å·</li><li>Syntax<ul><li><code>VOLUME &lt;mountpoint></code> æˆ–</li><li><code>VOLUME ["&lt;mountpoint>"]</code></li></ul></li><li>å¦‚æœæŒ‚è½½ç‚¹ç›®å½•è·¯å¾„ä¸‹æ­¤å‰åœ¨æ–‡ä»¶å­˜åœ¨ <code>docker run</code>å‘½ä»¤ä¼šåœ¨æŒ‚è½½å®Œæˆåå°†æ­¤å‰çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°æ–°æŒ‚è½½çš„å·ä¸­</li></ul><h4 id=expose>EXPOSE</h4><ul><li>ç”¨äºä¸ºå®¹å™¨æ‰“å¼€æŒ‡å®šè¦ç›‘å¬çš„ç«¯å£ ä»¥å®ç°ä¸å¤–éƒ¨é€šä¿¡</li><li>Syntax<ul><li><code>EXPOSE &lt;port>[/&lt;protocol>] [&lt;port>[/protocol]...]</code><ul><li><code>&lt;protocol></code>ç”¨äºæŒ‡å®šä¼ è¾“å±‚åè®® å¯ä¸ºtcpæˆ–udpäºŒè€…ä¹‹ä¸€ é»˜è®¤ä¸ºTCPåè®®</li></ul></li><li><code>EXPOSE</code>æŒ‡ä»¤å¯ä¸€æ¬¡æŒ‡å®šå¤šä¸ªç«¯å£<ul><li><code>EXPOSE 11211/udp 11211/tcp</code></li></ul></li></ul></li></ul><h4 id=env>ENV</h4><ul><li>ç”¨äºä¸ºé•œåƒå®šä¹‰æ‰€éœ€çš„ç¯å¢ƒå˜é‡ å¹¶å¯è¢«Dockerfileæ–‡ä»¶ä¸­ä½ä¸å…¶åçš„å…¶å®ƒæŒ‡ä»¤(å¦‚<code>ENV/ADD/COPY</code>ç­‰)æ‰€è°ƒç”¨</li><li>è°ƒç”¨æ ¼å¼ä¸º $variable_name æˆ– ${variable_name}</li><li>Syntax<ul><li><code>ENV &lt;key> &lt;value></code> æˆ–</li><li><code>ENV &lt;key>=&lt;value> ...</code></li></ul></li><li>ç¬¬ä¸€ç§æ ¼å¼ä¸­: <code>&lt;key></code>ä¹‹åçš„æ‰€æœ‰å†…å®¹å‡ä¼šè¢«è§†ä½œå…¶<code>&lt;value></code>çš„ç»„æˆéƒ¨åˆ† å› æ­¤ ä¸€æ¬¡åªèƒ½è®¾ç½®ä¸€ä¸ªå˜é‡</li><li>ç¬¬äºŒç§æ ¼å¼ä¸­: å¯ä»¥ä¸€æ¬¡è®¾ç½®å¤šä¸ªå˜é‡ æ¯ä¸ªå˜é‡ä¸ºä¸€ä¸ª<code>&lt;key>=&lt;value></code>çš„é”®å€¼å¯¹ å¦‚æœ<code>&lt;value></code>ä¸­åŒ…å«ç©ºæ ¼ å¯ä»¥ä»¥åæ–œçº¿<code>\</code>è¿›è¡Œè½¬ä¹‰ ä¹Ÿå¯ä»¥é€šè¿‡å¯¹<code>&lt;value></code>åŠ å¼•å·è¿›è¡Œæ ‡è¯† å¦å¤– åæ–œçº¿ä¹Ÿç”¨äºç»­è¡Œ</li><li>å®šä¹‰å¤šä¸ªå˜é‡æ—¶ å»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ ä»¥ä¾¿åœ¨åŒä¸€å±‚ä¸­å®Œæˆæ‰€æœ‰åŠŸèƒ½</li></ul><h4 id=run>RUN</h4><ul><li>ç”¨äºæŒ‡å®š<code>docker build</code>è¿‡ç¨‹ä¸­è¿è¡Œçš„ç¨‹åº å…¶å¯ä»¥æ˜¯ä»»ä½•å‘½ä»¤(åŸºäºbase imageæä¾›)</li><li>Syntax<ul><li><code>RUN &lt;command></code> æˆ–</li><li><code>RUN ["&lt;executable>", "&lt;param1>", "&lt;param2>"]</code></li></ul></li><li>ç¬¬ä¸€ç§æ ¼å¼ä¸­ <code>&lt;command></code> é€šå¸¸æ˜¯ä¸€ä¸ªshellå‘½ä»¤ ä¸”ä»¥<code>/bin/sh -c</code>æ¥è¿è¡Œå®ƒ è¿™æ„å‘³ç€æ­¤è¿›ç¨‹åœ¨å®¹å™¨ä¸­çš„PIDä¸æ˜¯1 ä¸èƒ½æ¥æ”¶Unixä¿¡å· å› æ­¤ å½“ä½¿ç”¨<code>docker stop &lt;container></code>å‘½ä»¤åœæ­¢å®¹å™¨æ—¶ æ­¤è¿›ç¨‹æ¥æ”¶ä¸åˆ°SIGTERMä¿¡å·</li><li>ç¬¬äºŒç§è¯­æ³•æ ¼å¼ä¸­çš„å‚æ•°æ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„æ•°ç»„ å…¶ä¸­<code>&lt;executable></code>ä¸ºè¦è¿è¡Œçš„å‘½ä»¤ åé¢çš„<code>&lt;paramN></code>ä¸ºä¼ é€’ç»™å‘½ä»¤çš„é€‰é¡¹æˆ–å‚æ•° ç„¶è€Œ æ­¤ç§æ ¼å¼æŒ‡å®šçš„å‘½ä»¤ä¸ä¼šä»¥<code>/bin/sh -c</code>æ¥å‘èµ· å› æ­¤å¸¸è§çš„shellæ“ä½œå¦‚å˜é‡æ›¿æ¢ä»¥åŠé€šé…ç¬¦<code>? *ç­‰</code>æ›¿æ¢å°†ä¸ä¼šè¿›è¡Œ ä¸è¿‡å¦‚æœè¦è¿è¡Œçš„å‘½ä»¤ä¾èµ–äºæ­¤shellç‰¹æ€§çš„è¯ å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºç±»ä¼¼ä¸‹é¢çš„æ ¼å¼<ul><li><code>RUN ["/bin/sh", "-c", "&lt;executable>", "&lt;param1>"]</code></li><li>Jsonæ•°ç»„ä¸­ æ³¨æ„è¦ä½¿ç”¨<strong>åŒå¼•å·</strong></li></ul></li></ul><h4 id=cmd>CMD</h4><ul><li>ç±»ä¼¼äº<code>RUN</code>æŒ‡ä»¤ <code>CMD</code>æŒ‡ä»¤ä¹Ÿå¯ç”¨äºè¿è¡Œä»»ä½•å‘½ä»¤æˆ–åº”ç”¨ç¨‹åº ä¸è¿‡ äºŒè€…çš„è¿è¡Œæ—¶é—´ç‚¹ä¸åŒ<ul><li><code>RUN</code>æŒ‡ä»¤è¿è¡Œäºæ˜ åƒæ–‡ä»¶æ„å»ºè¿‡ç¨‹ä¸­ è€Œ<code>CMD</code>æŒ‡ä»¤è¿è¡ŒäºåŸºäºDockerfileæ„å»ºå‡ºçš„æ–°æ˜ åƒæ–‡ä»¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶</li><li><code>CMD</code>æŒ‡ä»¤çš„é¦–è¦ç›®çš„åœ¨äºä¸ºå¯åŠ¨çš„å®¹å™¨æŒ‡å®š<code>é»˜è®¤</code>è¦è¿è¡Œçš„ç¨‹åº ä¸”å…¶è¿è¡Œç»“æŸå å®¹å™¨ä¹Ÿå°†ç»ˆæ­¢ ä¸è¿‡<code>CMD</code>æŒ‡å®šçš„å‘½ä»¤å¯ä»¥è¢«<code>docker run</code>çš„å‘½ä»¤è¡Œé€‰é¡¹æ‰€è¦†ç›–</li><li>åœ¨Docekrfileä¸­ å¯ä»¥å­˜åœ¨å¤šä¸ª<code>CMD</code>æŒ‡ä»¤ ä½†ä»…æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆ</li></ul></li><li>Syntax<ul><li><code>CMD &lt;command></code> æˆ–</li><li><code>CMD ["&lt;executable>", "&lt;param1>", "&lt;param2>"]</code> æˆ–</li><li><code>CMD ["&lt;param1>", "&lt;param2>"]</code></li></ul></li><li>å‰ä¸¤ç§è¯­æ³•æ ¼å¼çš„æ„ä¹‰åŒ<code>RUN</code></li><li>éƒ½ä¸‰ç§åˆ™ç”¨äºä¸º<code>ENTRYPOINT</code>æŒ‡ä»¤æä¾›é»˜è®¤å‚æ•°</li></ul><h4 id=entrypoint>ENTRYPOINT</h4><ul><li>ç±»ä¼¼<code>CMD</code>æŒ‡ä»¤çš„åŠŸèƒ½ ç”¨äºä¸ºå®¹å™¨æŒ‡å®šé»˜è®¤è¿è¡Œç¨‹åº ä»è€Œä½¿å¾—å®¹å™¨åƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯æ‰§è¡Œç¨‹åº</li><li>ä¸<code>CMD</code>ä¸åŒçš„æ˜¯ ç”±<code>ENTRYPOINT</code>å¯åŠ¨çš„ç¨‹åºä¸ä¼šè¢«<code>docker run</code>å‘½ä»¤è¡ŒæŒ‡å®šçš„å‚æ•°æ‰€è¦†ç›– è€Œä¸” è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°ä¼ é€’ç»™<code>ENTRYPOINT</code>æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åº<ul><li>ä¸è¿‡ <code>docker run</code>å‘½ä»¤çš„<code>--entrypoint</code>é€‰é¡¹çš„å‚æ•° å¯ä»¥è¦†ç›–<code>ENTRYPOINT</code>æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åº</li></ul></li><li>Syntax<ul><li><code>ENTRYPOINT &lt;command></code></li><li><code>ENTRYPOINT ["&lt;executable>", "&lt;param1>", "&lt;param2>"]</code></li></ul></li><li><code>docker run</code>å‘½ä»¤ä¼ å…¥çš„å‘½ä»¤å‚æ•°ä¼šè¦†ç›–<code>CMD</code>æŒ‡ä»¤çš„å†…å®¹ å¹¶ä¸”é™„åŠ åˆ°<code>ENTRYPOINT</code>å‘½ä»¤æœ€åä½œä¸ºå…¶å‚æ•°ä½¿ç”¨</li><li>Dockerfileæ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥å­˜åœ¨å¤šä¸ª<code>ENTRYPOINT</code>æŒ‡ä»¤ ä½†ä»…æœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆ</li></ul><p>Tips: ä½¿ç”¨<code>ENTRYPOINT</code>è§£å†³é…ç½®æ–‡ä»¶<strong>ç¯å¢ƒå˜é‡</strong>ä½¿ç”¨é—®é¢˜</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># é—®é¢˜: nginx(æˆ–å…¶ä»–ç¨‹åº)é…ç½®æ–‡ä»¶æœ‰è®¸å¤šéœ€è¦ä¿®æ”¹çš„é…ç½®</span>
</span></span><span class=line><span class=cl><span class=c1># æ¯”å¦‚: root_dir / listen_ip / listen_port ç­‰ç­‰ </span>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨å®¹å™¨çš„æƒ…å†µä¸‹ å¦‚ä½•æ›´ä¼˜çš„è§£å†³è¯¥é—®é¢˜?</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>docker-entrypoint.sh</li></ul><p><a class=link href=https://github.com/docker-library/mysql/blob/master/5.7/docker-entrypoint.sh target=_blank rel=noopener>refer:MySQL dokcer-entrypoint.sh</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®å˜é‡(ç¯å¢ƒå˜é‡/è‡ªå®šä¹‰å˜é‡)ç”Ÿæˆé…ç½®æ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=c1># éœ€è¦ä¿®æ”¹çš„ ä¼ å…¥ç¯å¢ƒå˜é‡çš„æ–¹å¼ æ¯”å¦‚: APP_ENV: TEST|PROD|DEV</span>
</span></span><span class=line><span class=cl><span class=c1># docker run -d --name=ngx --env PORT=8080 --env XX=XX --rm ngx:v1</span>
</span></span><span class=line><span class=cl><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>ip address show dev eth0 <span class=p>|</span> awk <span class=s1>&#39;/inet /{split($2, ip, &#34;/&#34;);print ip[1]}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt; /etc/nginx/conf.d/www.conf <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>server {
</span></span></span><span class=line><span class=cl><span class=s>    server_name ${HOSTNAME};
</span></span></span><span class=line><span class=cl><span class=s>    listen ${IP:-0.0.0.0}:${PORT:-80};
</span></span></span><span class=line><span class=cl><span class=s>    root ${NGX_DOC_ROOT:-/usr/share/nginx/html/};
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Dockerfile CMDæŒ‡å®šçš„å‚æ•°($@) å–ä»£å½“å‰shell æˆä¸º main-process</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Dockerfile</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> nginx:1.14-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>LABEL</span> <span class=nv>maintainer</span><span class=o>=</span><span class=s2>&#34;ilolicon &lt;97431110@qq.com&gt;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>NGX_DOC_ROOT</span><span class=o>=</span><span class=s2>&#34;/data/www/html/&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> index.html <span class=nv>$NGX_DOC_ROOT</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> docker-entrypoint.sh /bin/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;/usr/sbin/nginx&#34;</span><span class=p>,</span> <span class=s2>&#34;-g&#34;</span><span class=p>,</span> <span class=s2>&#34;daemon off&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># CMDæŒ‡ä»¤å‚æ•° ä¼ é€’ç»™docker-entrypoint.shè„šæœ¬ è„šæœ¬ç”¨$@è·å–å…¨éƒ¨å‚æ•°</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;/bin/docker-entrypoint.sh&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=user>USER</h4><ul><li>ç”¨äºæŒ‡å®šè¿è¡Œimageæ—¶æˆ–è¿è¡ŒDockerfileä¸­ä»»ä½•<code>RUN CMD æˆ– ENTRYPOINT</code>æŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºæ—¶çš„ç”¨æˆ·åæˆ–UID</li><li>é»˜è®¤æƒ…å†µä¸‹ containerçš„è¿è¡Œèº«ä»½ä¸ºrootç”¨æˆ·</li><li>Syntax<ul><li><code>USER &lt;UID>|&lt;UserName></code></li><li>éœ€è¦æ³¨æ„çš„æ˜¯ <code>&lt;UID></code>å¯ä»¥ä¸ºä»»æ„æ•°å­— ä½†å®è·µä¸­å…¶å¿…é¡»ä¸º<code>/etc/passwd</code>(å®¹å™¨ä¸­)ä¸­æŸç”¨æˆ·çš„æœ‰æ•ˆUID å¦åˆ™<code>docker run</code>å‘½ä»¤å°†è¿è¡Œå¤±è´¥</li></ul></li></ul><h4 id=healthcheck>HEALTHCHECK</h4><p><a class=link href=https://docs.docker.com/engine/reference/builder/#healthcheck target=_blank rel=noopener>HEALTHCHECK</a></p><ul><li>The <code>HEALTHCHECK</code> instruction tells Docker how to test a container to check that it is still working</li><li>This can detect cases such as a web server that is stuck in an infinite loop and unable to handle new connections, even though the server process is still running</li><li>The HEALTHCHECK instruction has two forms<ul><li><code>HEALTHCHECK [OPTIONS] CMD command</code> (check container health by running a command inside the container)</li><li><code>HEALTHCHECK NONE</code> (disable any healthcheck inherited from the base image)</li></ul></li><li>The options that can appear before CMD are:<ul><li>&ndash;interval=DURATION (default: 30s)</li><li>&ndash;timeout=DURATION (default: 30s)</li><li>&ndash;start-period=DURATION (default: 0s) - å¤šå°‘ç§’ä¹‹åå¼€å§‹æ£€æµ‹ ç­‰å¾…container initçš„æ—¶é—´</li><li>&ndash;retries=N (default: 3)</li></ul></li><li>The commandâ€™s exit status indicates the health status of the container. The possible values are:<ul><li>0: success - the container is healthy and ready for use</li><li>1: unhealthy - the container is not working correctly</li><li>2: reserved - do not use this exit code - é¢„ç•™ ä¸è¦ä½¿ç”¨</li></ul></li><li>For example<ul><li><code>HEALTHCHECK --interval=5m --timeout=3s CMD curl -f http://localhost/ || exit 1</code></li></ul></li></ul><h4 id=shell>SHELL</h4><p><a class=link href=https://docs.docker.com/engine/reference/builder/#shell target=_blank rel=noopener>SHELL</a></p><ul><li>The <code>SHELL</code> instruction allows the default <em>shell</em> used for the shell form of commands to be overridden</li><li>The default shell on Linux is ["/bin/sh", &ldquo;-c&rdquo;], and on Windows is [&ldquo;cmd&rdquo;, &ldquo;/S&rdquo;, &ldquo;/C&rdquo;]</li><li>The <code>SHELL</code> instruction must be written in JSON form in a Dockerfile<ul><li>Syntax: SHELL [&ldquo;executable&rdquo;, &ldquo;parameters&rdquo;]</li></ul></li><li>The <code>SHELL</code> instruction can appear multiple times</li><li>Each <code>SHELL</code> instruction overrides all previous <code>SHELL</code> instructions, and affects all subsequent instruction</li></ul><h4 id=stopsignal>STOPSIGNAL</h4><p><a class=link href=https://docs.docker.com/engine/reference/builder/#stopsignal target=_blank rel=noopener>STOPSIGNAL</a></p><ul><li>The <code>STOPSIGNAL</code> instruction sets the system call signal that will be sent to the container to exit</li><li>This signal can be a signal name in the format <code>SIG&lt;NAME></code>, for instance <code>SIGKILL</code>, or an unsigned number that matches a position in the kernelâ€™s syscall table, for instance <code>9</code><ul><li>The default is <code>SIGTERM</code> if not defined</li></ul></li><li>Syntax: <code>STOPSIGNAL signal</code></li></ul><h4 id=arg>ARG</h4><p><a class=link href=https://docs.docker.com/engine/reference/builder/#arg target=_blank rel=noopener>ARG</a></p><ul><li>The ARG instruction defines a variable that users can pass at build-time to the builder with the docker build command using the <code>--build-arg &lt;varname>=&lt;value></code> flag</li><li>If a user specifies a build argument that was not defined in the Dockerfile, the build outputs a warning<ul><li><code>[Warning] One or more build-args [foo] were not consumed.</code></li></ul></li><li>Syntax: <code>ARG &lt;name>[=&lt;default value>]</code></li><li>A Dockerfile may include one or more <code>ARG</code> instructions</li><li>An <code>ARG</code> instruction can optionally include a default value:<ul><li><code>ARG user1=someuser</code></li><li><code>ARG buildno=1</code></li></ul></li></ul><p>âš ï¸ <strong>Warning</strong>
It is not recommended to use build-time variables for passing secrets like github keys, user credentials etc. Build-time variable values are visible to any user of the image with the <code>docker history</code> command.</p><p>Refer to the <a class=link href=https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information target=_blank rel=noopener>&ldquo;build images with BuildKit&rdquo;</a> section to learn about secure ways to use secrets when building images.</p><h4 id=onbuild>ONBUILD</h4><ul><li>ç”¨äºåœ¨Dockerfileä¸­å®šä¹‰ä¸€ä¸ªè§¦å‘å™¨</li><li>Dockerfileç”¨äºbuildæ˜ åƒæ–‡ä»¶ æ­¤æ˜ åƒæ–‡ä»¶äº¦å¯ä½œä¸ºbase imageè¢«å¦ä¸€ä¸ªDockerfileç”¨ä½œ<code>FROM</code>æŒ‡ä»¤çš„å‚æ•° å¹¶ä»¥ä¹‹æ„å»ºæ–°çš„é•œåƒæ–‡ä»¶</li><li>åœ¨åé¢çš„è¿™ä¸ªDockerfileä¸­çš„<code>FROM</code>æŒ‡ä»¤åœ¨buildè¿‡ç¨‹ä¸­è¢«æ‰§è¡Œæ—¶ å°†ä¼š<strong>è§¦å‘</strong>åˆ›å»ºå…¶base imageçš„Dockerfileæ–‡ä»¶ä¸­çš„<code>ONBUILD</code>æŒ‡ä»¤å®šä¹‰çš„è§¦å‘å™¨</li><li>Syntax<ul><li><code>ONBUILD &lt;INSTRUCTION></code></li></ul></li><li>å°½ç®¡ä»»ä½•æŒ‡ä»¤éƒ½å¯ä»¥æ³¨å†Œæˆä¸ºè§¦å‘å™¨æŒ‡ä»¤ ä½†<code>ONBUILD</code>ä¸èƒ½è‡ªæˆ‘åµŒå¥— ä¸”ä¸ä¼šè§¦å‘<code>FROM</code>å’Œ<code>MAINTAINER</code>æŒ‡ä»¤</li><li>ä½¿ç”¨åŒ…å«<code>ONBUILD</code>æŒ‡ä»¤çš„Dockerfileæ„å»ºçš„é•œåƒåº”è¯¥ä½¿ç”¨ç‰¹æ®Šçš„æ ‡ç­¾<ul><li>e.g: ruby:2.0-onbuild</li></ul></li><li>åœ¨<code>ONBUILD</code>æŒ‡ä»¤ä¸­ä½¿ç”¨<code>ADD</code>æˆ–<code>COPY</code>æŒ‡ä»¤åº”è¯¥æ ¼å¤–å°å¿ƒ å› ä¸ºæ–° æ„å»ºè¿‡ç¨‹çš„ä¸Šä¸‹æ–‡åœ¨ç¼ºå°‘æŒ‡å®šçš„æºæ–‡ä»¶æ—¶ä¼šå¤±è´¥</li></ul><h2 id=dockerèµ„æºé™åˆ¶>Dockerèµ„æºé™åˆ¶</h2><p><a class=link href=https://docs.docker.com/config/containers/resource_constraints/ target=_blank rel=noopener>Limit a container&rsquo;s resources</a></p><ul><li>By default, a container has no resource constraints and can use as much of a given resource as the hostâ€™s kernel scheduler allows</li><li>Docker provides ways to control how much memory, or CPU a container can use, setting runtime configuration flags of the <code>docker run</code> command</li><li>Many of these features require your kernel to support Linux capabilities<ul><li>To check for support, you can use the <code>docker info</code> command</li></ul></li></ul><h3 id=oome>OOME</h3><ul><li>On Linux hosts, if the kernel detects that there is not enough memory to perform important system functions, it throws an <code>OOME</code>, or <code>Out Of Memory Exception</code>, and starts killing processes to free up memory<ul><li>ä¸€æ—¦å‘ç”ŸOOME ä»»ä½•è¿›ç¨‹éƒ½æœ‰å¯èƒ½è¢«æ€æ­» åŒ…æ‹¬docker daemonåœ¨å†…</li><li>ä¸ºæ­¤ Dockerç‰¹åœ°è°ƒæ•´äº†docker daemonçš„OOMä¼˜å…ˆçº§ ä»¥å…å®ƒè¢«å†…æ ¸"æ­£æ³•" ä½†å®¹å™¨ä¼˜å…ˆçº§å¹¶ä¸ºè°ƒæ•´</li><li><code>Memory Hogs</code> <code>OOM_ADJ</code> <code>OOM_SCORE</code></li></ul></li></ul><h4 id=limit-a-containers-access-to-memory>Limit a containerâ€™s access to memory</h4><ul><li>Docker can enforce hard memory limits, which allow the container to use no more than a given amount of user or system memory</li><li>or soft limits, which allow the container to use as much memory as it needs unless certain conditions are met, such as when the kernel detects low memory or contention on the host machine</li><li>Some of these options have different effects when used alone or when more than one option is set</li><li>Most of these options take a positive integer, followed by a suffix of <code>b, k, m, g</code>, to indicate bytes, kilobytes, megabytes, or gigabytes</li></ul><div class=table-wrapper><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td><code>-m</code> or <code>--memory=</code></td><td>The maximum amount of memory the container can use. If you set this option, the minimum allowed value is <code>6m</code> (6 megabytes). That is, you must set the value to at least 6 megabytes.</td></tr><tr><td><code>--memory-swap *</code></td><td>The amount of memory this container is allowed to swap to disk. See <a class=link href=https://docs.docker.com/config/containers/resource_constraints/#--memory-swap-details target=_blank rel=noopener><code>--memory-swap</code> details</a>.</td></tr><tr><td><code>--memory-swappiness</code></td><td>By default, the host kernel can swap out a percentage of anonymous pages used by a container. You can set <code>--memory-swappiness</code> to a value between 0 and 100, to tune this percentage. See <a class=link href=https://docs.docker.com/config/containers/resource_constraints/#--memory-swappiness-details target=_blank rel=noopener><code>--memory-swappiness</code> details</a>.</td></tr><tr><td><code>--memory-reservation</code></td><td>Allows you to specify a soft limit smaller than <code>--memory</code> which is activated when Docker detects contention or low memory on the host machine. If you use <code>--memory-reservation</code>, it must be set lower than <code>--memory</code> for it to take precedence. Because it is a soft limit, it does not guarantee that the container doesnâ€™t exceed the limit.</td></tr><tr><td><code>--kernel-memory</code></td><td>The maximum amount of kernel memory the container can use. The minimum allowed value is <code>4m</code>. Because kernel memory cannot be swapped out, a container which is starved of kernel memory may block host machine resources, which can have side effects on the host machine and on other containers. See <a class=link href=https://docs.docker.com/config/containers/resource_constraints/#--kernel-memory-details target=_blank rel=noopener><code>--kernel-memory</code> details</a>.</td></tr><tr><td><code>--oom-kill-disable</code></td><td>By default, if an out-of-memory (OOM) error occurs, the kernel kills processes in a container. To change this behavior, use the <code>--oom-kill-disable</code> option. Only disable the OOM killer on containers where you have also set the <code>-m/--memory</code> option. If the <code>-m</code> flag is not set, the host can run out of memory and the kernel may need to kill the host systemâ€™s processes to free memory.</td></tr></tbody></table></div><h4 id=--memory-swap>&ndash;memory-swap</h4><ul><li>Using swap allows the container to write excess memory requirements to disk when the container has exhausted all the RAM that is available to it</li><li><code>--memory-swap</code> is a modifier flag that only has meaning if <code>--memory</code> is also set</li></ul><div class=table-wrapper><table><thead><tr><th><code>--memory-swap</code></th><th><code>--memory</code></th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>æ­£æ•°S</td><td>æ­£æ•°M</td><td>å®¹å™¨å¯ç”¨æ€»ç©ºé—´ä¸ºS å…¶ä¸­ramä¸ºM swapä¸º(S-M) è‹¥S=M åˆ™æ— å¯ç”¨swapèµ„æº</td></tr><tr><td>0</td><td>æ­£æ•°M</td><td>ç›¸å½“äºæœªè®¾ç½®swap(unset)</td></tr><tr><td>unset</td><td>æ­£æ•°M</td><td>è‹¥ä¸»æœº(Docker Host)å¯ç”¨äº†swap åˆ™å®¹å™¨çš„å¯ç”¨swapä¸º 2*M</td></tr><tr><td>-1</td><td>æ­£æ•°M</td><td>è‹¥ä¸»æœº(Docker Host)å¯ç”¨äº†swap åˆ™å®¹å™¨å¯ä½¿ç”¨æœ€å¤§è‡³ä¸»æœºçš„æ‰€æœ‰swapç©ºé—´çš„swapèµ„æº</td></tr></tbody></table></div><p>âš ï¸ <strong>æ³¨æ„:</strong> åœ¨å®¹å™¨å†…ä½¿ç”¨freeå‘½ä»¤å¯ä»¥çœ‹åˆ°çš„swapç©ºé—´ å¹¶ä¸å…·æœ‰å…¶æ‰€å±•ç¤ºå‡ºçš„ç©ºé—´æŒ‡ç¤ºæ„ä¹‰</p><h3 id=cpu>CPU</h3><p><a class=link href=https://linux.cn/article-7325-1.html target=_blank rel=noopener>æ·±å…¥Linuxçš„è¿›ç¨‹ä¼˜å…ˆçº§</a></p><ul><li>By default, each containerâ€™s access to the host machineâ€™s CPU cycles is unlimited</li><li>You can set various constraints to limit a given containerâ€™s access to the host machineâ€™s CPU cycles</li><li>Most users use and configure the <a class=link href=https://docs.docker.com/config/containers/resource_constraints/#configure-the-default-cfs-scheduler target=_blank rel=noopener>default CFS scheduler</a></li><li>You can also configure the <a class=link href=https://docs.docker.com/config/containers/resource_constraints/#configure-the-realtime-scheduler target=_blank rel=noopener>realtime scheduler</a>.</li></ul><h4 id=configure-the-default-cfs-scheduler>Configure the default CFS scheduler</h4><p>The CFS is the Linux kernel CPU scheduler for normal Linux processes. Several runtime flags allow you to configure the amount of access to CPU resources your container has. When you use these settings, Docker modifies the settings for the containerâ€™s cgroup on the host machine.</p><div class=table-wrapper><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td><code>--cpus=&lt;value></code></td><td>Specify how much of the available CPU resources a container can use. For instance, if the host machine has two CPUs and you set <code>--cpus="1.5"</code>, the container is guaranteed at most one and a half of the CPUs. This is the equivalent of setting <code>--cpu-period="100000"</code> and <code>--cpu-quota="150000"</code>.</td></tr><tr><td><code>--cpu-period=&lt;value></code></td><td>Specify the CPU CFS scheduler period, which is used alongside <code>--cpu-quota</code>. Defaults to 100000 microseconds (100 milliseconds). Most users do not change this from the default. For most use-cases, <code>--cpus</code> is a more convenient alternative.</td></tr><tr><td><code>--cpu-quota=&lt;value></code></td><td>Impose a CPU CFS quota on the container. The number of microseconds per <code>--cpu-period</code> that the container is limited to before throttled. As such acting as the effective ceiling. For most use-cases, <code>--cpus</code> is a more convenient alternative.</td></tr><tr><td><code>--cpuset-cpus</code></td><td>Limit the specific CPUs or cores a container can use. A comma-separated list or hyphen-separated range of CPUs a container can use, if you have more than one CPU. The first CPU is numbered 0. A valid value might be <code>0-3</code> (to use the first, second, third, and fourth CPU) or <code>1,3</code> (to use the second and fourth CPU).</td></tr><tr><td><code>--cpu-shares</code></td><td>Set this flag to a value greater or less than the default of 1024 to increase or reduce the containerâ€™s weight, and give it access to a greater or lesser proportion of the host machineâ€™s CPU cycles. This is only enforced when CPU cycles are constrained. When plenty of CPU cycles are available, all containers use as much CPU as they need. In that way, this is a soft limit. <code>--cpu-shares</code> does not prevent containers from being scheduled in swarm mode. It prioritizes container CPU resources for the available CPU cycles. It does not guarantee or reserve any specific CPU access.</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># If you have 1 CPU, each of the following commands guarantees the container at most 50% of the CPU every second.</span>
</span></span><span class=line><span class=cl>$ docker run -it --cpus<span class=o>=</span><span class=s2>&#34;.5&#34;</span> ubuntu /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Which is the equivalent to manually specifying --cpu-period and --cpu-quota;</span>
</span></span><span class=line><span class=cl>$ docker run -it --cpu-period<span class=o>=</span><span class=m>100000</span> --cpu-quota<span class=o>=</span><span class=m>50000</span> ubuntu /bin/bash
</span></span></code></pre></td></tr></table></div></div><h3 id=æµ‹è¯•>æµ‹è¯•</h3><p><a class=link href=https://hub.docker.com/r/polinux/stress target=_blank rel=noopener>stress</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ä½¿ç”¨stressé•œåƒ è¿›è¡Œæµ‹è¯•</span>
</span></span><span class=line><span class=cl>$ docker run -ti --rm polinux/stress stress --cpu <span class=m>1</span> --io <span class=m>1</span> --vm <span class=m>1</span> --vm-bytes 128M --timeout 1s --verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ˜¾ç¤ºå®¹å™¨çš„è¿è¡Œè¿›ç¨‹</span>
</span></span><span class=line><span class=cl>$ docker top CONTAINER
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨ç»Ÿè®¡çš„å®æ—¶æµ</span>
</span></span><span class=line><span class=cl>$ docker stats
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/cloud-native/>Cloud Native</a>
<a href=/tags/docker/>Docker</a>
<a href=/tags/dockerfile/>Dockerfile</a>
<a href=/tags/container/>Container</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/coredns/><div class=article-details><h2 class=article-title>CoreDNS</h2></div></a></article><article><a href=/p/tekton/><div class=article-details><h2 class=article-title>Tekton</h2></div></a></article><article><a href=/p/kubernetes/><div class=article-details><h2 class=article-title>Kubernetes</h2></div></a></article><article><a href=/p/prometheus/><div class=article-details><h2 class=article-title>Prometheus</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=ilolicon/ilolicon.github.io issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2025 ilolicon's Blog</section><section class=powerby>VicissitudeğŸ³<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>